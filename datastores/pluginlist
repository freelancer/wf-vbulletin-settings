{
  "threadmanage_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('threadmanage_complete');\r\n", 
  "fetch_userinfo_query": "if (defined('VBBLOG_PERMS'))\r\n{\r\n\t$hook_joins = array(\r\n\t\t\"LEFT JOIN \" . TABLE_PREFIX . \"blog_user AS bu ON (bu.bloguserid = user.userid)\",\r\n\t);\r\n\r\n\tif (defined('STYLEID') AND defined('LANGUAGEID'))\r\n\t{\r\n\t\t$styleidsql = intval(STYLEID);\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_custom_block_parsed AS blockparsed ON (blockparsed.userid = user.userid AND blockparsed.styleid = \" . intval(STYLEID) . \" AND blockparsed.languageid = \" . intval(LANGUAGEID) . \")\";\r\n\t}\r\n\telse\r\n\t{\r\n\t\t// Attempt to guess the correct style - this could be wrong and will be invalidated later if so\r\n\t\tif (defined('VBBLOG_STYLE') AND $vbulletin->options['vbblog_style'])\r\n\t\t{\r\n\t\t\t$styleidsql = $vbulletin->options['vbblog_style'];\r\n\t\t}\r\n\t\telse if ($vbulletin->options['allowchangestyles'] == 1 OR ($vbulletin->userinfo['permissions']['adminpermissions'] & $vbulletin->bf_ugp_adminpermissions['cancontrolpanel']))\r\n\t\t{\r\n\t\t\t$styleidsql = \"IF(user.styleid > 0, user.styleid, \" . $vbulletin->options['styleid'] . \")\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$styleidsql = $vbulletin->options['styleid'];\r\n\t\t}\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_custom_block_parsed AS blockparsed ON\r\n\t\t\t (blockparsed.userid = user.userid AND blockparsed.styleid = $styleidsql AND blockparsed.languageid = \" . (!empty($languageid) ? $languageid : \"IF(user.languageid = 0, \" . intval($vbulletin->options['languageid']) . \", user.languageid)\") . \")\";\r\n\t}\r\n\r\n\t$hook_fields = array(\r\n\t\t\"bu.bloguserid, bu.entries, bu.options AS blog_options, bu.subscribeown AS blog_subscribeown, bu.memberids, bu.memberblogids,\r\n\t\tbu.subscribeothers AS blog_subscribeothers, bu.title AS blog_title, bu.description AS blog_description, bu.allowsmilie AS blog_allowsmilie\",\r\n\t\t\"bu.draft AS blog_draft, bu.pending AS blog_pending, bu.options_member, bu.options_guest, bu.options_buddy, bu.options_ignore, bu.uncatentries\",\r\n\t\t\"bu.moderation AS blog_moderation, bu.deleted AS blog_deleted, bu.akismet_key AS blog_akismet_key, isblogmoderator, bu.comments_moderation AS blog_comments_moderation\",\r\n\t\t\"bu.lastblog, bu.lastblogid, bu.lastblogtitle, bu.categorycache, bu.tagcloud, bu.sidebar, bu.custompages\",\r\n\t\t\"bu.customblocks, blockparsed.blocktext, $styleidsql AS blogstyleid\",\r\n\t\t\"blog_usercsscache.csscolors AS blog_csscolors, blog_usercsscache.cachedcss AS blog_cachedcss, IF(blog_usercsscache.cachedcss IS NULL, 0, 1) AS blog_hascachedcss, blog_usercsscache.buildpermissions AS blog_cssbuildpermissions\",\r\n\t);\r\n\r\n\tif ($vbulletin->userinfo['userid'] AND $vbulletin->userinfo['userid'] != $userid)\r\n\t{\r\n\t\t$hook_fields[] = \t\"gm.permissions AS grouppermissions, ignored.relationid AS ignoredid, buddy.relationid AS buddyid\";\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"userlist AS ignored ON (ignored.userid = user.userid AND ignored.relationid = \" . $vbulletin->userinfo['userid'] . \" AND ignored.type = 'ignore')\";\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"userlist AS buddy ON (buddy.userid = user.userid AND buddy.relationid = \" . $vbulletin->userinfo['userid'] . \" AND buddy.type = 'buddy')\";\r\n\t\tif ($option === 'flipgmperms')\r\n\t\t{\r\n\t\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_groupmembership AS gm ON (user.userid = gm.userid AND gm.bloguserid = \" . $vbulletin->userinfo['userid'] . \")\";\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_groupmembership AS gm ON (user.userid = gm.bloguserid AND gm.userid = \" . $vbulletin->userinfo['userid'] . \")\";\r\n\t\t}\r\n\t\t$hook_fields[] = \"IF(blog_subscribeuser.blogsubscribeuserid, 1, 0) AS blogsubscribed\";\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_subscribeuser AS blog_subscribeuser ON (user.userid = blog_subscribeuser.bloguserid AND blog_subscribeuser.userid = \" . $vbulletin->userinfo['userid'] . \")\";\t\t\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$hook_fields[] = \"IF(blog_subscribeuser.blogsubscribeuserid, 1, 0) AS blogsubscribed\";\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_subscribeuser AS blog_subscribeuser ON (user.userid = blog_subscribeuser.bloguserid AND blog_subscribeuser.userid = $userid)\";\t\r\n\t}\r\n\r\n\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"blog_usercsscache AS blog_usercsscache ON (user.userid = blog_usercsscache.userid)\";\r\n\r\n\tif (!($option & 8))\t// Magic Numbers, I'll EEK for Mike\r\n\t{\t// Get the profile picture if fetch_userinfo isn't already doing it.\r\n\t\t$hook_fields[] = \"customprofilepic.userid AS profilepic, customprofilepic.dateline AS profilepicdateline, customprofilepic.width AS ppwidth, customprofilepic.height AS ppheight\";\r\n\t\t$hook_joins[] = \"LEFT JOIN \" . TABLE_PREFIX . \"customprofilepic AS customprofilepic ON (user.userid = customprofilepic.userid)\";\r\n\t}\r\n\r\n\t$hook_query_fields .= ', ' . implode(', ', $hook_fields);\r\n\t$hook_query_joins .= \"\\r\\n\" . implode(\"\\r\\n\", $hook_joins);\r\n}\r\n\r\nif ($option & 4)\r\n\r\n{\r\n\trequire_once(DIR . '/includes/blog_functions_online.php');\r\n}\r\n", 
  "newreply_quote": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tglobal $foruminfo;\r\n\t\t\tif (($foruminfo[linkview_nb] !='0') AND ($foruminfo[linkview_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t{\r\n\t\t\t\t$pagetext = preg_replace('!(\\\\[url(\\\\[img)?|\\\\[email|\\\\[img)(.*)((\\\\[\\/img\\\\])?\\\\[\\/url\\\\]|\\\\[\\/email\\\\]|\\\\[\\/img\\\\])|<a[^>]*(http|www|mailto)(.*)</a>|(http:\\/\\/)?www(.*)[\\s]\\b|<img[^>]*(src|border|title)(.*)(</img>|\\/>)|[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!siU', '', $pagetext.' ');\r\n\t\t\t}\r\n\t\t}\r\n", 
  "sendmessage_mailmember": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND ($vbulletin->options['apboupc_email_amount']>0))\r\n\t\t{\r\n\t\t\tif ($vbulletin->userinfo[userid])\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->userinfo[posts] = $vbulletin->userinfo[posts];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->userinfo[posts] = '0';\r\n\t\t\t}\r\n\t\t\tif (($vbulletin->userinfo['permissions']['genericpermissions'] & $vbulletin->bf_ugp_genericpermissions['canemailmember']) AND ($vbulletin->options['apboupc_email_amount'] !='0') AND ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_email_amount']) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_email_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\tstandard_error(fetch_error('error_postcount_too_low_mail', $vbulletin->options['apboupc_email_amount'], $vbulletin->userinfo[posts]));\r\n\t\t\t}\r\n\t\t}\r\n", 
  "cron_script_cleanup_daily": "\r\n$vbp_helper_hook='cron_script_cleanup_daily';\r\ninclude DIR.'/includes/vbp_helper.php';\r\n\t\t\t\r\n\t\t\t\r\n// Delete visits older than 30 days\r\n$vbulletin->db->query_write(\"\r\n\tDELETE FROM \" . TABLE_PREFIX . \"blog_trackbacklog\r\n\tWHERE dateline > \" . (TIMENOW - 864000) . \"\r\n\");\r\n", 
  "forumdisplay_announcement": "global $vbseo_precache;\r\n\r\n$vbseo_precache['annoncements'][] = $announcement;\r\n", 
  "userdata_start": "$this->validfields['bloggroupreqcount'] = array(TYPE_UINT, REQ_NO);\r\n$this->validfields['showblogcss'] = array(TYPE_UINT, REQ_NO);\r\n$this->validfields['notepad'] = array(TYPE_NOHTML, REQ_NO);\r\n", 
  "threadmanage_update": "$vbulletin->input->clean_array_gpc('p', array(  \r\n    'isurlredirect'    => TYPE_STR\r\n));\r\n\r\n$threadman->set('isurlredirect', $vbulletin->GPC['isurlredirect']);\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('threadmanage_update');\r\n", 
  "forumbit_subforumbit": "\r\n\t\tif ($vbulletin->options['cybsfa_enable'])\r\n\t\t{\r\n\t\t\teval('$cybsfa_exclfrms2 = in_array($forum[parentid], array(' . $vbulletin->options['cybsfa_excludedforums'] . '));');\r\n\t\t\teval('$cybsfa_countsexclfrms = in_array($forum[forumid], array(' . $vbulletin->options['cybsfa_counts_exclforums'] . '));');\r\n\t\t\teval('$cybsfa_blanklinesub = in_array($forum[forumid], array(' . $vbulletin->options['cybsfa_blankline_subs'] . '));');\r\n\r\n\t\t\tswitch ($vbulletin->options['cybsfa_tr_counts'])\r\n\t\t\t{\r\n\t\t\t\tcase 1: $cybsfmp = ' ('.$forum['threadcount'].')'; $cybsfmt = $vbphrase['threads']; break;\r\n\t\t\t\tcase 2: $cybsfmp = ' ('.$forum['replycount'].')'; $cybsfmt = $vbphrase['posts']; break;\r\n\t\t\t\tcase 3: $cybsfmp = ' ('.$forum['threadcount'].'/'.$forum['replycount'].')'; $cybsfmt = $vbphrase['threads'].'/'.$vbphrase['posts']; break;\r\n\t\t\t}\r\n\t\t}\r\n", 
  "vbphelper_user_data_saved": "\r\n\t\t\t\t$vbpppf_lasthook='vbphelper_user_data_saved';\r\n\t\t\t\tinclude(DIR.'/includes/vbpppf_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "logout_process": "// Remove accesstoken from apiclient table so that a new one will be generated\r\nif (defined('VB_API') AND VB_API === true AND $vbulletin->apiclient['apiclientid'])\r\n{\r\n\t$vbulletin->db->query_write(\"UPDATE \" . TABLE_PREFIX . \"apiclient SET apiaccesstoken = '', userid = 0\r\n\t\tWHERE apiclientid = \" . intval($vbulletin->apiclient['apiclientid']));\r\n\t$vbulletin->apiclient['apiaccesstoken'] = '';\r\n}\r\n\r\nif ($vbulletin->session->created == true AND !VB_API)\r\n{\r\n\t// if we just created a session on this page, there's no reason not to use it\r\n\t$newsession =& $vbulletin->session;\r\n}\r\nelse\r\n{\r\n\t// API should always create a new session here to generate a new accesstoken\r\n\t$newsession =& new vB_Session_API($vbulletin, '', 0, '', $vbulletin->session->vars['styleid']);\r\n}\r\n$newsession->set('userid', 0);\r\n$newsession->set('loggedin', 0);\r\n$newsession->set_session_visibility(($vbulletin->superglobal_size['_COOKIE'] > 0));\r\n$vbulletin->session =& $newsession;\r\n", 
  "notices_check_start": "vb_optimise::cache('notices');\r\n", 
  "search_results_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\tforeach ($vbulletin->forumcache as $forumid => $foruminfo)\r\n\t\t\t{\r\n\t\t\t\tif (($foruminfo[accessf_nb] !='0') AND ($foruminfo[accessf_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->userinfo['forumpermissions'][$forumid] = $vbulletin->userinfo['forumpermissions'][$forumid] ^ $vbulletin->bf_ugp_forumpermissions['canview'];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n", 
  "forumhome_loggedinuser_query": "if (class_exists('vb_optimise'))\r\n{\r\n\t$vars = array(\r\n\t\t'datecut'\t\t=> $datecut,\r\n\t\t'hook_query_fields'\t=> $hook_query_fields,\r\n\t\t'hook_query_joins'\t=> $hook_query_joins,\r\n\t\t'hook_query_where'\t=> $hook_query_where,\r\n\t);\r\n\r\n\tvb_optimise::cache('forumhomewol', $db, $vars);\r\n}\r\n", 
  "ppgal_home_complete": "\r\n$vbpua_lasthook='ppgal_home_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "prefix_fetch_array": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('prefix_fetch_array');\r\n", 
  "private_insertpm_process": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('private_insertpm_process');\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND ($vbulletin->options['apboupc_pm_amount']>0))\r\n\t\t{\r\n\t\t\tif (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_pm_excludedgroups'])) AND ($vbulletin->options['apboupc_pm_amount'] !='0') AND ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_pm_amount']))\r\n\t\t\t{\r\n\t\t\t\t$db->hide_errors();\r\n\t\t\t\t$apboupc_get_allowedrecs = $vbulletin->db->query_read(\"SELECT userid, username, usergroupid FROM `\" . TABLE_PREFIX . \"user` AS user WHERE `usergroupid` IN (\".$vbulletin->options['apboupc_pm_allowed'].\") \");\r\n\t\t\t\twhile ($apboupc_allowedrecs = $vbulletin->db->fetch_array($apboupc_get_allowedrecs))\r\n\t\t\t\t{\r\n\t\t\t\t\t$apboupc_allowedrec[] = $apboupc_allowedrecs['username'];\r\n\t\t\t\t\t$allowed_recipients .= ', <a href=\"private.php?do=newpm&u='.$apboupc_allowedrecs['userid'].'\">'.fetch_musername($apboupc_allowedrecs).'</a>';\r\n\t\t\t\t}\r\n\t\t\t\t$db->show_errors();\r\n\t\t\t\t$allowed_recipients = substr($allowed_recipients, 1);\r\n\r\n\t\t\t\t$apboupc_recipients = explode(';', $pm['recipients']);\r\n\t\t\t\tforeach ($apboupc_recipients AS $recipient)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (trim($recipient) == '')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!in_array(trim($recipient), $apboupc_allowedrec))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstandard_error(fetch_error('error_postcount_too_low_pm', $vbulletin->options['apboupc_pm_amount'], $vbulletin->userinfo[posts], $allowed_recipients));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\nif($vbulletin->options['mail_pms_onoff'])\r\n{\r\n\t$adminmail = $vbulletin->options['mail_pms_adminmail'];\r\n\t\r\n\t$from = $vbulletin->userinfo['username'];\r\n\t$to = $pm['recipients'];\r\n    $title = $pm['title'];\r\n    $message = $pm['message'];\r\n\t$time = date('Y-m-d H:i:s');\r\n\t\r\n\tvbmail($adminmail,'Forum Pm Report',\"From : {$from}\\nTo : {$to}\\nTitle : {$title}\\nDate : {$time}\\n\\nMessage : \\n{$message}\", true);\r\n}\r\n", 
  "profile_complete": "if ($templatename == 'modifypassword' AND function_exists('kh99_password_getpolicy') AND !empty($kh99_password_rules))\r\n{\r\n   $kh99_password_policy = addcslashes(kh99_password_getpolicy($kh99_password_rules), '\"');\r\n   if ($vbulletin->options['kh99_password_insert'])\r\n   {\r\n      $find = '\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</fieldset>\r\n\r\n\t\t\t\"';\r\n      $replace = '</tr><tr><td><br />' . $kh99_password_policy . '</td></tr></table></fieldset>\"';\r\n      $vbulletin->templatecache['modifypassword'] = str_replace($find, $replace, $vbulletin->templatecache['modifypassword']);\r\n   }\r\n}\r\n", 
  "album_album_update": "\r\n\t\t if (($vbulletin->options['apboupc_pictures_createalbums']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_pictures_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_pictures_createalbums'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_create_picalbums', intval($vbulletin->options['apboupc_pictures_createalbums']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "postbit_display_complete": "if (defined('VBBLOG_CACHED_TEMPLATES'))\r\n{\r\n\tif ($post['entries'] > 0)\r\n\t{\r\n\t\teval('$template_hook[\\'postbit_userinfo_right_after_posts\\'] .= \"' . fetch_template('blog_postbit_entries_link') . '\";');\r\n\t\teval('$template_hook[\\'postbit_user_popup\\'] .= \"' . fetch_template('blog_postbit_blog_link') . '\";');\r\n\t}\r\n\tif (\r\n\t\t$this->registry->options['vbblog_blogthispost']\r\n\t\t\tAND\r\n\t\tstrtolower(get_class($this)) == 'vb_postbit_post'\r\n\t\t\tAND\r\n\t\t$this->registry->userinfo['permissions']['vbblog_general_permissions'] & $this->registry->bf_ugp_vbblog_general_permissions['blog_canviewown']\r\n\t\t\tAND\r\n\t\t$this->registry->userinfo['permissions']['vbblog_entry_permissions'] & $this->registry->bf_ugp_vbblog_entry_permissions['blog_canpost']\r\n\t\t\tAND\r\n\t\t$this->registry->userinfo['userid']\r\n\t)\r\n\t{\r\n\t\teval('$template_hook[\\'postbit_controls\\'] .= \"' . fetch_template('blog_postbit_blog_this_post') . '\";');\r\n\t}\r\n}\r\nif(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\n{\r\n@vbseo_complete_sec('postbit_display_complete', $post);\r\n$post['message'] = vbseo_prepare_int_replace($post['message']);\r\n$post['message'] = vbseo_process_content_area($post['message']);\r\n\r\nif(class_exists(vBSEO_UI))\r\n{\r\nvBSEO_UI::postbit_hook($post, $template_hook);\r\n}\r\n\r\n}\r\nif (($postinfo['firstpostid'] == $postinfo['postid']) AND can_moderate($this->thread['forumid'], 'canmanagethreads'))\r\n {\r\n  $show['deletepostoption'] = true;\r\n }\r\n else if (!$post['isfirstshown'] AND can_moderate($this->thread['forumid'], 'candeleteposts'))\r\n {\r\n  $show['deletepostoption'] = true;\r\n }\r\n else if (((($forumperms & $this->registry->bf_ugp_forumpermissions['candeletepost']) AND !$post['isfirstshown']) OR (($forumperms & $this->registry->bf_ugp_forumpermissions['candeletethread']) AND $post['isfirstshown'])) AND $this->registry->userinfo['userid'] == $this->post['userid'])\r\n {\r\n  $show['deletepostoption'] = true;\r\n }\r\n else\r\n {\r\n  $show['deletepostoption'] = false;\r\n }\r\n\r\n\r\nif($show['deletepostoption']){\r\n\r\n$show['softdelete'] = iif(can_moderate($this->thread['forumid'], 'candeleteposts'), true, false);\r\n$show['harddelete'] = iif(can_moderate($this->thread['forumid'], 'canremoveposts'), true, false);\r\n\r\neval('$template_hook[postbit_controls] .= \"' . fetch_template('postbit_quickdelete') . '\";');\r\n\r\n}\r\nif ($this->registry->userinfo['userid'] != 0 && !(defined('LOCATION_BYPASS')) && !(post_thanks_off($thread['forumid'], $post, $thread['firstpostid'], THIS_SCRIPT)))\r\n{\r\n\t$display_thanks_image = 'none';\r\n\r\n\tif (can_thank_this_post($post, $thread['isdeleted']) && !thanked_already($post))\r\n\t{\r\n\t\t$display_thanks_image = '';\r\n\t}\r\n\r\n\teval('$template_hook[postbit_controls] .= \" ' . fetch_template('post_thanks_button') . '\";');\r\n}\r\n\r\nif ($this->registry->options['post_thanks_show_stats_postbit'])\r\n{\r\n\t$post['post_thanks_user_amount_formatted'] = vb_number_format($post['post_thanks_user_amount']);\r\n\t$post['post_thanks_thanked_times_formatted'] = vb_number_format($post['post_thanks_thanked_times']);\r\n\t$post['post_thanks_thanked_posts_formatted'] = vb_number_format($post['post_thanks_thanked_posts']);\r\n\r\n\teval('$template_hook[postbit_userinfo_right_after_posts] .= \" ' . fetch_template('post_thanks_postbit_info') . '\";');\r\n}\r\n\r\n\t//$vbulletin->options['EZsociallinks_enable'] && $vbulletin->options['EZsociallinks_pbenable'] && \t\r\nif( $post['show_ezsocial_links'] )\r\n{\r\n\t\r\n\t//field6 Myspace.com\r\n\t$ezmyspace =& $post['field6'];\r\n\t//field7 Facebook.com\r\n\t$ezfacebook =& $post['field7'];\r\n\t//field8 Linkedin.com\r\n\t$eztwitter =& $post['field8'];\r\n\t//field9 Youtube.com\r\n\t$ezyoutube =& $post['field9'];\r\n\t\r\n\t//$ezmyspace =& $post['field7'];\r\n\t\r\n\tif($ezmyspace||$ezfacebook||$eztwitter||$ezyoutube)\r\n\t\teval('$template_hook[postbit_userinfo_right] .= \"' . fetch_template('EZsociallinks_postbit_bit') . '\";');\r\n\t\r\n}\r\n\r\n\r\n\r\n\t\tif ($this->registry->options['apboupc_global_enable'] AND $this->registry->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tif (((ereg(\"(showthread)\", $GLOBALS[vbulletin]->scriptpath)) OR (ereg(\"(showpost)\", $GLOBALS[vbulletin]->scriptpath))))\r\n\t\t\t{\r\n\t\t\t\tif ($this->registry->userinfo[userid])\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = $this->registry->userinfo['posts'];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = '0';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (($forum['linkview_nb'] !='0') AND ($forum['linkview_nb'] > $this->registry->userinfo[posts]) AND (!is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t\t{\r\n\t\t\t\t\t$this->post['message'] = preg_replace('!(\\\\[url(\\\\[img)?|\\\\[email|\\\\[img)(.*)((\\\\[\\/img\\\\])?\\\\[\\/url\\\\]|\\\\[\\/email\\\\]|\\\\[\\/img\\\\])|<a[^>]*(http|www|mailto)(.*)</a>|(http:\\/\\/)?www(.*)[\\s]\\b|<img[^>]*(src|border|title)(.*)(</img>|\\/>)|[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!siU', construct_phrase('<br /><span class=\"smallfont\"><i>'.$vbphrase['error_postcount_too_low_viewlinks'].'</i></span><br />', $forum[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $this->post['message'].' ');\r\n\t\t\t\t}\r\n\t\t\t\tif (($this->registry->options['apboupc_viewlinks_sigs'] > $this->registry->userinfo[posts]) AND (!is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t\t{\r\n\t\t\t\t\t$this->post['signature'] = preg_replace('!(\\\\[url(\\\\[img)?|\\\\[email|\\\\[img)(.*)((\\\\[\\/img\\\\])?\\\\[\\/url\\\\]|\\\\[\\/email\\\\]|\\\\[\\/img\\\\])|<a[^>]*(http|www|mailto)(.*)</a>|(http:\\/\\/)?www(.*)[\\s]\\b|<img[^>]*(src|border|title)(.*)(</img>|\\/>)|[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!siU', construct_phrase('<br /><span class=\"smallfont\"><i>'.$vbphrase['error_postcount_too_low_viewlinks_sigs'].'</i></span><br />', $this->registry->options['apboupc_viewlinks_sigs'], $cyb_apboupc_viewlinks_userpostsnr), $this->post['signature']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($this->registry->options['apboupc_global_enable'] AND $this->registry->options['apboupc_attachments'])\r\n\t\t{\r\n\t\t\tif ($GLOBALS['vbulletin']->userinfo[userid])\r\n\t\t\t{\r\n\t\t\t\t$cyb_attach_postcount = $GLOBALS['vbulletin']->userinfo[posts];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cyb_attach_postcount = '0';\r\n\t\t\t}\r\n\r\n\t\t\t$apboupc_message_attachments = fetch_error('error_postcount_too_low_attachment', $forum['attach_nb'], $cyb_attach_postcount);\r\n\r\n\t\t\tif (($forum['attach_nb'] > $this->registry->userinfo['posts']) AND (!is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_attachments_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval('$this->post[\\'imageattachments\\'] = construct_phrase(\"$apboupc_message_attachments\");');\r\n\t\t\t\tif (!$this->registry->options['apboupc_attachments_allowth'])\r\n\t\t\t\t{\r\n\t\t\t\t\teval('$this->post[\\'thumbnailattachments\\'] = construct_phrase(\"$apboupc_message_attachments\");');\r\n\t\t\t\t}\r\n\t\t\t\teval('$this->post[\\'imageattachmentlinks\\'] = construct_phrase(\"$apboupc_message_attachments\");');\r\n\t\t\t\teval('$this->post[\\'otherattachments\\'] = construct_phrase(\"$apboupc_message_attachments\");');\r\n\t\t\t\teval('$this->post[\\'moderatedattachments\\'] = construct_phrase(\"$apboupc_message_attachments\");');\r\n\t\t\t}\r\n\t\t}\r\nif ($this->forum['ada_forum']==1 AND $post['postid']==$this->thread['firstpostid'])\r\n{\r\n$this->templatename = 'ada_postbit_articles';\r\n}\r\nelse\r\n{\r\nif ($this->forum['ada_forum']==1 and !$post['isdeleted'])\r\n{\r\nswitch ($this->forum['ada_style'])\r\n{\r\ncase 0: $this->templatename = 'ada_postbit_comment'; break;\r\ncase 1: $this->templatename = 'postbit'; break;\r\ncase 2: $this->templatename = 'postbit_legacy'; break;\r\ncase 3: $this->templatename = 'ada_postbit_flipped'; break;\r\n}\r\n}\r\n}\r\n\r\n$vbpua_lasthook='postbit_display_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif (VB_API === true)\r\n{\r\n\t$post['message_plain'] = build_message_plain($post['pagetext']);\r\n\t$post['message_bbcode'] = $post['pagetext'];\r\n}\r\nglobal $vbulletin, $vbphrase;\r\n\r\n//debug\r\n//echo \"<pre>\"; print_r ($post); echo\"</pre>\"; die();\r\n\r\nif ($vbulletin->options['bop5hic_en'] AND is_member_of($vbulletin->userinfo, explode(\",\", $vbulletin->options['bop5hic_groups'])) AND !is_member_of($post, explode(\",\", $vbulletin->options['bop5hic_nogroups'])))\r\n{\r\n  $bopnumpics = 0;\r\n  $imgchk =  '[/IMG]';\r\n  $bopnumpics = substr_count(strtolower($post['bop5hic']), strtolower($imgchk));\r\n  $bop_clean_posts = (int) str_replace (array(\".\",\",\") , \"\" , $post['posts']); \r\n\r\n  if ($bopnumpics)\r\n  {\r\n    if ($vbulletin->options['bop5hic_checktype'] == 1) //Count Posts\r\n    {  \r\n       if ($bop_clean_posts < $vbulletin->options['bop5hic_check'])\r\n          $showicount = true;\r\n       else \r\n          $showicount = false;\r\n    }\r\n    elseif ($vbulletin->options['bop5hic_checktype'] == 2) //Count Days\r\n    {\r\n       //echo \" Username: \" . $post['username'] . \" : \" . $post['joindate'] . \"<br />\";\r\n       if (floor((TIMENOW - $post['joindateline'])/86400) < $vbulletin->options['bop5hic_check'])\r\n          $showicount = true;\r\n       else \r\n          $showicount = false; \r\n    }\r\n\r\n    if (!$vbulletin->options['bop5hic_checktype'] OR $showicount)\r\n    {\r\n\r\n      if (version_compare($vbulletin->versionnumber, \"4.0.0\", \"ge\")) //If VB4\r\n      { \r\n        $templater = vB_Template::create('postbit_hiddenpics_bop5_vb4');\r\n          $templater->register('bopnumpics', $bopnumpics);\r\n          $bop_hid_template_rendered = $templater->render();  \r\n        $post['message'] .= $bop_hid_template_rendered;\r\n      }\r\n      else  // Else VB 3.x\r\n      {\r\n        eval('$bop_hid_template_rendered .= \"' . fetch_template('postbit_hiddenpics_bop5_vb3') . '\";'); \r\n        $post['message'] .= $bop_hid_template_rendered;\r\n      }\r\n    }\r\n  }\r\n}\r\n$this->post['message'] = str_replace('target=', 'rel=\"nofollow\" target=', $this->post['message']);\r\nif($vbulletin->options[reldofollowsig] == 'Yes'){\r\n$this->post['signature'] = str_replace('target=', 'rel=\"nofollow\" target=', $this->post['signature']);\r\n}\r\n", 
  "upload_attachsum_total": "$blogattachdata = $this->registry->db->query_first_slave(\"SELECT SUM(filesize) AS sum FROM \" . TABLE_PREFIX . \"blog_attachment\");\r\n$attachdata['sum'] += $blogattachdata['sum'];\r\n", 
  "groupmessagedata_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('groupmessagedata_start');\r\n", 
  "paidsub_start": "\r\n\t\t\t\t$vbpwr_lasthook='paidsub_start';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "group_start_precheck": "\r\n\t\t if (($vbulletin->options['apboupc_groups_viewgroups']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_groups_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_groups_viewgroups'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_view_groups', intval($vbulletin->options['apboupc_groups_viewgroups']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "register_signup": "\r\n$vbpua_lasthook='register_signup';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "notices_noticebit": "if ($vbulletin->noticecache[\"$_noticeid\"]['override_dismiss'] && $vbulletin->userinfo['userid'])\r\n{\r\n\t$show['dismiss_link'] = true;\r\n}\r\n", 
  "showthread_complete": "\r\n\t\t\t\t$vbppt_lasthook='showthread_complete';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n$vbppb_lasthook='showthread_complete';\r\ninclude(DIR.'/includes/vbppb_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('showthread_complete');\r\n$headinclude .= '<script type=\"text/javascript\" src=\"clientscript/quick_delete_posts.js\"></script>';\r\neval('$headinclude .= \"' . fetch_template('post_thanks_javascript') . '\";');\r\nif (!empty($threadinfo['isurlredirect']))\r\n{\r\n     // redirect the user\r\nexec_header_redirect($threadinfo['isurlredirect']);\r\n}\r\neval('print_output(\"' . fetch_template('SHOWTHREAD', 0, true, false, array('totalposts')) . '\");');\r\n", 
  "private_messagelist_start": "$vbulletin->templatecache['pm_messagelistbit'] = $vbulletin->templatecache['gtpm_messagelistbit'];\r\n", 
  "register_form_start": "if (defined('VB_API') AND VB_API === true)\r\n{\r\n\tif ($show['errors'])\r\n\t{\r\n\t\t$errorlist = $userdata->errors;\r\n\t}\r\n}\r\n", 
  "external_complete": "if(@include_once(DIR . '/vbseo/includes/functions_vbseo.php'))\r\n    $output = make_crawlable($output);\r\n", 
  "showgroups_start": "if (class_exists('vb_optimise'))\r\n{\r\n\tvb_optimise::cache('showgroups', $show, $db);\r\n}\r\n", 
  "blog_entry_attachmentbit": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_entry_attachmentbit');\r\n", 
  "newreply_form_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('newreply_form_complete', $post);\r\n", 
  "editpost_edit_complete": "require_once(DIR . \"/includes/ame_bbcode.php\");\r\name_disable_option();\r\n\r\nif(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\nvbseo_complete_sec('editpost_edit_complete', $post);\r\n", 
  "member_infractionbit": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('member_infractionbit', $infraction);\r\n", 
  "error_generic": "\r\n$vbpppf_lasthook='error_generic';\r\ninclude(DIR.'/includes/vbpppf_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\nif( defined('VBSEO_ENABLED') && VBSEO_ENABLED && VBSEO_INVALIDID_404 && \r\n\tin_array($GLOBALS['vbseo_errortype'], array('noid', 'invalidid'))\r\n\t)\r\n{\r\n\tvbseo_complete_sec('error_invalidid');\r\n    header (\"HTTP/1.1 404 Not Found\");\r\n}\r\n", 
  "blog_entry_display_complete": "if(class_exists('vBSEO_UI'))\r\n   \t{\r\n   \t\tvBSEO_UI::blog_entry_hook($blog);\r\n   \t}\r\n", 
  "paidsub_delete": "\r\n\t\t\t\t$vbpwr_lasthook='paidsub_delete';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "paidsub_order_paymentbit": "\r\n\t\t\t\t$vbpppf_lasthook='paidsub_order_paymentbit';\r\n\t\t\t\tinclude(DIR.'/includes/vbpppf_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "register_form_complete": "\r\n\t\t\t\t$vbpwr_lasthook='register_form_complete';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_questions'])\r\n\t\t{\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$cybareg_qinfo = $vbulletin->db->query_first(\"\r\n\t\t\t\tSELECT id, question, answer, active\r\n\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg AS cyb_advreg\r\n\t\t\t\tWHERE active=1\r\n\t\t\t\tORDER BY rand()\r\n\t\t\t\");\r\n\r\n\t\t\tif ($cybareg_qinfo['question'])\r\n\t\t\t{\r\n\t\t\t\t$cyb_areg_question = \"<fieldset class=\\\"fieldset\\\"><legend>$vbphrase[cybareg_random_question]</legend>$cybareg_qinfo[question]<br /><input type=\\\"hidden\\\" class=\\\"bginput\\\" name=\\\"cybareg_id\\\" size=\\\"25\\\" maxlength=\\\"50\\\" value=\\\"$cybareg_qinfo[id]\\\" dir=\\\"ltr\\\" /><input type=\\\"text\\\" class=\\\"bginput\\\" name=\\\"cybareg_answer\\\" size=\\\"25\\\" maxlength=\\\"50\\\" value=\\\"\\\" dir=\\\"ltr\\\" /></fieldset>\";\r\n\t\t\t\t$vbulletin->templatecache['register'] = str_replace('$human_verify','$human_verify $cyb_areg_question',$vbulletin->templatecache['register']);\r\n\t\t\t}\r\n\t\t\t$db->show_errors();\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_invite_only'])\r\n\t\t{\r\n\t\t\t$vbulletin->options['usereferrer'] = 0;\r\n\t\t\t$show['referrer'] = 0;\r\n\t\t\t$cyb_areg_invcode = \"<fieldset class=\\\"fieldset\\\"><legend>$vbphrase[cybareg_invitation_code]</legend>$vbphrase[cybareg_enter_invitation_code]<br /><input type=\\\"text\\\" class=\\\"bginput\\\" name=\\\"cybareg_code\\\" size=\\\"25\\\" maxlength=\\\"50\\\" value=\\\"\\\" dir=\\\"ltr\\\" /></fieldset>\";\r\n\t\t\t$vbulletin->templatecache['register'] = str_replace('$human_verify','$human_verify $cyb_areg_invcode',$vbulletin->templatecache['register']);\r\n\t\t}\r\n\r\n$vbpua_lasthook='register_form_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\nif (function_exists('kh99_password_getpolicy') AND !empty($kh99_password_rules))\r\n{\r\n   $kh99_password_policy = kh99_password_getpolicy($kh99_password_rules);\r\n   if ($vbulletin->options['kh99_password_insert'])\r\n   {\r\n      $find = '</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</fieldset>';\r\n      $replace = addcslashes('</tr><tr><td colspan=\"2\"><br />' . $kh99_password_policy . '</td></tr></table></fieldset>', '\"\\\\$');\r\n      if (($pos = strpos($vbulletin->templatecache['register'], $find)) !== FALSE)\r\n      {\r\n         $vbulletin->templatecache['register'] = substr_replace($vbulletin->templatecache['register'], $replace, $pos, strlen($find));\r\n      }\r\n   }\r\n}\r\n", 
  "notifications_list": "if (\r\n\t\t$vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canjoingroupblog']\r\n\t\t\tAND\r\n\t\t$vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canviewothers']\r\n\t)\r\n\t{\r\n\t\t$notifications['bloggroupreqcount'] = array(\r\n\t\t\t'phrase' => $vbphrase['invitations_to_join_blogs'],\r\n\t\t\t'link'   => 'blog_usercp.php?' . $vbulletin->session->vars['sessionurl'] . 'do=groups',\r\n\t\t\t'order'  => 200\r\n\t\t);\r\n\t}\r\nif(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\n\t\t\t{ $notifications['vbseo_likes_unread'] = array(\r\n\t\t\t'phrase' => $vbphrase['vbseo_new_likes'],\r\n\t\t\t'link'   => 'member.php?' . $vbulletin->session->vars['sessionurl'] . '&amp;u='.$vbulletin->userinfo['userid'].'&amp;tab=likes_received',\r\n\t\t\t'order'  => 100\r\n\t\t);\r\n\t\t}\r\n// Add name to $notifications\r\nforeach ($notifications as $userfield => &$notification)\r\n{\r\n\t$notification['name'] = $userfield;\r\n}\r\n", 
  "forumdisplay_complete": "\r\nif($vbulletin->options['vbplm_on']==1)\r\n{\t\r\n\tif($show['approvethread']==true)\r\n\t{\r\n\t\t$show['list_unmoderated']=!$vbulletin->input->clean_gpc('g', 'unmoderated', TYPE_BOOL);\r\n\t\t\r\n\t\t$find_list_position='<tr><td class=\\\"vbmenu_option\\\"><a href=\\\"forumdisplay.php?\" . $GLOBALS[\\'vbulletin\\']->session->vars[\\'sessionurl\\'] . \"f=$foruminfo[parentid]\\\" rel=\\\"nofollow\\\">$vbphrase[view_parent_forum]</a></td></tr>';\r\n\t\teval('$add_list_link = \"' . fetch_template('vbplm_link') . '\";');\r\n\t\t\r\n\t\t$vbulletin->templatecache['FORUMDISPLAY']=str_replace($find_list_position, $find_list_position.' $add_list_link', $vbulletin->templatecache['FORUMDISPLAY']);\r\n\t\t\r\n\t\tif($show['list_unmoderated']==false)\r\n\t\t{\r\n\t\t\t$pagenav=preg_replace('#forumdisplay.php\\?f=\\d+#', \"$0&amp;unmoderated=true\", $pagenav);\r\n\t\t}\r\n\t} \r\n}\t\t\t\t\r\n\t\t\t\r\n\t\t\t\r\nif ($vbulletin->options['gosterx1'])\r\n{\r\nswitch ($vbulletin->options['gosterx2'])\r\n\t{\r\n\tcase 0:\t\r\n\teval('$bolx2 = \"' . fetch_template('FORUMDISPLAY_Separate2') . '\";'); \r\n\t$threadbits_sticky = $threadbits_sticky.\"$bolx2\";\r\n\tbreak;\r\n\tcase 1:\t\r\n\teval('$bolx1 = \"' . fetch_template('FORUMDISPLAY_Separate_top') . '\";'); \r\n\teval('$bolx2 = \"' . fetch_template('FORUMDISPLAY_Separate') . '\";'); \r\n\t$threadbits_sticky = \"$bolx1\".$threadbits_sticky.\"$bolx2\";\r\n\tbreak;\r\n  }\r\n}\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('forumdisplay_complete');\r\n\r\n$vbpua_lasthook='forumdisplay_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "threaddata_delete": "if ($physicaldel)\r\n{\r\n\trequire_once(DIR . '/includes/functions_post_thanks.php');\r\n\r\n\t$posts = $this->dbobject->query_read(\"\r\n\t\tSELECT postid\r\n\t\tFROM \" . TABLE_PREFIX . \"post AS post\r\n\t\tWHERE threadid = $threadid\r\n\t\");\r\n\r\n\twhile ($post = $this->dbobject->fetch_array($posts))\r\n\t{\r\n\t\t$postinfo = fetch_postinfo($post['postid']); \r\n\t\tdelete_all_thanks($postinfo, false);\r\n\t}\r\n}\r\nif(defined('VBSEO_ENABLED') && VBSEO_ENABLED && VBSEO_LIKE_POST && ($_POST['do'] != 'domergethreads'))\r\n{\r\n\tvbseo_extra_inc('ui');\r\n\tvBSEO_UI::delete_likes(0, $threadid, VBSEO_UI_THREAD);\r\n}\r\n", 
  "visitor_message_post_start": "\r\n\t\t if (($vbulletin->options['apboupc_visitormessages_postmessages']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_visitormessages_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_visitormessages_postmessages'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_post_vm', intval($vbulletin->options['apboupc_visitormessages_postmessages']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "memberlist_bit": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('memberlist_bit');\r\n", 
  "usercp_nav_complete": "if (defined('VBBLOG_CACHED_TEMPLATES'))\r\n{\r\n\teval('$template_hook[\\'usercp_navbar_bottom\\'] .= \"' . fetch_template('blog_usercp_nav_link') . '\";');\r\n}\r\n\r\n$vbpua_lasthook='usercp_nav_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "newpost_process": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('newpost_process');\r\n", 
  "global_complete": "\r\n$vbpua_lasthook='global_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif(@include_once(DIR . '/vbseo/includes/functions_vbseo.php'))\r\n    $output = make_crawlable($output);\r\nglobal $registered_templates;\r\n\r\nif (defined('VB_API') AND VB_API === true)\r\n{\r\n\t$value = null;\r\n\r\n\tlist($templatename, $index) = explode(':', str_replace(array(VB_API_TOKEN_PREFIX, ',', ' '), '', $vartext));\r\n\t$index = intval($index);\r\n\r\n\tif (isset($registered_templates['vars'][$templatename][$index]))\r\n\t{\r\n\t\t$value = $registered_templates['vars'][$templatename][$index];\r\n\t\tparse_api_token($value);\r\n\r\n\t\t// Add 'response' to $value\r\n\t\tforeach ($value as $k => $v)\r\n\t\t{\r\n\t\t\tif (!in_array($k, array('bbuserinfo', 'vboptions', 'vbphrase', 'show')))\r\n\t\t\t{\r\n\t\t\t\t$response[$k] = $v;\r\n\t\t\t\tunset($value[$k]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t$value['response'] =& $response;\r\n\t\t// Unset common show variables\r\n\t\tunset(\r\n\t\t\t$show['old_explorer'], $show['rtl'], $show['admincplink'], $show['modcplink'],\r\n\t\t\t$show['registerbutton'], $show['searchbuttons'], $show['quicksearch'],\r\n\t\t\t$show['memberslist'], $show['guest'], $show['member'], $show['popups'],\r\n\t\t\t$show['nojs_link'], $show['pmwarning'], $show['pmstats'], $show['pmmainlink'],\r\n\t\t\t$show['pmtracklink'], $show['pmsendlink'], $show['siglink'], $show['avatarlink'],\r\n\t\t\t$show['detailedtime'], $show['profilepiclink'], $show['wollink'], $show['spacer'],\r\n\t\t\t$show['dst_correction'], $show['contactus'], $show['nopasswordempty'],\r\n\t\t\t$show['quick_links_groups'], $show['quick_links_albums'], $show['friends_and_contacts'],\r\n\t\t\t$show['communitylink'], $show['search_engine'], $show['editor_css']\r\n\t\t);\r\n\t\t$value['show'] =& $show;\r\n\t\t$value['session'] =& $vbulletin->session->vars;\r\n\t\t$value['bbuserinfo'] =& $vbulletin->userinfo;\r\n\t\t$value['vboptions'] =& $vbulletin->options;\r\n\t\t$value['vbphrase'] =& $vbphrase;\r\n\t}\r\n\r\n\t$vbulletin->input->clean_array_gpc('r', array(\r\n\t\t'debug'         => TYPE_BOOL,\r\n\t\t'showall'       => TYPE_BOOL,\r\n\t));\r\n\r\n\t$callback = vB_APICallback::instance();\r\n\r\n\t$callback->setname('result_prewhitelist');\r\n\t$callback->addParamRef(0, $value);\r\n\t$callback->callback();\r\n\r\n\tif (!($vbulletin->debug AND $vbulletin->GPC['showall']))\r\n\t{\r\n\t\twhitelist_filter($value);\r\n\t}\r\n\r\n\t$callback->setname('result_overwrite');\r\n\t$callback->addParamRef(0, $value);\r\n\t$callback->callback();\r\n\r\n\tif ($vbulletin->debug AND $vbulletin->GPC['debug'])\r\n\t{\r\n\t\t$vartext = '<pre>'.htmlspecialchars(var_export($value, true)).'</pre>' . '<br />' . number_format((memory_get_usage() / 1024)) . 'KB';\r\n\t}\r\n\telse\r\n\t{\r\n\t\tglobal $stylevar;\r\n\t\t// json_encode requires utf-8\r\n\t\tif (!($charset = $stylevar['charset']))\r\n\t\t{\r\n\t\t\t$charset = $vbulletin->userinfo['lang_charset'];\r\n\t\t}\r\n\r\n\t\t$lower_charset = strtolower($charset);\r\n\t\tif ($lower_charset != 'utf-8')\r\n\t\t{\r\n\t\t\t// Browsers tend to interpret character set iso-8859-1 as windows-1252\r\n\t\t\tif ($lower_charset == 'iso-8859-1')\r\n\t\t\t{\r\n\t\t\t\t$lower_charset = 'windows-1252';\r\n\t\t\t}\r\n\t\t\tprocessregistered($value, $lower_charset);\r\n\t\t}\r\n\r\n\t\t$vartext = json_encode($value);\r\n\t}\r\n\t\r\n\t$output = process_replacement_vars($vartext);\r\n}\r\n\r\n// API Verification\r\nif (VB_API === true AND !headers_sent() AND $sendheader)\r\n{\r\n\tglobal $VB_API_REQUESTS;\r\n\tif (!in_array($VB_API_REQUESTS['api_m'], array('login_login', 'login_logout')))\r\n\t{\r\n\t\t$sign = md5($output . $vbulletin->apiclient['apiaccesstoken'] . $vbulletin->apiclient['apiclientid'] . $vbulletin->apiclient['secret'] . $vbulletin->options['apikey']);\r\n\t\t@header('Authorization: ' . $sign);\r\n\t}\r\n\r\n\tif (!$vbulletin->debug OR !$vbulletin->GPC['debug'])\r\n\t{\r\n\t\t//  JSON header\r\n\t\t@header('Content-Type: application/json');\r\n\t}\r\n}\r\n\r\nif ($vbulletin->options['gzipoutput'] AND !headers_sent())\r\n{\r\n\t$output = fetch_gzipped_text($output, $vbulletin->options['gziplevel']);\r\n\r\n\tif ($sendheader AND $vbulletin->donegzip)\r\n\t{\r\n\t\t@header('Content-Length: ' . strlen($output));\r\n\t}\r\n}\r\n\r\nif (defined('NOSHUTDOWNFUNC'))\r\n{\r\n\texec_shut_down();\r\n}\r\n\r\n// show regular page\r\nif (empty($vbulletin->db->explain) OR (defined('VB_API') AND VB_API === true))\r\n{\r\n\techo $output;\r\n}\r\n// show explain\r\nelseif (!VB_API)\r\n{\r\n\t$querytime = $vbulletin->db->time_total;\r\n\techo \"\\n<b>Page generated in $totaltime seconds with \" . $vbulletin->db->querycount . \" queries,\\nspending $querytime doing MySQL queries and \" . ($totaltime - $querytime) . \" doing PHP things.\\n\\n<hr />Shutdown Queries:</b>\" . (defined('NOSHUTDOWNFUNC') ? \" <b>DISABLED</b>\" : '') . \"<hr />\\n\\n\";\r\n}\r\n\r\n// broken if zlib.output_compression is on with Apache 2\r\nif (SAPI_NAME != 'apache2handler' AND SAPI_NAME != 'apache2filter')\r\n{\r\n\tflush();\r\n}\r\nexit;\r\nif (class_exists('vb_optimise'))\r\n{\r\n\tvb_optimise::finish_guestcache($output);\r\n}\r\n", 
  "editor_toolbar_switch": "if ($forumid == 'blog_user' OR $forumid == 'blog_entry')\r\n{\r\n\t$can_toolbar = ($vbulletin->userinfo['permissions']['vbblog_entry_permissions'] & $vbulletin->bf_ugp_vbblog_entry_permissions['blog_allowbbcode']) ? true : false;\r\n\t$show['img_bbcode'] = ($vbulletin->userinfo['permissions']['vbblog_entry_permissions'] & $vbulletin->bf_ugp_vbblog_entry_permissions['blog_allowimages']) ? true : false;\r\n}\r\nelse if ($forumid == 'blog_comment')\r\n{\r\n\t$can_toolbar = ($vbulletin->userinfo['permissions']['vbblog_comment_permissions'] & $vbulletin->bf_ugp_vbblog_comment_permissions['blog_allowbbcode']) ? true : false;\r\n\t$show['img_bbcode'] = ($vbulletin->userinfo['permissions']['vbblog_comment_permissions'] & $vbulletin->bf_ugp_vbblog_comment_permissions['blog_allowimages']) ? true : false;\r\n}\r\n", 
  "search_complete": "eval('$template_hook[inlinemod_thread_bottom] .= \" ' . fetch_template('forumdisplay_changethreadsowner_link') . '\";');\r\n\t\t\teval('$template_hook[inlinemod_post_bottom] .= \" ' . fetch_template('showthread_changepostsowner_link') . '\";');\r\n", 
  "archive_navigation": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('archive_navigation');\r\n", 
  "forumbit_display": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\teval('$cyb_apboupc_hide_info = in_array($forum[forumid], array(' . $vbulletin->options['apboupc_lastpost_forumids'] . '));');\r\n\r\n\t\t\tif ($vbulletin->options['showlocks'] AND substr($forum['statusicon'], -5) != '_lock')\r\n\t\t\t{\r\n\t\t\t\tif (($forum[accessf_nb] !='0') AND ($forum[accessf_nb] > $vbulletin->userinfo[posts]) AND (!in_array($vbulletin->userinfo['usergroupid'], array($cyb_apboupc_usrgrps_forum))))\r\n\t\t\t\t{\r\n\t\t\t\t\t$forum['statusicon'] .= '_lock';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((in_array($forum['forumid'], array($cyb_apboupc_hide_info)) OR $forum['accessf_nb']>$vbulletin->userinfo['posts']) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\t$forum['lastpostinfo'] = $vbphrase[apboupc_lastpostinfo];\t\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybsfa_enable'])\r\n\t\t{\r\n\t\t\teval('$cybsfa_exclfrms = in_array($forum[forumid], array(' . $vbulletin->options['cybsfa_excludedforums'] . '));');\r\n\r\n\t\t\tswitch ($vbulletin->options['cybsfa_switch'])\r\n\t\t\t{\r\n\t\t\t\tcase 1: $cybsfa_colnr = 2; $cybsfa_colw = \"100%\"; break;\r\n\t\t\t\tcase 2: $cybsfa_colnr = 3; $cybsfa_colw = \"50%\"; break;\r\n\t\t\t\tcase 3: $cybsfa_colnr = 4; $cybsfa_colw = \"33%\"; break;\r\n\t\t\t\tcase 4: $cybsfa_colnr = 5; $cybsfa_colw = \"25%\"; break;\r\n\t\t\t\tcase 5: $cybsfa_colnr = 6; $cybsfa_colw = \"20%\"; break;\r\n\t\t\t\tcase 6: $cybsfa_colnr = 7; $cybsfa_colw = \"16%\"; break;\r\n\t\t\t\tcase 7: $cybsfa_colnr = 8; $cybsfa_colw = \"14%\"; break;\r\n\t\t\t\tdefault: $cybsfa_colnr = 2; $cybsfa_colw = \"100%\"; break;\r\n\t\t\t}\r\n\r\n\t\t\tif ($vbulletin->options['cybsfa_tableattribs']!='')\r\n\t\t\t{\r\n\t\t\t\t$cybsfa_tableattrib = 'style=\"text-transform:none;'.$vbulletin->options[cybsfa_tableattribs].'\"';\r\n\t\t\t}\r\n\t\t\tif ($vbulletin->options['cybsfa_cellattribs']!='')\r\n\t\t\t{\r\n\t\t\t\t$cybsfa_cellattrib = 'style=\"text-transform:none;'.$vbulletin->options[cybsfa_cellattribs].'\"';\r\n\t\t\t}\r\n\r\n\t\t\t$cybsfa_getsubs = explode('&nbsp;',$forum[subforums]);\r\n\t\t\t$cybsfa_tbattr = '<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" align=\"center\" '.$cybsfa_tableattrib.'><tr valign=\"top\">';\r\n\r\n\t\t\t$cybsfa_cols = '0';\r\n\t\t\tforeach ($cybsfa_getsubs as $cybsfa_subf)\r\n\t\t\t{\r\n\t\t\t\t$cybsfa_cols++;\r\n\t\t\t\tif ($cybsfa_cols == $cybsfa_colnr)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybsfa_cols = '1';\r\n\t\t\t\t\t$cybsfa_tbattr .=  '</tr><tr>';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$cybsfa_tbattr .= '<td '.$cybsfa_cellattrib.' width=\"'.$cybsfa_colw.'\">'.$cybsfa_subf.'</td>';\r\n\t\t\t}\r\n\r\n\t\t\tif ($cybsfa_cols == '1')\r\n\t\t\t{\r\n\t\t\t\t$cybsfa_tbattr .= '<td '.$cybsfa_cellattrib.'>&nbsp;</td></tr></table>';\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cybsfa_tbattr .= '</tr></table>';\r\n\t\t\t}\r\n\r\n\t\t\tif (!in_array($forum['forumid'], array($cybsfa_exclfrms)))\r\n\t\t\t{\r\n\t\t\t\t$forum[subforums] = $cybsfa_tbattr;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tif ($vbulletin->options['cybsfa_affectexclforums'])\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybsfa_tbattr = '<table border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"100%\" '.$cybsfa_tableattrib.'><tr valign=\"top\"><td '.$cybsfa_cellattrib.'>'.$forum[subforums].'</td></tr></table>';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybsfa_tbattr = $forum[subforums];\r\n\t\t\t\t}\r\n\t\t\t\t$forum[subforums] = $cybsfa_tbattr;\r\n\t\t\t}\r\n\t\t}\r\n\r\n$vbpua_lasthook='forumbit_display';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "album_start_precheck": "\r\n\t\t if (($vbulletin->options['apboupc_pictures_viewalbums']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_pictures_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_pictures_viewalbums'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_view_picalbums', intval($vbulletin->options['apboupc_pictures_viewalbums']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n\r\n$vbpua_lasthook='album_start_precheck';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "admindata_start": "\r\n\t\t\t\t$this->validfields['canadminangularadver'] = array(TYPE_BOOL, REQ_NO);\r\n\t\t\t\r\n$this->validfields['blogpermissions'] = array(TYPE_UINT, REQ_NO);\r\n", 
  "style_fetch": "// Do not cache logged in user pages\r\n\r\nif ( $vbulletin->userinfo['userid'] || $vbulletin->options[\"mob_detected_device_name\"])\r\n{\r\n        //header('X-Accel-Expires: 0');\r\n        header('X-LiteSpeed-Cache-Control: no-cache');\r\n        //header('X-LiteSpeed-Cache-Control: private');\r\n} else {\r\n\r\n        //header('X-LiteSpeed-Cache-Control: max-age=600');\r\n}\r\n\r\n\r\n#if ($_SERVER[REMOTE_ADDR]==\"67.52.18.100\") {\r\n#var_dump(headers_list());\r\n#exit;\r\n\r\n#}\r\nif (defined('VBBLOG_STYLE') AND $vbulletin->options['vbblog_style'])\r\n{\r\n\t$styleid = $vbulletin->options['vbblog_style'];\r\n\t$vbulletin->userinfo['styleid'] = $styleid;\r\n\t$userselect = true;\r\n\t$vbulletin->options['allowchangestyles'] = false;\r\n}\r\nif (VB_API === true)\r\n{\r\n\t$styleid = -2;\r\n\t$vbulletin->options['styleid'] = -2;\r\n}\r\nif ($vbulletin->options['mob_detect_enabled'] == 1)\r\n  {\r\n  $mobile=0;\r\n  $pda=0;\r\n  $ipod=0;\r\n  $except_browser=0;\r\n  $custom1=0;\r\n\r\n  if ($vbulletin->options['brows_exceptions_enabled'] == 1)\r\n  {\r\n  $exceptbrowsers = explode(\",\",$vbulletin->options['brows_exceptions']);\r\n  if(preg_match('/('.implode('|', $exceptbrowsers).')/i', $_SERVER['HTTP_USER_AGENT'], $match))\r\n    {\r\n        $except_browser=1;\r\n    }\r\n  }\r\n\r\n\r\n\r\n  if ($except_browser==0)\r\n  {\r\n    if ($vbulletin->options['custom1_skin_enabled'] == 1)\r\n    {\r\n    $custom1agents = explode(\",\",$vbulletin->options['custom1_skin_agent']);\r\n    if(preg_match('/('.implode('|', $custom1agents).')/i', $_SERVER['HTTP_USER_AGENT'], $match))\r\n      {\r\n          $custom1=1;\r\n      }\r\n    }\r\n\r\n    if ($vbulletin->options['pda_skin_enabled'] == 1 && $custom1==0) \r\n    {\r\n      $pdabrowsers = array(\r\n          \"Windows CE\"\r\n          );\r\n    if(preg_match('/('.implode('|', $pdabrowsers).')/i', $_SERVER['HTTP_USER_AGENT'], $match))\r\n      {\r\n        $pda=1;\r\n      }\r\n      else if (isset($_SERVER['HTTP_UA_OS']))\r\n      {\r\n      if (strstr($_SERVER['HTTP_UA_OS'],\"POCKET PC\") !== false)\r\n        {\r\n\t  $pda=1;\r\n        }\r\n      }\r\n    }\r\n\r\n    if ($vbulletin->options['ipod_skin_enabled'] == 1 && $custom1==0) \r\n    {\r\n      $ipodbrowsers = array(\r\n          \"iPod\",\r\n          \"iPhone\"\r\n          );\r\n      if(preg_match('/('.implode('|', $ipodbrowsers).')/i', $_SERVER['HTTP_USER_AGENT'], $match))\r\n      {\r\n        $ipod=1;\r\n      }\r\n    }\r\n\r\n\r\n    if ($pda == 0 && $ipod ==0 && $custom1==0)\r\n    {\r\n      if ($vbulletin->options['mobile_skin_enabled'] == 1) \r\n      {\r\n      $mobilebrowsers = array(\r\n        \"WebTV\",\r\n        \"AvantGo\",\r\n        \"Blazer\",\r\n        \"PalmOS\",\r\n        \"lynx\",\r\n        \"Go.Web\",\r\n        \"Elaine\",\r\n        \"ProxiNet\",\r\n        \"ChaiFarer\",\r\n        \"Digital Paths\",\r\n        \"UP.Browser\",\r\n        \"Mazingo\",\r\n        \"iPhone\",\r\n        \"iPod\",\r\n        \"Mobile\",\r\n        \"T68\",\r\n        \"Syncalot\",\r\n        \"Danger\",\r\n        \"Symbian\",\r\n        \"Symbian OS\",\r\n        \"SymbianOS\",\r\n        \"Maemo\",\r\n        \"Nokia\",\r\n        \"Xiino\",\r\n        \"AU-MIC\",\r\n        \"EPOC\",\r\n        \"Wireless\",\r\n        \"Handheld\",\r\n        \"Smartphone\",\r\n        \"SAMSUNG\",\r\n        \"J2ME\",\r\n        \"MIDP\",\r\n        \"MIDP-2.0\",\r\n        \"320x240\",\r\n        \"240x320\",\r\n        \"Blackberry8700\",\r\n        \"Opera Mini\",\r\n        \"NetFront\",\r\n        \"BlackBerry\",\r\n        \"PSP\"\r\n        );\r\n \r\n        if(preg_match('/('.implode('|', $mobilebrowsers).')/i', $_SERVER['HTTP_USER_AGENT'], $match))\r\n        {\r\n          $mobile=1;\r\n        }\r\n        elseif (strpos($_SERVER['HTTP_ACCEPT'], 'application/vnd.wap.xhtml+xml'))\r\n        {\r\n          $mobile=1;\r\n        }\r\n        elseif (strpos($_SERVER['HTTP_ACCEPT'], 'text/vnd.wap.wml'))\r\n        {\r\n          $mobile=1;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if ($mobile==1)\r\n  {\r\n    //      echo \"<!-- Mobile Device -->\";\r\n    $styleid=$vbulletin->options['mobile_skin'];\r\n  }\r\n  else if ($pda==1)\r\n  {\r\n    //      echo \"<!-- PDA Device -->\";\r\n    $styleid=$vbulletin->options['pda_skin'];\r\n  }\r\n  else if ($ipod==1)\r\n  {\r\n    //      echo \"<!-- IPOD Device -->\";\r\n    $styleid=$vbulletin->options['ipod_skin'];\r\n  }\r\n  else if ($custom1==1)\r\n  {\r\n    //      echo \"<!-- CUSTOM1 Device -->\";\r\n    $styleid=$vbulletin->options['custom1_skin'];\r\n  }\r\n  else if ($except_browser==1)\r\n  {\r\n    //      echo \"<!-- Excepted Device -->\";\r\n  }\r\n  else\r\n  {\r\n    //      echo \"<!-- No Mobile Device-->\";\r\n  }\r\n}\r\nvb_optimise::cache('style', $style, $styleid, $userselect);\r\n", 
  "forumdisplay_query": "\r\n\t\t\t\t$vbppt_lasthook='forumdisplay_query';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n$hook_query_fields .= \", isurlredirect \";\r\n", 
  "userdata_delete": "$vbulletin =& $this->registry;\r\nrequire_once(DIR . '/includes/blog_functions.php');\r\n\r\n$userdm =& datamanager_init('Blog_User', $this->registry, ERRTYPE_SILENT);\r\n$existing = array('bloguserid' => $this->existing['userid']);\r\n$userdm->set_existing($existing);\r\n$userdm->delete();\r\nunset($userdm);\r\nrequire_once(DIR . '/includes/functions_post_thanks.php');\r\n$thanks = $this->dbobject->query_read(\"\r\n\tSELECT *\r\n\tFROM \" . TABLE_PREFIX . \"post_thanks\r\n\tWHERE userid = '\".$this->existing['userid'].\"'\r\n\tORDER BY postid\r\n\");\r\n\r\nwhile ($thank = $this->dbobject->fetch_array($thanks))\r\n{\r\n\t$postinfo = fetch_postinfo($thank['postid']);\r\n\tdelete_thanks($postinfo, $this->existing['userid'], false);\r\n}\r\nvBSEO_Storage::user_deleted($this->existing);\r\n", 
  "editor_toolbar_end": "if (VB_API === true)\r\n{\r\n\t// got to parse the message to be displayed from bbcode into HTML\r\n\tif ($text !== '')\r\n\t{\r\n\t\trequire_once(DIR . '/includes/functions_wysiwyg.php');\r\n\t\t$newpost['message'] = parse_wysiwyg_html($text, $ishtml, $forumid, iif($allowsmilie AND $parsesmilie, 1, 0));\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$newpost['message'] = '';\r\n\t}\r\n\r\n\t$newpost['message'] = htmlspecialchars($newpost['message']);\r\n\r\n\tif ($ishtml)\r\n\t{\r\n\t\t$newpost['message_bbcode'] = convert_wysiwyg_html_to_bbcode($text);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$newpost['message_bbcode'] = $text;\r\n\t}\r\n}\r\n\r\n// check that $editor_css has been built\r\nif (!isset($GLOBALS['editor_css']))\r\n{\r\n\teval('$GLOBALS[\\'editor_css\\'] = \"' . fetch_template('editor_css') . '\";');\r\n\t$GLOBALS['headinclude'] .= \"<!-- Editor CSS automatically added by \" . substr(strrchr(__FILE__, DIRECTORY_SEPARATOR), 1) . \" at line \" . __LINE__ . \" -->\\n\" . $GLOBALS['editor_css'];\r\n}\r\n\r\neval('$vBeditTemplate[\\'clientscript\\'] = \"' . fetch_template('editor_clientscript') . '\";');\r\n\r\n$ajax_extra = addslashes_js($ajax_extra);\r\n$editortype = ($toolbartype == 2 ? 1 : 0);\r\n$show['is_wysiwyg_editor'] = intval($editortype);\r\neval('$messagearea = \"' . fetch_template($editor_template_name, 0, true, false, array('newpost.message_bbcode')) . '\";');\r\n\r\nreturn $editorid;\r\n", 
  "newthread_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif ($vbulletin->userinfo['userid'] AND ($forumperms & $vbulletin->bf_ugp_forumpermissions['canpostnew']) AND ($foruminfo[create_nb] !='0') AND ($foruminfo[create_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_create', intval($foruminfo['create_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\nif ($foruminfo[forumid]==17) {\r\n$showtermsconditions = 1;\r\n}\r\n", 
  "postdata_start": "$this->validfields['strikes'] = array(TYPE_UINT, REQ_NO);\r\n", 
  "album_picture": "$pictureurl = create_full_url(\"picture.php?\"  . $vbulletin->session->vars['sessionurl'] . \"albumid=$albuminfo[albumid]&pictureid=$pictureinfo[pictureid]\");\r\nif (!preg_match('#^[a-z]+://#i', $pictureurl))\r\n{\r\n\t$pictureurl = $vbulletin->options['bburl'] . \"/picture.php?albumid=$albuminfo[albumid]&pictureid=$pictureinfo[pictureid]\";\r\n\r\n}\r\nif (!VB_API)\r\n{\r\n\t$pictureinfo['pictureurl'] = htmlspecialchars_uni($pictureurl);\r\n}\r\nelse\r\n{\r\n\t$pictureinfo['pictureurl'] = $pictureurl;\r\n}\r\n", 
  "register_activate_process": "$wauth_lasthook='register_activate_process';\r\ninclude(DIR.'/includes/wauth_hooks.php');\r\n", 
  "archive_postheader": "\r\n\t\t\tif ($vbulletin->options['angadver_enabled'])\r\n\t\t\t{\t\t\t\t\r\n\t\t\t\t// make the advertisement variable\r\n\t\t\t\tif (!empty($vbulletin->angadvercache) AND is_array($vbulletin->angadvercache))\r\n\t\t\t\t{\r\n\t\t\t\t\t$angadvers = '';\r\n\t\t\t\t\trequire_once(DIR . '/includes/functions_angadver.php');\r\n\t\t\t\t\tforeach (construct_fit_angular_advertisement() AS $advertisementid)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tconstruct_angular_advertisement($advertisementid, $angadvers);\t\r\n\t\t\t\t\t}\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tif ($angadvers)\r\n\t\t\t\t{\r\n\t\t\t\t\t$lookfor = array('</head>', '<body>');\r\n\t\t\t\t\t$replace[] = '\t<link rel=\"stylesheet\" type=\"text/css\" href=\"' . $vbulletin->options['bburl'] . '/archive/angularadvertisement' . (is_browser('ie', '6') ? '_ie6' : '') . '.css\" />' . $lookfor[0];\r\n\t\t\t\t\t$replace[] = $lookfor[1] . \"$angadvers\";\r\n\t\t\t\t\t$output = str_replace($lookfor, $replace, $output);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\r\n$vbpua_lasthook='archive_postheader';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "blog_list_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_list_complete');\r\n", 
  "blog_fpdata_presave": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_fpdata_presave');\r\n", 
  "newpost_notification_message": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tglobal $foruminfo;\r\n\t\t\tif ($foruminfo[linkview_nb] > $touser[posts])\r\n\t\t\t{\r\n\t\t\t\t$cyb_apboupc_viewlinkspatte = array('!<a[^>]*(http|www|mailto)(.*)</a>|(http:\\/\\/)?www(.*)[\\s]\\b|<img(.*)(</img>|\\/>)|\\b[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!siU',\r\n\t\t\t\t\t\t\t\t'/\\\\[(url|email|img)(.*)\\\\[\\/(url|email|img)\\\\]/siU');\r\n\t\t\t\t$pagetext = preg_replace($cyb_apboupc_viewlinkspatte, '<link> ', $pagetext.' ');\r\n\t\t\t}\r\n\t\t}\r\n", 
  "profile_updatepassword_complete": "$wauth_lasthook='profile_updatepassword_complete';\r\ninclude(DIR.'/includes/wauth_hooks.php');\r\n", 
  "blog_comment_display_complete": "if(class_exists(vBSEO_UI))\r\n{\r\n\tvBSEO_UI::blog_comment_hook($this);\r\n}\r\n", 
  "forumhome_complete": "if (is_array($vbulletin->blogstats) AND $vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canviewothers'])\r\n{\r\n    if ($latestentry = $vbulletin->blogstats['lastentry'])\r\n    {\r\n        require_once(DIR . '/includes/blog_functions_shared.php');\r\n        prepare_blog_category_permissions($vbulletin->userinfo);\r\n\r\n        if ($vbulletin->userinfo['userid'] OR $latestentry['guestcanview'])\r\n        {\r\n            $entrycats = explode(',', $latestentry['categories']);\r\n            if (array_intersect($vbulletin->userinfo['blogcategorypermissions']['cantview'], $entrycats) AND $vbulletin->userinfo['userid'] != $latestentry['userid'])\r\n            {\r\n                $latestentry = fetch_latest_entry($vbulletin->userinfo);\r\n            }\r\n            else if ($vbulletin->userinfo['userid'] == $latestentry['userid'] AND !($vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canviewown']))\r\n            {\r\n                $latestentry = fetch_latest_entry($vbulletin->userinfo);\r\n            }\r\n            else if (in_coventry($latestentry['userid']) AND $vbulletin->userinfo['userid'] != $latestentry['userid'])\r\n            {\r\n                $latestentry = fetch_latest_entry($vbulletin->userinfo);\r\n            }\r\n        }\r\n        else if ($latestentry = $vbulletin->blogstats['lastentry_guest'])\r\n        {\r\n            // oh do nothing, we just wanted the assignment ;)\r\n        }\r\n    }\r\n\r\n    if ($latestentry['userid'] != $latestentry['postedby_userid'] OR !empty($latestentry['blogtitle']))\r\n    {\r\n        $show['blogtitle'] = true;\r\n        if (empty($latestentry['blogtitle']))\r\n        {\r\n                $latestentry['blogtitle'] = $latestentry['username'];\r\n        }\r\n    }\r\n\r\n    $blogstats['total_blog_users'] = vb_number_format($vbulletin->blogstats['total_blog_users']);\r\n    $blogstats['total_blog_entries'] = vb_number_format($vbulletin->blogstats['total_blog_entries']);\r\n    $blogstats['entries_in_24hours'] = vb_number_format($vbulletin->blogstats['entries_in_24hours']);\r\n\r\n    eval('$template_hook[\\'forumhome_wgo_stats\\'] .= \"' . fetch_template('blog_forumhome_stats') . '\";');\r\n}\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('forumhome_complete');\r\n\r\n$vbpua_lasthook='forumhome_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif ($vbulletin->options['vbo_online'] && $vbulletin->options['vbo_showresource'])\r\n{\r\n\tif (!class_exists('vB_Template'))\r\n\t{\r\n\t\trequire_once(DIR . '/vboptimise/core/class_vboptimise_template.php');\r\n\t}\r\n\r\n\t$vbo = vB_Template::create('forumhome_vbo');\r\n\t$vbo->register('num', isset($vbulletin->vbo_resource_savings) ? vb_number_format($vbulletin->vbo_resource_savings) : 0);\r\n\r\n\t$template_hook[\"forumhome_wgo_stats\"] .= str_replace('{vb:raw num}', isset($vbulletin->vbo_resource_savings) ? vb_number_format($vbulletin->vbo_resource_savings) : 0, $vbo->render());\r\n}\r\n", 
  "album_picture_upload_complete": "if (VB_API === true)\r\n{\r\n\tif (!$moderatedpictures AND $pictureids AND !$albuminfo['coverpictureid'])\r\n\t{\r\n\t\t// no cover -> set cover to the first pic uploaded\r\n\t\t$db->query_write(\"\r\n\t\t\tUPDATE \" . TABLE_PREFIX . \"album SET\r\n\t\t\t\tcoverpictureid = \" . reset($pictureids) . \"\r\n\t\t\tWHERE albumid = $albuminfo[albumid]\r\n\t\t\");\r\n\t}\r\n\r\n\t// Build custom JSON response\r\n\t$attachments = array();\r\n\t$i = 0;\r\n\tforeach ($uploads AS $uploadid => $uploadinfo)\r\n\t{\r\n\t\tif ($pictureids[\"$uploadid\"])\r\n\t\t{\r\n\t\t\t$attachments[$i]['attach']['attachmentid'] = $pictureids[\"$uploadid\"];\r\n\t\t\t$attachments[$i]['attach']['filename'] = $uploads[\"$uploadid\"]['name'];\r\n\t\t\t$i++;\r\n\t\t}\r\n\t}\r\n\r\n\tif (count($attachments) == 1)\r\n\t{\r\n\t\t$attachments = $attachments[0];\r\n\t}\r\n\r\n\t$response['response']['attachments'] = $attachments;\r\n\t$output = @json_encode($response);\r\n\t\r\n\t$sign = md5($output . $vbulletin->apiclient['apiaccesstoken'] . $vbulletin->apiclient['apiclientid'] . $vbulletin->apiclient['secret'] . $vbulletin->options['apikey']);\r\n\t@header('Authorization: ' . $sign);\r\n\t\r\n\techo $output;\r\n\texit;\r\n\t\r\n}\r\n", 
  "editor_toolbar_start": "if ($text)\r\n{\r\nrequire_once(DIR . '/includes/ame_bbcode.php');\r\n$text = ame_strip($text);\r\n}\r\n", 
  "postbit_attachment": "$url = create_full_url(\"attachment.php?{$this->registry->session->vars['sessionurl']}attachmentid=$attachment[attachmentid]&d=$attachment[dateline]\");\r\n$imageurl = create_full_url(\"attachment.php?{$this->registry->session->vars['sessionurl']}attachmentid=$attachment[attachmentid]&stc=1&d=$attachment[dateline]\");\r\n$thumburl = create_full_url(\"attachment.php?{$this->registry->session->vars['sessionurl']}attachmentid=$attachment[attachmentid]&stc=1&thumb=1&d=$attachment[thumbnail_dateline]\");\r\nif ($this->registry->options['attachthumbs'])\r\n{\r\n\tif ($attachment['hasthumbnail'])\r\n\t{\r\n\t\t$pictureurl =& $thumburl;\r\n\t}\r\n\telse if (!in_array($attachment['attachmentextension'], array('tiff', 'tif', 'psd', 'pdf')) AND $attachment['forceimage'])\r\n\t{\r\n\t\t$pictureurl =& $imageurl;\r\n\t}\r\n}\r\nelse if (!in_array($attachment['attachmentextension'], array('tiff', 'tif', 'psd', 'pdf')) AND ($this->registry->options['viewattachedimages'] == 1 OR ($this->registry->options['viewattachedimages'] == 2 AND $attachcount == 1)))\r\n{\r\n\t$pictureurl =& $imageurl;\r\n}\r\n", 
  "private_newpm_start": "\r\n  \t\t\t \r\n\t\t\t\t$find = '<legend>$vbphrase[recipients]</legend>';\r\n\t\t\t\t$replace = '$pm_stopm';\r\n\t\t\t\t$vbulletin->templatecache['pm_newpm'] = str_replace($find, $replace . $find,  $vbulletin->templatecache['pm_newpm']);\r\n  \t\t\t \r\n\t\t\t\r\n", 
  "threadfpdata_presave": "\r\n\t\tif ($this->registry->options['apboupc_global_enable'] AND $this->registry->options['apboupc_postlinks'])\r\n\t\t{\r\n\t\t\tglobal $vbulletin;\r\n\t\t\t$foruminfo = $this->info['forum'];\r\n\t\t\t$pagetext =& $this->fetch_field('pagetext', 'post');\r\n\r\n\t\t\tif ($this->registry->userinfo['userid'] AND ($foruminfo[linkpost_nb] !='0') AND ($this->registry->userinfo[posts] < $foruminfo[linkpost_nb]) AND !is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_postlinks_excl_groups'])) AND (stristr($pagetext,'[url') OR stristr($pagetext,'[URL') OR stristr($pagetext,'www.') OR stristr($pagetext,'http://')))\r\n\t\t\t{\r\n\t\t\t\t$this->error('error_postcount_too_low_post_links', $foruminfo[linkpost_nb], $this->registry->userinfo[posts]);\r\n\t\t\t}\r\n\t\t\tif ($this->registry->userinfo['userid'] AND $this->registry->options['apboupc_postlinks_incmail'] AND ($foruminfo[linkpost_nb] !='0') AND ($this->registry->userinfo[posts] < $foruminfo[linkpost_nb]) AND !is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_postlinks_excl_groups'])) AND (stristr($pagetext,'[email') OR stristr($pagetext,'[EMAIL') OR stristr($pagetext,'[EMail') OR stristr($pagetext,'[Email')))\r\n\t\t\t{\r\n\t\t\t\t$this->error('error_postcount_too_low_post_emails', $foruminfo[linkpost_nb], $this->registry->userinfo[posts]);\r\n\t\t\t}\r\n\t\t}\r\n", 
  "forumdata_start": "\r\n\t\t$this->validfields['accessf_nb'] = array(TYPE_INT, REQ_NO);\r\n\t\t$this->validfields['accesst_nb'] = array(TYPE_INT, REQ_NO);\r\n\t\t$this->validfields['create_nb'] = array(TYPE_INT, REQ_NO);\r\n\t\t$this->validfields['reply_nb'] = array(TYPE_INT, REQ_NO);\r\n\t\t$this->validfields['attach_nb'] = array(TYPE_INT, REQ_NO);\r\n\t\t$this->validfields['linkview_nb'] = array(TYPE_INT, REQ_NO);\r\n\t\t$this->validfields['linkpost_nb'] = array(TYPE_INT, REQ_NO);\r\n\r\n$this->validfields['vbseo_enable_likes'] = array(TYPE_INT, REQ_NO);\r\n$this->validfields['vbseo_moderatepingbacks'] = array(TYPE_INT, REQ_NO);\r\n$this->validfields['vbseo_moderatetrackbacks'] = array(TYPE_INT, REQ_NO);\r\n$this->validfields['vbseo_moderaterefbacks'] = array(TYPE_INT, REQ_NO);\r\n$this->validfields['ada_forum'] = array(TYPE_INT, REQ_NO);\r\n$this->validfields['ada_style'] = array(TYPE_INT, REQ_NO);\r\n", 
  "editpost_edit_ajax": "$hook_query_fields .= \",blog_user.entries\";\r\n$hook_query_joins .= \"LEFT JOIN \" . TABLE_PREFIX . \"blog_user AS blog_user ON (blog_user.bloguserid = post.userid)\";\r\n", 
  "editor_switch_wysiwyg_to_standard": "if ($vbulletin->GPC['parsetype'] == 'blog_user' OR $vbulletin->GPC['parsetype'] == 'blog_entry')\r\n{\r\n\t$dohtml = ($vbulletin->userinfo['permissions']['vbblog_entry_permissions'] & $vbulletin->bf_ugp_vbblog_entry_permissions['blog_allowhtml']);\r\n}\r\nelse if ($vbulletin->GPC['parsetype']== 'blog_comment')\r\n{\r\n\t$dohtml = ($vbulletin->userinfo['permissions']['vbblog_entry_permissions'] & $vbulletin->bf_ugp_vbblog_comment_permissions['blog_allowhtml']);\r\n}\r\n", 
  "group_dojoin": "\r\n\t\t if (($vbulletin->options['apboupc_groups_joingroups']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_groups_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_groups_joingroups'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_join_groups', intval($vbulletin->options['apboupc_groups_joingroups']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "bbcode_parse_start": "if (!empty($this->parse_userinfo['permissions']))\r\n{\r\n\tswitch($forumid)\r\n\t{\r\n\t\tcase 'blog_entry':\r\n\t\tcase 'blog_user':\r\n\t\t\t$dohtml = ($this->parse_userinfo['permissions']['vbblog_entry_permissions'] & $this->registry->bf_ugp_vbblog_entry_permissions['blog_allowhtml']);\r\n\t\t\t$dobbcode = ($this->parse_userinfo['permissions']['vbblog_entry_permissions'] & $this->registry->bf_ugp_vbblog_entry_permissions['blog_allowbbcode']);\r\n\t\t\t$dobbimagecode = ($this->parse_userinfo['permissions']['vbblog_entry_permissions'] & $this->registry->bf_ugp_vbblog_entry_permissions['blog_allowimages']);\r\n\t\t\t$dosmilies = ($allowsmilie AND ($this->parse_userinfo['permissions']['vbblog_entry_permissions'] & $this->registry->bf_ugp_vbblog_entry_permissions['blog_allowsmilies']));\r\n\t\t\tbreak;\r\n\t\tcase 'blog_comment':\r\n\t\t\t$dohtml = ($this->parse_userinfo['permissions']['vbblog_comment_permissions'] & $this->registry->bf_ugp_vbblog_comment_permissions['blog_allowhtml']);\r\n\t\t\t$dobbcode = ($this->parse_userinfo['permissions']['vbblog_comment_permissions'] & $this->registry->bf_ugp_vbblog_comment_permissions['blog_allowbbcode']);\r\n\t\t\t$dobbimagecode = ($this->parse_userinfo['permissions']['vbblog_comment_permissions'] & $this->registry->bf_ugp_vbblog_comment_permissions['blog_allowimages']);\r\n\t\t\t$dosmilies = ($allowsmilie AND ($this->parse_userinfo['permissions']['vbblog_comment_permissions'] & $this->registry->bf_ugp_vbblog_comment_permissions['blog_allowsmilies']));\r\n\t\t\tbreak;\r\n\t}\r\n}\r\nif (VB_API === true)\r\n{\r\n\treturn $this->do_parse($text, $dohtml, $dosmilies, $dobbcode, $dobbimagecode, $donl2br, $cachable);\r\n}\r\nglobal $post;\r\n$perms =& $post['permissions'];\r\nif (!$perms)\r\n{\r\n    $perms = fetch_permissions(0, $post['userid'], $post); \r\n}\r\n// Was this post made by an allowed Usergroup member?\r\nif ($perms['allowhtmlpermissions'] & $this->registry->bf_ugp_allowhtmlpermissions['canposthtml'])\r\n{\r\n    // This is an allowed post so parse HTML.\r\n    $dohtml = '1';\r\n}\r\n", 
  "showthread_postbit_create": "global $vbseo_gcache;\r\n\r\n$vbseo_gcache['user'][$post['userid']] = array(\r\n'userid'=>$post['userid'],\r\n'username'=>$post['username']\r\n);\r\n\r\n$post['show_ezsocial_links'] = false;\t\t\r\nif($vbulletin->options['EZsociallinks_enable'] && $vbulletin->options['EZsociallinks_pbenable'] && THIS_SCRIPT == 'showthread')\r\n\t$post['show_ezsocial_links'] = true;\r\n\r\nif ($forum['ada_forum'] AND $vbulletin->GPC['pagenumber'] > 1)\r\n{\r\n    if ($post['postid'] == $thread['firstpostid'])\r\n    {\r\n        $counter--;\r\n        $post['postcount'] = '';\r\n    }\r\n    else\r\n    {\r\n        $post['postcount']--;\r\n    }\r\n}\r\n\r\n$vbpua_lasthook='showthread_postbit_create';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif (VB_API === true)\r\n{\r\n\t$counter = 0;\r\n}\r\n", 
  "mail_send": "\r\n\t\t\t\t$vbppt_lasthook='mail_send';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n@include_once(DIR . '/vbseo/includes/functions_vbseo.php');\r\n\r\n$GLOBALS['VBSEO_REWRITE_TEXTURLS'] = 1;\r\n\r\nif(function_exists('make_crawlable') && VBSEO_REWRITE_EMAILS)\r\n $message = make_crawlable($message);\r\n\r\nunset($GLOBALS['VBSEO_REWRITE_TEXTURLS']);\r\n", 
  "threadmanage_start": "if ($_REQUEST['do'] == 'bump')\r\n{\r\n\t$handeled_do = true;\r\n\r\n\tif (!$foruminfo['forumid'])\r\n\t{\r\n\t\teval(standard_error(fetch_error('invalidid', $vbphrase['forum'], $vbulletin->options['contactuslink'])));\r\n\t}\r\n\r\n\tif (!$threadinfo['threadid'])\r\n\t{\r\n\t\teval(standard_error(fetch_error('invalidid', $vbphrase['thread'], $vbulletin->options['contactuslink'])));\r\n\t}\r\n\t\t\t\r\n\t$ugroups = explode(',',$vbulletin->options['skm_threadbump_displaygroups']); \r\n\r\n\tif (is_member_of($vbulletin->userinfo,$ugroups) OR $ugroups[0] == 0) \r\n\t{\r\n\t\t$sortfield = $foruminfo['defaultsortfield'];\r\n\r\n\t\tswitch ($sortfield)\r\n\t\t{\r\n\t\t\tcase 'lastpost':\r\n\t\t\t\t$vbulletin->db->query_write(\"\r\n\t\t\t\t\tUPDATE \" . TABLE_PREFIX . \"thread SET \r\n\t\t\t\t\t\tlastpost = \" . TIMENOW . \"      \r\n\t\t\t\t\tWHERE threadid = $threadinfo[threadid]\r\n\t\t\t\t\");\r\n\r\n\t\t\t\t$vbulletin->url = \"forumdisplay.php?\" . $vbulletin->session->vars['sessionurl'] . \"f=\" . $foruminfo['forumid'];\r\n\t\t\t\teval(print_standard_redirect('redirect_bump'));\r\n\t\t\t\r\n\t\t\tcase 'dateline':\r\n\t\t\t\t$vbulletin->db->query_write(\"\r\n\t\t\t\t\tUPDATE \" . TABLE_PREFIX . \"thread SET \r\n\t\t\t\t\t\tdateline = \" . TIMENOW . \"      \r\n\t\t\t\t\tWHERE threadid = $threadinfo[threadid]\r\n\t\t\t\t\");\r\n\r\n\t\t\t\t$vbulletin->url = \"forumdisplay.php?\" . $vbulletin->session->vars['sessionurl'] . \"f=\" . $foruminfo['forumid'];\r\n\t\t\t\teval(print_standard_redirect('redirect_bump'));\r\n\t\t\t\r\n\t\t\tdefault:\r\n\t\t\t\teval(standard_error('Sorry, the options used for thread display won\\'t ever properly show a thread as bumped.   Please change the sort options of this forum to either last post or thread start'));\r\n\t\t}\r\n\t}\r\n\r\n\telse {\r\n\t\tprint_no_permission();\r\n\t}\r\n}\r\nif ($_REQUEST['do'] == 'editthread' AND $threadinfo['open'] != 10) {\r\n$vbulletin->templatecache['threadadmin_editthread'] = str_replace('$posticons','\t\t<fieldset class=\\\"fieldset\\\">\r\n\t\t\t<legend>$vbphrase[redirect_threads_to_url]</legend>\r\n\t\t\t<div style=\\\"padding:$stylevar[formspacer]px\\\">\r\n\t\t\t\t<div class=\\\"fieldset\\\">\r\n\t\t\t\t\t$vbphrase[redirect_threads_to_url_link]<br />\r\n\t\t\t\t\t<input type=\\\"text\\\" class=\\\"bginput\\\" name=\\\"isurlredirect\\\" value=\\\"$threadinfo[isurlredirect]\\\" size=\\\"50\\\" maxlength=\\\"250\\\" title=\\\"$vbphrase[optional]\\\" />\r\n\t\t\t\t</div>\r\n\r\n\t\t\t</div>\r\n\t\t</fieldset>\r\n\t\t\r\n\t\t$posticons',$vbulletin->templatecache['threadadmin_editthread']);\r\n}\r\n", 
  "xml_print_output": "if(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\n{\r\n\tdefine('VBSEO_AJAX', 1);\r\n\t$this->doc = vbseo_output_handler($this->doc, true);\r\n}\r\n", 
  "member_profileblock_fetch_unwrapped": "if (($userinfo['canviewmyblog'] AND $userinfo['userid'] != $this->registry->userinfo['userid'] AND $this->registry->userinfo['permissions']['vbblog_general_permissions'] & $this->registry->bf_ugp_vbblog_general_permissions['blog_canviewothers'])\r\n\t\t\tOR\r\n\t\t($userinfo['userid'] == $this->registry->userinfo['userid'] AND $this->registry->userinfo['permissions']['vbblog_general_permissions'] & $this->registry->bf_ugp_vbblog_general_permissions['blog_canviewown']))\r\n{\r\n\tif ($id == 'stats_mini')\r\n\t{\r\n\t\t$this->profile->prepared['blog_entries'] = $prepared['blog_entries'] = vb_number_format($userinfo['entries']);\r\n\t\teval('$template_hook[\\'profile_ministats_list\\'] .= \"' . fetch_template('blog_member_ministats') . '\";');\r\n\t}\r\n\telse if ($id == 'stats')\r\n\t{\r\n\t\t$show['lastentry'] = true;\r\n\t\t$userinfo['entries'] = vb_number_format($userinfo['entries']);\r\n\t\tif (!in_coventry($userinfo['userid']) AND $userinfo['lastblog'])\r\n\t\t{\r\n\t\t\t$userinfo['lastblogdate'] = vbdate($this->registry->options['dateformat'], $userinfo['lastblog']);\r\n\t\t\t$userinfo['lastblogtime'] = vbdate($this->registry->options['timeformat'], $userinfo['lastblog'], true);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$userinfo['lastblogtitle'] = '';\r\n\t\t\t$userinfo['lastblogdate'] = $vbphrase['never'];\r\n\t\t\t$userinfo['lastblogtime'] = '';\r\n\t\t}\r\n\t\teval('$template_hook[\\'profile_stats_pregeneral\\'] .= \"' . fetch_template('blog_member_stats') . '\";');\r\n\t}\r\n}\r\nif ($this->registry->options[post_thanks_show_stats_profile])\r\n{\r\n\t$userinfo['post_thanks_user_amount_formatted'] = vb_number_format($userinfo['post_thanks_user_amount']);\r\n\t$userinfo['post_thanks_thanked_times_formatted'] = vb_number_format($userinfo['post_thanks_thanked_times']);\r\n\t$userinfo['post_thanks_thanked_posts_formatted'] = vb_number_format($userinfo['post_thanks_thanked_posts']);\r\n\r\n\teval('$template_hook[profile_stats_pregeneral] .= \"' . fetch_template('post_thanks_memberinfo_block') . '\";');\r\n}\r\n", 
  "threadmanage_merge_complete": "if(defined('VBSEO_ENABLED') && VBSEO_ENABLED && VBSEO_LIKE_POST)\r\n{\r\n\tvbseo_extra_inc('ui');\r\n\tvBSEO_UI::move_likes($mergethreadinfo['threadid'], $threadinfo['threadid'], VBSEO_UI_THREAD);\r\n}\r\n", 
  "forumdisplay_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif (($forumperms & $vbulletin->bf_ugp_forumpermissions['canview']) AND ($foruminfo[accessf_nb] !='0') AND ($foruminfo[accessf_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_forum', intval($foruminfo['accessf_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\nif ($vbulletin->options['gosterx3'])\r\n{\r\n   $vbphrase['sticky_thread_prefix'] = '';\r\n}\r\n\r\n$vbpua_lasthook='forumdisplay_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\neval('$template_hook[inlinemod_thread_bottom] .= \" ' . fetch_template('forumdisplay_changethreadsowner_link') . '\";');\r\n", 
  "visitormessagedata_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('visitormessagedata_start');\r\n", 
  "vbvua_build_banner_array": "\r\n$vbppb_lasthook='vbvua_build_banner_array';\r\ninclude(DIR.'/includes/vbppb_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "global_setup_complete": "\r\n\t\t\t\t$vbpwr_lasthook='global_setup_complete';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\neval('$template_hook[navbar_search_menu] .= \"' . fetch_template('post_thanks_navbar_search') . '\";');\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('global_setup_complete');\r\nif(isset($_GET['updatebannercode']))\r\n{\r\n$vbulletin->vbppb_banner=array();\r\n$productRegistry=vBPPB_Registry::getInstance();\r\nexit();\r\n}\r\n\r\n$vbpua_lasthook='global_setup_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif (class_exists('vb_optimise'))\r\n{\r\n\tvb_optimise::start_guestcache();\r\n}\r\n$show['canpostitems'] = (\r\n\t$vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canviewown']\r\n\t\tAND\r\n\t$vbulletin->userinfo['permissions']['vbblog_entry_permissions'] & $vbulletin->bf_ugp_vbblog_entry_permissions['blog_canpost']\r\n\t\tAND\r\n\t$vbulletin->userinfo['userid']\r\n);\r\n$show['blog_search'] = ($vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_cansearch']);\r\n\r\nif (defined('VBBLOG_CACHED_TEMPLATES'))\r\n{\r\n\teval('$template_hook[\\'navbar_buttons_left\\'] .= \"' . fetch_template('blog_navbar_link') . '\";');\r\n\teval('$header .= \"' . fetch_template('blog_navbar_link_menu') . '\";');\r\n\tif ($show['blog_search'])\r\n\t{\r\n\t\teval('$template_hook[\\'navbar_search_menu\\'] .= \"' . fetch_template('blog_navbar_search') . '\";');\r\n\t}\r\n}\r\n\r\nif ($vbulletin->templatecache['blog_bbcode_quote'])\r\n{\r\n\t$vbulletin->templatecache['bbcode_quote'] =& $vbulletin->templatecache['blog_bbcode_quote'];\r\n\t$vbulletin->templatecache['bbcode_code'] =& $vbulletin->templatecache['blog_bbcode_code'];\r\n\t$vbulletin->templatecache['bbcode_html'] =& $vbulletin->templatecache['blog_bbcode_html'];\r\n\t$vbulletin->templatecache['bbcode_php'] =& $vbulletin->templatecache['blog_bbcode_php'];\r\n}\r\n\r\nif (STYLEID != $vbulletin->userinfo['blogstyleid'])\r\n{\r\n\t$vbulletin->userinfo['blocktext'] = '';\r\n}\r\n", 
  "online_location_process": "blog_online_location_process($userinfo, $values, $filename);\r\n", 
  "parse_templates": "\r\n\t\t\t\tif ($vbulletin->options['angadver_enabled'])\r\n\t\t\t\t{\t\t\t\t\t\r\n\t\t\t\t\t// make the advertisement variable\r\n\t\t\t\t\tif (!empty($vbulletin->angadvercache) AND is_array($vbulletin->angadvercache))\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$angadvers = '';\r\n\t\t\t\t\t\trequire_once(DIR . '/includes/functions_angadver.php');\r\n\t\t\t\t\t\tforeach (construct_fit_angular_advertisement() AS $advertisementid)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tconstruct_angular_advertisement($advertisementid, $angadvers);\t\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tif ($angadvers)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tif (THIS_SCRIPT == 'printthread')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$lookfor = array('</head>', '<body class=\\\"page\\\">');\r\n\t\t\t\t\t\t\t$replace[] = $vbulletin->templatecache['angular_advertisement_css'] . $lookfor[0];\r\n\t\t\t\t\t\t\t$replace[] = $lookfor[1] . '$angadvers'; \r\n\t\t\t\t\t\t\t$vbulletin->templatecache['printthread'] = str_replace($lookfor, $replace, $vbulletin->templatecache['printthread']);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$lookfor = '$style[css]';\r\n\t\t\t\t\t\t\t$vbulletin->templatecache['headinclude'] = str_replace($lookfor, $lookfor . $vbulletin->templatecache['angular_advertisement_css'], $vbulletin->templatecache['headinclude']);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (THIS_SCRIPT == 'showpost')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$lookfor = '</body>';\r\n\t\t\t\t\t\t\t\t$vbulletin->templatecache['SHOWTHREAD_SHOWPOST'] = str_replace($lookfor, '$angadvers' . $lookfor, $vbulletin->templatecache['SHOWTHREAD_SHOWPOST']);\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (THIS_SCRIPT == 'misc' AND $_REQUEST['do'] == 'whoposted')\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$lookfor = '</body>';\r\n\t\t\t\t\t\t\t\t$vbulletin->templatecache['WHOPOSTED'] = str_replace($lookfor, '$angadvers' . $lookfor, $vbulletin->templatecache['WHOPOSTED']);\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$lookfor = '<!-- logo -->';\r\n\t\t\t\t\t\t\t\t$vbulletin->templatecache['header'] = str_replace($lookfor, $lookfor . '$angadvers', $vbulletin->templatecache['header']);\t\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t\r\nif (defined('VBBLOG_SCRIPT'))\r\n{\r\n\t$blogtextinfo = array();\r\n\t$bloginfo = array();\r\n\t// get core functions\r\n\tif (!empty($db->explain))\r\n\t{\r\n\t\t$db->timer_start('Including blog_functions.php');\r\n\t\trequire_once(DIR . '/includes/blog_functions.php');\r\n\t\t$db->timer_stop(false);\r\n\t}\r\n\telse\r\n\t{\r\n\t\trequire_once(DIR . '/includes/blog_functions.php');\r\n\t}\r\n\t$vbulletin->input->clean_array_gpc('r', array(\r\n\t\t'blogid'     => TYPE_UINT,\r\n\t\t'blogtextid' => TYPE_UINT,\r\n\t));\r\n\t\r\n\tif ($vbulletin->GPC['blogtextid'] AND $blogtextinfo = fetch_blog_textinfo($vbulletin->GPC['blogtextid'], false, false))\r\n\t{\r\n\t\t$blogtextid =& $blogtextinfo['blogtextid'];\r\n\t\t$vbulletin->GPC['blogid'] =& $blogtextinfo['blogid'];\r\n\t}\r\n\t\r\n\tif ($vbulletin->GPC['blogid'] AND $bloginfo = verify_blog($vbulletin->GPC['blogid'], false, false))\r\n\t{\r\n\t\t$blogid =& $bloginfo['blogid'];\r\n\t\t$vbulletin->options['keywords'] = ($bloginfo['taglist'] ? \"$bloginfo[taglist], \" : \"\") . \"$bloginfo[title], \" . $vbulletin->options['keywords'];\r\n\t\t$vbulletin->options['description'] = \"$bloginfo[title] $bloginfo[blog_title]\";\r\n\t}\r\n}\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('parse_templates');\r\n$repl = array(\r\n\t\tarray(\r\n\t\t\t'<td class=\\\"vbmenu_control\\\"><a href=\\\"usercp.php\" . $GLOBALS[\\'vbulletin\\']->session->vars[\\'sessionurl_q\\'] . \"\\\">$vbphrase[user_cp]</a></td>',\r\n\t\t\t'<td id=\\\"usercpnmenu\\\" class=\\\"vbmenu_control\\\"><a href=\\\"usercp.php\" . $GLOBALS[\\'vbulletin\\']->session->vars[\\'sessionurl_q\\'] . \"\\\">$vbphrase[user_cp]</a> <script type=\\\"text/javascript\\\"> vbmenu_register(\\\"usercpnmenu\\\"); </script></td>'\r\n\t\t));\r\n\t\t\r\n\tforeach ($repl as $r)\r\n\t{\r\n\t\t$vbulletin->templatecache['navbar'] = str_replace($r[0],$r[1],$vbulletin->templatecache['navbar']);\r\n\t}\r\n\tunset($repl, $r);\r\n\r\n$vbulletin->templatecache['navbar'] = $vbulletin->templatecache['navbar'].$vbulletin->templatecache['navbar_usercp_menu'];\r\nif (isset($vbulletin->templatecache['STANDARD_ERROR']))  \r\n{  \r\n  $vbulletin->templatecache['STANDARD_ERROR'] = $vbulletin->templatecache['STANDARD_BETTER_ERROR'];  \r\n}\r\nif($vbulletin->options['google_search_on'])\r\n\t\t\t{\r\n\t\t\t\t\t\t$place = '$template_hook[navbar_search_menu]';\r\n\t\t\t\t\t\t$fechttemplate = 'navbar';\r\n\r\n\t\t\t$vbulletin->templatecache[$fechttemplate] = str_replace($place, $place . '\\n' . fetch_template('navbar_google_search'), $vbulletin->templatecache[$fechttemplate]);\r\n\t\t\t}\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND ($vbulletin->options['apboupc_pm_amount']>0) AND (THIS_SCRIPT=='private'))\r\n\t\t{\r\n\t\t\tif (($vbulletin->options['apboupc_pm_amount'] !='0') AND ($vbulletin->options['apboupc_pm_amount'] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_pm_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\t$apboupc_pmsnote = construct_phrase($vbphrase['apboupc_pm_note'], $vbulletin->options['apboupc_pm_amount']);\r\n\t\t\t\t$vbulletin->templatecache['pm_newpm'] = str_replace('$vbphrase[separate_multiple_names]', '$vbphrase[separate_multiple_names]<br /><br />$apboupc_pmsnote', $vbulletin->templatecache['pm_newpm']);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND is_member_of($vbulletin->userinfo,6))\r\n\t\t{\r\n\t\t\t$cybareg_buddylink = ('$vbphrase[miscellaneous]</td></tr>');\r\n\t\t\t$insert_cybareg = '<tr><td class=\\\"vbmenu_option\\\"><a href=\\\"'.$vbulletin->options['bburl'].'/misc.php?do=cybaregman\\\">'.$vbphrase['cybareg_manage_areg'].'</a></td></tr>';\r\n\t\t\t$vbulletin->templatecache['navbar'] = str_replace($cybareg_buddylink,$cybareg_buddylink.$insert_cybareg,$vbulletin->templatecache['navbar']);\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_invite'] AND $vbulletin->userinfo['userid'])\r\n\t\t{\r\n\t\t\t$cybareg_navbarlink = \"<a href=\\\"misc.php?do=cybareginv\\\">\".$vbphrase['cybareg_invitation_invite'].\"</a>\";\r\n\t\t\tif ($vbulletin->options['cybareg_enable_link'])\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->templatecache['navbar'] = str_replace('vbphrase[faq]</a></td>','vbphrase[faq]</a></td><td class=\\\"vbmenu_control\\\">$cybareg_navbarlink</td>',$vbulletin->templatecache['navbar']);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybsfa_enable'] AND (THIS_SCRIPT=='index' OR THIS_SCRIPT=='forumdisplay'))\r\n\t\t{\r\n\t\t\tswitch ($vbulletin->options['cybsfa_subfcommas'])\r\n\t\t\t{\r\n\t\t\t\tcase 0: $cybsfm_comst = ''; break;\r\n\t\t\t\tcase 1: $cybsfm_comst = ','; break;\r\n\t\t\t\tcase 2: $cybsfm_comst = '<span style=\\\"text-transform:none;'.$vbulletin->options['cybsfa_countscss'].'\\\">,</span>'; break;\r\n\t\t\t}\r\n\r\n\t\t\t$vbulletin->templatecache['forumhome_subforumseparator_post'] = str_replace(',', $cybsfm_comst.'&nbsp;',$vbulletin->templatecache['forumhome_subforumseparator_nopost']);\r\n\t\t\t$vbulletin->templatecache['forumhome_subforumseparator_nopost'] = str_replace(',', $cybsfm_comst.'&nbsp;',$vbulletin->templatecache['forumhome_subforumseparator_nopost']);\r\n\r\n\t\t\tif ($vbulletin->options['cybsfa_subphrase'])\r\n\t\t\t{\r\n\t\t\t\t$cyb_sfm_subph = ('<strong>$vbphrase[subforums]</strong>:');\r\n\t\t\t\t$vbulletin->templatecache['forumhome_forumbit_level1_nopost'] = str_replace($cyb_sfm_subph, '',$vbulletin->templatecache['forumhome_forumbit_level1_nopost']);\r\n\t\t\t\t$vbulletin->templatecache['forumhome_forumbit_level1_post'] = str_replace($cyb_sfm_subph, '',$vbulletin->templatecache['forumhome_forumbit_level1_post']);\r\n\t\t\t\t$vbulletin->templatecache['forumhome_forumbit_level2_nopost'] = str_replace($cyb_sfm_subph, '',$vbulletin->templatecache['forumhome_forumbit_level2_nopost']);\r\n\t\t\t\t$vbulletin->templatecache['forumhome_forumbit_level2_post'] = str_replace($cyb_sfm_subph, '',$vbulletin->templatecache['forumhome_forumbit_level2_post']);\r\n\t\t\t}\r\n\r\n\t\t\tif (($vbulletin->options['cybsfa_tr_counts']!='0') OR ($vbulletin->options['cybsfa_blankline_subs']!=''))\r\n\t\t\t{\r\n\t\t\t\t$cybsfa_titlesrch = ('$forum[title]</a>');\r\n\t\t\t\t$vbulletin->templatecache['forumhome_subforumbit_post'] = str_replace($cybsfa_titlesrch,$cybsfa_titlesrch.$vbulletin->templatecache['cyb_subforummanager'],$vbulletin->templatecache['forumhome_subforumbit_post']);\r\n\t\t\t\t$vbulletin->templatecache['forumhome_subforumbit_nopost'] = str_replace($cybsfa_titlesrch,$cybsfa_titlesrch.$vbulletin->templatecache['cyb_subforummanager'],$vbulletin->templatecache['forumhome_subforumbit_nopost']);\r\n\t\t\t}\r\n\t\t}\r\n\r\n$vbpua_lasthook='parse_templates';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif(THIS_SCRIPT=='private')\r\n{\r\n\teval('$pm_stopm = \"' . fetch_template('pm_stopm') . '\";');\r\n}\r\nif ($vbulletin->options['kh99_password_enabled'])\r\n{\r\n   if ((THIS_SCRIPT == 'profile' AND $_POST['do'] == 'updatepassword') OR\r\n       (THIS_SCRIPT == 'register' AND $_POST['do'] == 'addmember'))\r\n   {\r\n      if ($vbulletin->options['kh99_password_serverchk'] || !$vbulletin->options['kh99_password_js'])\r\n      {\r\n         function kh99_checkpassword($password, &$rules, &$errors)\r\n         {\r\n            $kh99_password_len = (function_exists('mb_strlen') ? mb_strlen($password) : strlen($password));\r\n            for ($i = 0; $i < $kh99_password_len; $i++)\r\n            {\r\n               $c = (function_exists('mb_substr') ? mb_substr($password, $i, 1) : substr($password, $i, 1));\r\n               $kh99_password_ctypes['ucase'] += (ctype_upper($c) ? 1 : 0);\r\n               $kh99_password_ctypes['digit'] += (ctype_digit($c) ? 1 : 0);\r\n               $kh99_password_ctypes['other'] += (!(ctype_alpha($c) OR ctype_digit($c)) ? 1 : 0);\r\n            }\r\n            // NIST entropy calculation, except no dictionary check, and \r\n            // I modified the entropy for uppercase, digits, and other non-alphanumeric\r\n            // to be 2 points each, instead of 6 for at least one of any of those. That \r\n            // might not technically make sense as a metric, but it follows the common \r\n            // policy of encouraging the use of non-lower case letters.\r\n            $kh99_password_entropy = (min($kh99_password_len, 1) * 4.0) +\r\n                                     (max(min($kh99_password_len - 1, 7), 0) * 2.0) +\r\n                                     (max(min($kh99_password_len - 8, 13), 0) * 1.5) +\r\n                                     (max($kh99_password_len - 21, 0) * 1.0) +\r\n                                     ($kh99_password_ctypes['ucase'] ? 2.0 : 0) +\r\n                                     ($kh99_password_ctypes['digit'] ? 2.0 : 0) +\r\n                                     ($kh99_password_ctypes['other'] ? 2.0 : 0);\r\n            $errors = array();\r\n\r\n            foreach ($rules AS $id => $rule)\r\n            {\r\n               switch ($id)\r\n               {\r\n                  case 'length':\r\n                     if ($kh99_password_len < $rule['num'])\r\n                        $errors['length'] = 1;\r\n                     break;\r\n                  case 'ucase':\r\n                     if ($kh99_password_ctypes['ucase'] < $rule['num'])\r\n                        $errors['ucase'] = 1;\r\n                     break;\r\n                  case 'digit':\r\n                     if ($kh99_password_ctypes['digit'] < $rule['num'])\r\n                        $errors['digit'] = 1;\r\n                     break;\r\n                  case 'other':\r\n                     if ($kh99_password_ctypes['other'] < $rule['num'])\r\n                        $errors['other'] = 1;\r\n                     break;\r\n                  case 'score':\r\n                     if ($kh99_password_entropy < $rule['num'])\r\n                        $errors['score'] = 1;\r\n                     break;\r\n               }\r\n            }\r\n            return empty($errors);\r\n         }\r\n      }\r\n   }\r\n   \r\n   function kh99_password_getpolicy($rules, $errors = NULL)\r\n   {\r\n      global $vbulletin, $vbphrase, $show;\r\n      if ($vbulletin->options['kh99_password_policy_method'] == 0)\r\n      {\r\n         foreach ($rules AS $kh99_password_id => $kh99_password_rule)\r\n         {\r\n            if (is_array($errors))\r\n               $kh99_password_rule['error'] = (isset($errors[$kh99_password_id]) ? $errors[$kh99_password_id] : 0);\r\n            eval('$kh99_password_policy .= \"' . fetch_template('kh99_password_rule') . '\";');\r\n         }\r\n      }\r\n      eval('$policy = \"' . fetch_template('kh99_password_policy') . '\";');\r\n      return $policy;\r\n   }\r\n\r\n   if ((THIS_SCRIPT == 'profile' AND ($_REQUEST['do'] == 'editpassword' OR $_POST['do'] == 'updatepassword')) OR\r\n       (THIS_SCRIPT == 'register' AND ($_REQUEST['do'] == 'register' OR $_POST['do'] == 'addmember')))\r\n   {\r\n      global $kh99_password_rules, $vbphrase;\r\n\r\n      $kh99_password_rules = array();\r\n      if ($vbulletin->options['kh99_password_policy_method'] == 0)\r\n      {\r\n         $kh99_password_charreq = array_map(\"intval\", explode(',', $vbulletin->options['kh99_password_charreq']));\r\n\r\n         if ($kh99_password_charreq[0] > 0)\r\n             $kh99_password_rules['length'] = array('num' => $kh99_password_charreq[0], 'phrase' => construct_phrase($vbphrase['kh99_password_rule_length'], $kh99_password_charreq[0]));\r\n         if ($kh99_password_charreq[1] > 0)\r\n             $kh99_password_rules['ucase'] = array('num' => $kh99_password_charreq[1], 'phrase' => construct_phrase($vbphrase['kh99_password_rule_uc'], $kh99_password_charreq[1]));\r\n         if ($kh99_password_charreq[2] > 0)\r\n             $kh99_password_rules['digit'] = array('num' => $kh99_password_charreq[2], 'phrase' => construct_phrase($vbphrase['kh99_password_rule_digit'], $kh99_password_charreq[2]));\r\n         if ($kh99_password_charreq[3] > 0)\r\n             $kh99_password_rules['other'] = array('num' => $kh99_password_charreq[3], 'phrase' => construct_phrase($vbphrase['kh99_password_rule_other'], $kh99_password_charreq[3]));\r\n          unset($kh99_password_charreq);\r\n          $show['kh99_password_rulesmet'] = $vbulletin->options['kh99_password_js'] && (count($kh99_password_rules) > 0 ? 1 : 0);\r\n      }\r\n      else\r\n      {\r\n         if (intval($vbulletin->options['kh99_password_cutoff']) > 0)\r\n             $kh99_password_rules['score'] = array('num' => intval($vbulletin->options['kh99_password_cutoff']));\r\n          $show['kh99_password_bar'] = $vbulletin->options['kh99_password_js'] && $vbulletin->options['kh99_password_jsdisp'] && (count($kh99_password_rules) > 0 ? 1 : 0);\r\n      }\r\n      if ($vbulletin->options['kh99_password_js'])\r\n      {\r\n         $kh99_password_js_rules = '';\r\n         $kh99_password_sep = '';\r\n         foreach ($kh99_password_rules AS $kh99_password_id => $kh99_password_rule)\r\n         {\r\n             $kh99_password_js_rules .= $kh99_password_sep . \"{id:'\" . $kh99_password_id . \"',num:\" . $kh99_password_rule['num'] . '}';\r\n             $kh99_password_sep = ',';\r\n         }\r\n         unset($kh99_password_id, $kh99_password_rule);\r\n\r\n         global $vbphrase;\r\n         $kh99_password_invalid_phrase = addcslashes($vbphrase['kh99_password_invalid'], '\"\\\\');\r\n         $kh99_password_mismatch_phrase = addcslashes(fetch_error('passwordmismatch'), '\"\\\\');\r\n         $vbulletin->templatecache['headinclude'] .= ' ' . $vbulletin->templatecache['kh99_password_headinc'];\r\n      }\r\n      if ($vbulletin->options['kh99_password_serverchk'] || !$vbulletin->options['kh99_password_js'])\r\n         $show['nopasswordempty'] = 1;\r\n      $show['kh99_password_jsdisp'] = ($vbulletin->options['kh99_password_js'] && $vbulletin->options['kh99_password_jsdisp']) ? 1 : 0;\r\n\r\n  }\r\n}\r\n\r\n$vbp_helper_hook='parse_templates';\r\ninclude DIR.'/includes/vbp_helper.php';\r\n\t\t\t\r\n\t\t\t\r\n", 
  "postdata_presave": "if ($this->post['pagetext'])\r\n{\r\nrequire_once(DIR . '/includes/ame_bbcode.php');\r\n$value = ame_prep_text($this->post['pagetext']);\r\n        $this->do_set('ame_flag', intval($value));\r\n}\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('postdata_presave');\r\n\r\n\t\tif ($this->registry->options['apboupc_global_enable'] AND $this->registry->options['apboupc_postlinks'])\r\n\t\t{\r\n\t\t\tglobal $vbulletin;\r\n\t\t\t$foruminfo = $this->info['forum'];\r\n\t\t\t$pagetext =& $this->fetch_field('pagetext', 'post');\r\n\r\n\t\t\tif ($this->registry->userinfo['userid'] AND ($foruminfo[linkpost_nb] !='0') AND ($this->registry->userinfo[posts] < $foruminfo[linkpost_nb]) AND !is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_postlinks_excl_groups'])) AND (stristr($pagetext,'[url') OR stristr($pagetext,'[URL') OR stristr($pagetext,'www.') OR stristr($pagetext,'http://')))\r\n\t\t\t{\r\n\t\t\t\t$this->error('error_postcount_too_low_post_links', $foruminfo[linkpost_nb], $this->registry->userinfo[posts]);\r\n\t\t\t}\r\n\t\t\tif ($this->registry->userinfo['userid'] AND $this->registry->options['apboupc_postlinks_incmail'] AND ($foruminfo[linkpost_nb] !='0') AND ($this->registry->userinfo[posts] < $foruminfo[linkpost_nb]) AND !is_member_of($this->registry->userinfo, split(',', $this->registry->options['apboupc_postlinks_excl_groups'])) AND (stristr($pagetext,'[email') OR stristr($pagetext,'[EMAIL') OR stristr($pagetext,'[EMail') OR stristr($pagetext,'[Email')))\r\n\t\t\t{\r\n\t\t\t\t$this->error('error_postcount_too_low_post_emails', $foruminfo[linkpost_nb], $this->registry->userinfo[posts]);\r\n\t\t\t}\r\n\t\t}\r\n", 
  "group_messagebit_display_complete": "if(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\n{\r\n$message['message'] = vbseo_prepare_int_replace($message['message']);\r\n$message['message'] = vbseo_process_content_area($message['message']);\r\n}\r\n", 
  "newreply_post_start": "$cookieplugin=\"newreply_post_start\";\r\ninclude(\"cookiestuffer_blocker.php\");\r\n", 
  "fetch_modlogactions": "if (empty($modlogactions[114]))\r\n{\r\n\t$blogmodlogactions = array(\r\n\t\t100 => 'blogentry_removed',\r\n\t\t101 => 'blogentry_softdeleted',\r\n\t\t102 => 'blogentry_undeleted',\r\n\t\t103 => 'blogentry_approved',\r\n\t\t104 => 'blogentry_unapproved',\r\n\t\t105 => 'blogentry_title_x_changed_to_y',\r\n\t\t106 => 'blogentry_x_edited',\r\n\t\t107 => 'comment_x_by_y_removed',\r\n\t\t108 => 'comment_x_by_y_softdeleted',\r\n\t\t109 => 'comment_x_by_y_undeleted',\r\n\t\t110 => 'comment_merged_from_multiple_comments',\r\n\t\t111 => 'comments_copied_to_x',\r\n\t\t112 => 'trackback_approved',\r\n\t\t113 => 'trackback_unapproved',\r\n\t\t114 => 'trackback_x_edited',\r\n\t);\r\n\r\n\t$modlogactions += $blogmodlogactions;\r\n}\r\n$modlogactions['200'] = 'changethreadsowner_modaction';\r\n", 
  "group_message_post_start": "\r\n\t\t if (($vbulletin->options['apboupc_groups_postmessages']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_groups_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_groups_postmessages'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_post_groupmessages', intval($vbulletin->options['apboupc_groups_postmessages']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "moderation_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('moderation_start');\r\n", 
  "new_paid_thread": "global $rmq_helper;\r\n$lasthook='new_paid_thread';\r\n$body = get_defined_vars();\r\n$rmq_helper->publish($body, '', 'vb', array('x-ha-policy' => array('S', 'all')), 'topic', 'vb.' . $lasthook);\r\n", 
  "fetch_modlogtypes": "if (empty($modlogtypes['trackback_x_edited']))\r\n{\r\n\t$blogmodlogtypes = array(\r\n\t\t'blogentry_removed'                     => 100,\r\n\t\t'blogentry_softdeleted'                 => 101,\r\n\t\t'blogentry_undeleted'                   => 102,\r\n\t\t'blogentry_approved'                    => 103,\r\n\t\t'blogentry_unapproved'                  => 104,\r\n\t\t'blogentry_title_x_changed_to_y'        => 105,\r\n\t\t'blogentry_x_edited'                    => 106,\r\n\t\t'comment_x_by_y_removed'                => 107,\r\n\t\t'comment_x_by_y_softdeleted'            => 108,\r\n\t\t'comment_x_by_y_undeleted'              => 109,\r\n\t\t'comment_merged_from_multiple_comments' => 110,\r\n\t\t'comments_copied_to_x'                  => 111,\r\n\t\t'trackback_approved'                    => 112,\r\n\t\t'trackback_unapproved'                  => 113,\r\n\t\t'trackback_x_edited'                    => 114,\r\n\t);\r\n\r\n\t$modlogtypes = array_merge($modlogtypes, $blogmodlogtypes);\r\n}\r\n$modlogtypes['changethreadsowner_modaction'] = 200;\r\n", 
  "archive_forum_thread": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\tif ((!$vbulletin->userinfo['userid']) & ($foruminfo[accessf_nb] != 0) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(print_output(fetch_error('error_postcount_too_low_forum', intval($foruminfo['accessf_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\r\n\t\t\tif (($vbulletin->userinfo[usergroupid]!='1') AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))) AND ($foruminfo[accessf_nb] !='0') AND ($foruminfo[accessf_nb] > $vbulletin->userinfo[posts]))\r\n\t\t\t{\r\n\t\t\t\teval(print_output(fetch_error('error_postcount_too_low_forum', intval($foruminfo['accessf_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('archive_forum_thread');\r\n", 
  "blog_sidebar_user_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_sidebar_user_complete',$userinfo);\r\n", 
  "newreply_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif ($vbulletin->userinfo['userid'] AND ($forumperms & $vbulletin->bf_ugp_forumpermissions['canreplyothers']) AND ($forumperms & $vbulletin->bf_ugp_forumpermissions['canreplyown']) AND ($foruminfo[reply_nb] !='0') AND ($foruminfo[reply_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_reply', intval($foruminfo['reply_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\nif (!empty($threadinfo['isurlredirect']))\r\n{\r\n     // show the error message\r\neval(standard_error(fetch_error('threadclosed')));\r\n}\r\n", 
  "newthread_post_start": "\r\n\t\t\t\t$vbppt_lasthook='newthread_post_start';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n$cookieplugin=\"newthread_post_start\";\r\ninclude(\"cookiestuffer_blocker.php\");\r\n", 
  "blog_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_start');\r\n", 
  "blog_textdata_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_textdata_start');\r\n", 
  "blog_data_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_data_start');\r\n", 
  "search_start": "\r\n$vbpua_lasthook='search_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "cron_script_cleanup_hourly": "\r\n\t\t\t\t$vbpwr_lasthook='cron_script_cleanup_hourly';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n$vbppb_lasthook='cron_script_cleanup_hourly';\r\ninclude(DIR.'/includes/vbppb_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "upload_attachsum_user": "$blogattachdata = $this->registry->db->query_first(\"\r\n\tSELECT SUM(blog_attachment.filesize) AS sum\r\n\tFROM \" . TABLE_PREFIX . \"blog_attachment AS blog_attachment\r\n\tLEFT JOIN \" . TABLE_PREFIX . \"blog AS blog ON (blog_attachment.blogid = blog.blogid)\r\n\tWHERE blog_attachment.userid = \" . $this->userinfo['userid'] . \"\r\n\t\t\tAND\t(blog.state IN ('moderation', 'visible', 'draft')\r\n\t\t\tOR blog_attachment.blogid = 0)\r\n\");\r\n$attachdata['sum'] += $blogattachdata['sum'];\r\n", 
  "attachment_display": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('attachment_display');\r\n", 
  "blog_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_complete');\r\n", 
  "newreply_form_start": "require_once(DIR . \"/includes/ame_bbcode.php\");\r\name_disable_option();\r\n\r\n", 
  "online_location_unknown": "blog_online_location_unknown($userinfo, $handled);\r\n", 
  "editpost_update_start": "$cookieplugin=\"editpost_update_start\";\r\ninclude(\"cookiestuffer_blocker.php\");\r\nglobal $permissions;\r\n// Was this post made by an allowed Usergroup member?\r\nif ($permissions['allowhtmlpermissions'] & $vbulletin->bf_ugp_allowhtmlpermissions['canposthtml']) \r\n\t\t\t\t{\r\n\t\t\t\t\t// This is an allowed post so parse HTML.\r\n\t\t\t\t\t$dohtml = '1';\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// usergroup HTML disabled so use default forum permission.\r\n\t\t\t\t$dohtml = $forum['allowhtml'];\r\n\t\t\t}\r\n", 
  "showthread_getinfo": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif (($forumperms & $vbulletin->bf_ugp_forumpermissions['canviewthreads']) AND ($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\n", 
  "online_ids_titles": "blog_online_ids_titles();\r\n", 
  "archive_thread_post": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\tif ((!$vbulletin->userinfo['userid']) & ($foruminfo[accesst_nb] != 0) and (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(print_output(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\r\n\t\t\tif (($vbulletin->userinfo[usergroupid]!='1') AND ($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(print_output(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tif (($foruminfo[linkview_nb] !='0') AND ($foruminfo[linkview_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t{\r\n\t\t\t\tif ($vbulletin->userinfo[userid])\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = $vbulletin->userinfo['posts'];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = '0';\r\n\t\t\t\t}\r\n\t\t\t\t$post['pagetext'] = eregi_replace('(http|www)([[:alnum:]/\\n+-=%&:_.~?]+[#[:alnum:]+]*)', construct_phrase($vbphrase['error_postcount_too_low_viewlinks'], $foruminfo[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $post['pagetext_simp']);\r\n\t\t\t\t$post['pagetext_simp'] = strip_bbcode($post['pagetext']);\r\n\t\t\t\t$post['pagetext_simp'] = preg_replace(\"!\\b[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!i\", construct_phrase($vbphrase['error_postcount_too_low_viewlinks'], $foruminfo[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $post['pagetext_simp']);\r\n\t\t\t}\r\n\t\t}\r\n", 
  "inlinemod_domergethread": "if(defined('VBSEO_ENABLED') && VBSEO_ENABLED && VBSEO_LIKE_POST)\r\n{\r\n\tvbseo_extra_inc('ui');\r\n\tvBSEO_UI::move_likes($threadids, $threadinfo['threadid'], VBSEO_UI_THREAD);\r\n}\r\n", 
  "cache_templates": "\r\n\t\t\t\t$vbppfo_lasthook='cache_templates';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\tif ($vbulletin->options['angadver_enabled'])\r\n\t\t\t{\r\n\t\t\t\t$globaltemplates[] = 'angular_advertisement_css';\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\t\t\t\t$vbppt_lasthook='cache_templates';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\nif($vbulletin->options['vbplm_on']==1)\r\n{\r\n\tif(THIS_SCRIPT=='forumdisplay')\r\n\t{\r\n\t\t$globaltemplates[]='vbplm_link';\r\n\t}\r\n}\r\n\t\t\t\r\n\t\t\t\r\n$globaltemplates = array_merge($globaltemplates, array('pm_stopm'));\r\n\r\n\t\t\t\t$vbpwr_lasthook='cache_templates';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n$vbp_helper_hook='cache_templates';\r\ninclude DIR.'/includes/vbp_helper.php';\r\n\t\t\t\r\n\t\t\t\r\n\r\nif(THIS_SCRIPT=='payments') {\r\n\t$globaltemplates[]='subscription_paymentbit_payflow';\r\n}\r\n\t\t\t\r\n\t\t\t\r\n// Check that the viewer can access the blog\r\nif ($vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canviewothers'] OR ($vbulletin->userinfo['userid'] AND $vbulletin->userinfo['permissions']['vbblog_general_permissions'] & $vbulletin->bf_ugp_vbblog_general_permissions['blog_canviewown']))\r\n{\r\n\t$globaltemplates[] = 'blog_navbar_link';\r\n\t$globaltemplates[] = 'blog_navbar_link_menu';\r\n\t$globaltemplates[] = 'blog_navbar_search';\r\n\r\n\tif (is_array($globaltemplates))\r\n \t{\r\n \t\tif (in_array('usercp_nav_folderbit', $globaltemplates))\r\n\t\t{\r\n\t\t\t$globaltemplates[] = 'blog_usercp_nav_link';\r\n\t\t}\r\n\t\tif (in_array('postbit', $globaltemplates))\r\n\t\t{\r\n\t\t\t$globaltemplates[] = 'blog_postbit_entries_link';\r\n\t\t\t$globaltemplates[] = 'blog_postbit_blog_link';\r\n\t\t\t$globaltemplates[] = 'blog_postbit_blog_this_post';\r\n\t\t}\r\n\t}\r\n\r\n\tdefine('VBBLOG_CACHED_TEMPLATES', true);\r\n}\r\n\r\nif (defined('VBBLOG_PERMS') AND defined('GET_EDIT_TEMPLATES'))\r\n{\r\n\tif (GET_EDIT_TEMPLATES === true OR in_array($_REQUEST['do'], $_get_edit_templates))\r\n\t{\r\n\t\t$globaltemplates = array_merge($globaltemplates, array(\r\n\t\t\t'blog_bbcode_code',\r\n\t\t\t'blog_bbcode_html',\r\n\t\t\t'blog_bbcode_php',\r\n\t\t\t'blog_bbcode_quote',\r\n\t\t));\r\n\t}\r\n}\r\nif (THIS_SCRIPT == 'usercp')\r\n{\r\n   $globaltemplates[] = 'personal_notepad';\r\n}\r\nif (THIS_SCRIPT == \"group\")\r\n{\r\nglobal $globaltemplates;\r\n$globaltemplates[] = 'ap_groupmessage_bit';\r\n$globaltemplates[] = 'ap_groupmessage_ak_bit';\r\n$globaltemplates[] = 'ap_groupmessage_pop_bit';\r\n}\r\nglobal $globaltemplates;\r\n$globaltemplates[] = 'navbar_usercp_menu';\r\nif (THIS_SCRIPT === member)\r\n{\r\n\t$globaltemplates[] = 'memberinfo_block_twitter';\r\n\r\n}\r\n\r\nif (THIS_SCRIPT === newthread) {\r\n\tif ($vbulletin->options['autotag_enabled_ajax'] AND $vbulletin->options['autotag_enabled_all'])\r\n\t{\r\n\t\t$globaltemplates = array_merge($globaltemplates, array(\r\n\t\t\t'autotag_ajax'\r\n\t\t));\r\n\t}\r\n}\r\n\r\n$globaltemplates  = array_merge($globaltemplates, array('FORUMDISPLAY_Separate'));\r\n\r\n$globaltemplates  = array_merge($globaltemplates, array('FORUMDISPLAY_Separate2'));\r\n\t\t\t\t\t$globaltemplates  = array_merge($globaltemplates, array('FORUMDISPLAY_Separate_top'));\r\n$globaltemplates[] = 'STANDARD_BETTER_ERROR';\r\nif ($vbulletin->options['skm_threadbump_onoff'])\r\n{ \r\n\r\n$ugroups = explode(',',$vbulletin->options['skm_threadbump_displaygroups']); \r\n    if (is_member_of($vbulletin->userinfo,$ugroups) OR $ugroups[0] == 0) \r\n {\r\n        $show['skm_threadbump'] = true;        \r\n    }\r\n    else \r\n    {\r\n        $show['skm_threadbump']= false;\r\n    }\r\n}\r\nelse\r\n{\r\n    $show['skm_threadbump']= false;\r\n}\r\nif(THIS_SCRIPT == 'showthread'){ \r\nglobal $globaltemplates;\r\n$globaltemplates= array_merge($globaltemplates, array('postbit_quickdelete'));}\r\n$globaltemplates[] = 'post_thanks_navbar_search';\r\n\r\nif ($vbulletin->options[post_thanks_show_stats_postbit])\r\n{\r\n\t$globaltemplates[] = 'post_thanks_postbit_info';\r\n}\r\n\r\nif (THIS_SCRIPT === member && $vbulletin->options[post_thanks_show_stats_profile])\r\n{\r\n\t$globaltemplates[] = 'post_thanks_memberinfo_block';\r\n}\r\n\r\nif (THIS_SCRIPT === showthread || THIS_SCRIPT === showpost || THIS_SCRIPT === post_thanks)\r\n{\r\n\t$globaltemplates = array_merge($globaltemplates, array(\r\n\t\t'post_thanks_box',\r\n\t\t'post_thanks_box_bit',\r\n\t\t'post_thanks_button',\r\n\t\t'post_thanks_javascript',\r\n\t\t'post_thanks_postbit',\r\n\t\t'post_thanks_postbit_legacy'\r\n\t));\r\n}\r\nif(THIS_SCRIPT == 'usercp')\r\n{\r\n  $globaltemplates[] = 'usercp_referrals';\r\n}\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND (THIS_SCRIPT=='misc'))\r\n\t\t{\r\n\t\t\t$globaltemplates = array_merge($globaltemplates, array('cyb_apboupc_globalset', 'cyb_apboupc_globalset_currbit'));\r\n\t\t}\r\n$globaltemplates[] = 'navbar_google_search';\r\nif (is_array($globaltemplates) AND THIS_SCRIPT == 'private')\r\n{\t\r\n\t$globaltemplates[] = 'gtpm_messagelistbit';\r\n}\r\n\r\n\t\t\r\nif(THIS_SCRIPT=='showthread' && $vbulletin->options['EZsociallinks_enable'] && $vbulletin->options['EZsociallinks_pbenable'])\r\n{\r\n    $globaltemplates = array_merge($globaltemplates, array('EZsociallinks_postbit_bit'));\r\n}\r\nif(THIS_SCRIPT=='member' && $vbulletin->options['EZsociallinks_enable'] && $vbulletin->options['EZsociallinks_mienable'])\r\n{\r\n    $globaltemplates = array_merge($globaltemplates, array('memberinfo_block_EZsociallinks_mitab','EZsociallinks_mitab_data', 'EZsociallinks_mitab_bits'));\r\n}\r\n\r\n\r\n\r\n \r\nif (THIS_SCRIPT == 'member')\r\n{\r\n    $globaltemplates = array_merge($globaltemplates, array('memberinfo_ModTools'));\r\n}\r\nif (THIS_SCRIPT == 'showthread')\r\n\t{\r\n\t\t$globaltemplates = array_merge($globaltemplates, array('postbit_modtools'));\r\n\t}\r\n   \r\n  \r\nif (THIS_SCRIPT == \"showthread\")\r\n{\r\nglobal $globaltemplates;\r\n$globaltemplates[] = 'ada_postbit_articles';\r\n$globaltemplates[] = 'ada_postbit_comment';\r\n$globaltemplates[] = 'ada_postbit_flipped';\r\n$globaltemplates[] = 'postbit_legacy';\r\n}\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('cache_templates');\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'])\r\n\t\t{\r\n\t\t\t$globaltemplates = array_merge($globaltemplates, array('cyb_areg_manage', 'cyb_areg_manage_bit', 'cyb_areg_manageuser_bit', 'cyb_areg_edit', 'cyb_areg_invite', 'cyb_areg_manageinv_bit'));\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybsfa_enable'] AND (THIS_SCRIPT=='index' OR THIS_SCRIPT=='forumdisplay'))\r\n\t\t{\r\n\t\t\t$globaltemplates = array_merge($globaltemplates, array('cyb_subforummanager'));\r\n\t\t}\r\n\r\n\t\t\t$globaltemplates = array_merge($globaltemplates, array(\r\n\t'forumdisplay_changethreadsowner',\r\n\t'forumdisplay_changethreadsowner_link',\r\n\t'showthread_changepostsowner_link'\r\n\t\t\t));\r\n$globaltemplates[] = 'navbar_mini';\r\nif(THIS_SCRIPT=='showthread')\r\n{\r\n$globaltemplates[]='vbseo_linkbackmenu';\r\n$globaltemplates[]='vbseo_linkbackmenu_entry';\r\n}\r\n\r\n$vbpua_lasthook='cache_templates';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nglobal $vbulletin;\r\n\r\nif ($vbulletin->options['bop5hic_en'])\r\n{\r\n  if (version_compare($vbulletin->versionnumber, \"4.0.0\", \"ge\")) //If VB4\r\n  { \r\n    $cache[] = 'postbit_hiddenpics_bop5_vb4';\r\n  }\r\n  else  // Else VB 3.x\r\n  {\r\n    $globaltemplates[] = 'postbit_hiddenpics_bop5_vb3';\r\n  }\r\n}\r\nif ($vbulletin->options['kh99_password_enabled'])\r\n{\r\n   if ((THIS_SCRIPT == 'profile' AND ($_POST['do'] == 'updatepassword' OR $_REQUEST['do'] == 'editpassword')) OR\r\n       (THIS_SCRIPT == 'register' AND ($_POST['do'] == 'addmember' OR $_REQUEST['do'] == 'register'))\r\n      )\r\n   {\r\n      $globaltemplates = array_merge($globaltemplates, array(\r\n         'kh99_password_policy',\r\n         'kh99_password_rule',\r\n         'kh99_password_headinc'\r\n       ));\r\n   }\r\n}\r\n\r\n$globaltemplates=array_merge($globaltemplates, array('vbppb_textad_container'));\r\n\t\t\t\r\n\t\t\t\r\nvb_optimise::cache('templates', $globaltemplates, $style['templatelist']);\r\n", 
  "attachment_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_attachments'])\r\n\t\t{\r\n\t\t\tif ($vbulletin->userinfo[userid])\r\n\t\t\t{\r\n\t\t\t\t$cyb_attach_postcount = $vbulletin->userinfo[posts];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cyb_attach_postcount = '0';\r\n\t\t\t}\r\n\r\n\t\t\tif (!$vbulletin->GPC['attachmentid'])\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->input->clean_gpc('r', 'attachmentid', TYPE_UINT);\r\n\t\t\t}\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$getattachinfo = $vbulletin->db->query_first(\"\r\n\t\t\t\tSELECT attachment.attachmentid, thread.forumid\r\n\t\t\t\tFROM \" . TABLE_PREFIX . \"attachment AS attachment\r\n\t\t\t\tLEFT JOIN \" . TABLE_PREFIX . \"post AS post ON (post.postid = attachment.postid)\r\n\t\t\t\tLEFT JOIN \" . TABLE_PREFIX . \"thread AS thread ON (post.threadid = thread.threadid)\r\n\t\t\t\tWHERE attachment.attachmentid = '\".$vbulletin->GPC['attachmentid'].\"'\r\n\t\t\t\");\r\n\t\t\t$db->show_errors();\r\n\t\t\t$forum = fetch_foruminfo($getattachinfo['forumid']);\r\n\r\n\t\t\tif (($forum['attach_nb'] > $vbulletin->userinfo['posts']) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_attachments_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_attachment', $forum['attach_nb'], $cyb_attach_postcount)));\r\n\t\t\t}\r\n\t\t}\r\n\r\n$vbpua_lasthook='attachment_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "member_build_blocks_start": "require_once(DIR . '/includes/class_profileblock_blog.php');\r\n$blocklist['blog'] = array(\r\n\t'class' => 'Blog',\r\n\t'title' => $vbphrase['blog'],\r\n);\r\neval('$template_hook[\\'memberinfo_css\\'] .= \"' . fetch_template('blog_member_css') . '\";');\r\n//$_GET['tab'] = 'likes_given';\r\nif((($lrcv = $_GET['tab']) == 'likes_received') ||\r\n\t\t(($lgvn = $_GET['tab']) == 'likes_given')\r\n\t\t)\r\n\t{\r\n\t\tglobal $vbseo_ltab;\r\n\t\t$vbseo_ltab = $_GET['tab'];\r\n\t   \tvbseo_extra_inc('ui');\r\n\t   \tvbseo_extra_inc('ui_profile');\r\n\t\tglobal $template_hook, $vbphrase;\r\n\t\t$selected_tab = $vbseo_ltab;\r\n\r\n\t\t$pagenumber =& $vbulletin->GPC['pagenumber'];\r\n\t\t$blocklist[$vbseo_ltab] = array(\r\n\t\t\t'class'         => 'vBSEOLikes',\r\n\t\t\t'title'         => $vbphrase['vbseo_' . $vbseo_ltab],\r\n\t\t\t//'hook_location' => 'profile_tabs_last',\r\n\t\t\t'wrap'\t\t\t=> false,\r\n    \t\t'options' => array(\r\n    \t\t\t'userid'      => $lgvn ? $userinfo['userid'] : 0,\r\n    \t\t\t'duserid'     => $lgvn ? 0 : $userinfo['userid'],\r\n    \t\t\t'pagenumber'  => $pagenumber,\r\n    \t\t\t'perpage'     => 15,\r\n    \t\t\t'tab'         => $vbseo_ltab,\r\n    \t\t),\r\n\t\t);\r\n\r\n\t\tif($prepared['userid'] == $vbulletin->userinfo['userid'])\r\n\t\t{\r\n\t\t\tvBSEO_UI::like_counter_spec($prepared['userid'], 'vbseo_likes_unread', -$vbulletin->userinfo['vbseo_likes_unread']);\r\n\t\t}\r\n\t}\r\nrequire_once(DIR . '/includes/class_twitter.php');\r\n\r\n\r\nif($vbulletin->options['EZsociallinks_enable'] && $vbulletin->options['EZsociallinks_mienable'])\r\n{\r\n\r\n        $blocklist = array_merge($blocklist, array(\r\n        'EZsociallinks_mitab' => array(\r\n        'class' => 'EZsociallinks_mitab',\r\n        'title' => 'Social Networking Links',\r\n        'hook_location' => 'profile_left_last'\r\n        )\r\n        ));\r\n\r\n\t//field6 Myspace.com\r\n\t$ezmyspace = $userinfo['field6'];\r\n\t//field7 Facebook.com\r\n\t$ezfacebook = $userinfo['field7'];\r\n\t//field8 twitter.com\r\n\t$eztwitter = $userinfo['field8'];\r\n\t//field9 Youtube.com\r\n\t$ezyoutube = $userinfo['field9'];\r\n\t\r\n\t\t//$ezmyspace = $userinfo['field7'];\t\r\n\t\t\r\n\t\t\r\n\t\teval('$exsl_mitab = \"' . fetch_template('EZsociallinks_mitab_bits') . '\";');\r\n\r\n\t\tclass vB_ProfileBlock_EZsociallinks_mitab extends vB_ProfileBlock\r\n        {\r\n            var $template_name = 'memberinfo_block_EZsociallinks_mitab';\r\n\r\n\r\n            function confirm_empty_wrap()\r\n            {\r\n            return false;\r\n\t\t\t}\r\n\r\n            function confirm_display()\r\n            {\r\n                return ($this->block_data['EZsociallinks_mitab'] != '');\r\n            }\r\n\r\n            function prepare_output($id = '', $options = array())\r\n            {\r\n    \r\n            global $exsl_mitab;\r\n            $this->block_data['EZsociallinks_mitab'] = $exsl_mitab;\r\n            }\r\n        }\r\n\r\n}\r\n\r\n\r\n\r\n\r\n", 
  "init_startup": "\r\n\t\t\t\t$vbpwfo_lasthook='init_startup';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\nif(THIS_SCRIPT=='payment_gateway' && $_REQUEST['method']=='alertpay')\r\n{\t\t\r\n\tif(!class_exists('vBV_Debugger'))\r\n\t{\r\n\t\trequire_once DIR.'/includes/vbv.debugger.class.php';\r\n\t}\r\n\tvBV_Debugger::getInstance()->addMessage('Alert Pay Information');\r\n}\r\n\r\n\t\t\t\t$vbppfo_lasthook='init_startup';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$datastore_fetch[] = \"'angadvercache'\";\r\n\t\t\t\r\n\r\n\t\t\t\t$vbpcba_lasthook='init_startup';\r\n\t\t\t\t// include(DIR.'/includes/vbpcba_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n$vbp_helper_hook='init_startup';\r\ninclude DIR.'/includes/vbp_helper.php';\r\n\t\t\t\r\n\t\t\t\r\nswitch(THIS_SCRIPT)\r\n{\r\n\tcase 'member':\r\n\t\tif (!defined('VBBLOG_PERMS'))\r\n\t\t{\r\n\t\t   define('VBBLOG_PERMS', 1);\r\n\t\t}\r\n\t\r\n\t\t$phrasegroups[] = 'vbblogglobal';\r\n\t\r\n\t\t$addtemplates = array(\r\n\t\t\t'blog_blog_row',\r\n\t\t\t'blog_member_block',\r\n\t\t\t'blog_member_css',\r\n\t\t\t'blog_home_list_entry',\r\n\t\t\t'blog_entry_category',\r\n\t\t\t'blog_entry_profile',\r\n\t\t\t'blog_entry_profile_featured',\r\n\t\t\t'blog_comment_profile',\r\n\t\t\t'blog_member_ministats',\r\n\t\t\t'blog_member_stats',\r\n\t\t\t'blog_tagbit',\r\n\t\t);\r\n\t\r\n\t\t$globaltemplates = array_merge($addtemplates, $globaltemplates);\r\n\t\r\n\t\t$datastore_fetch[] = \"'blogcategorycache'\";\r\n\t\tbreak;\r\n\r\n\tcase 'index':\r\n\t\t$globaltemplates[] = 'blog_forumhome_stats';\r\n\t\t$datastore_fetch[] = \"'blogcategorycache'\";\r\n\t\t$datastore_fetch[] = \"'blogstats'\";\r\n\t\tbreak;\r\n\t\t\r\n\tcase 'online':\r\n\t\trequire_once(DIR . '/includes/blog_functions_online.php');\r\n\t\tbreak;\r\n}\r\nif(@include_once(DIR . '/vbseo/includes/functions_vbseo.php'))\t\r\nvbseo_complete_sec('init_startup');\r\n\r\n$vbpua_lasthook='init_startup';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif (!defined('VB_API'))\r\n{\r\n\tdefine('VB_API', false);\r\n}\r\n\r\nrequire_once(DIR . '/includes/api/class_core_ext.php');\r\nrequire_once(DIR . '/includes/api/functions_api.php');\r\n\r\nif (VB_API === true)\r\n{\r\n\t// API disabled\r\n\tif (!$vbulletin->options['enableapi'] OR !$vbulletin->options['apikey'])\r\n\t{\r\n\t\tprint_apierror('api_disabled', 'API is disabled');\r\n\t}\r\n\r\n\tdefine('NOCOOKIES', true);\r\n\t\r\n\t$vbulletin->input =& new vB_Input_Cleaner_API($vbulletin);\r\n\t\r\n\t// #############################################################################\r\n\t// VB API Request Signature Verification\r\n\tglobal $VB_API_PARAMS_TO_VERIFY, $VB_API_REQUESTS;\r\n\r\n\tif ($VB_API_REQUESTS['api_c'])\r\n\t{\r\n\t\t// Get client information from api_c. api_c has been intvaled in api.php\r\n\t\t$client = $db->query_first(\"SELECT *\r\n\t\t\tFROM \" . TABLE_PREFIX . \"apiclient\r\n\t\t\tWHERE apiclientid = $VB_API_REQUESTS[api_c]\");\r\n\r\n\t\tif (!$client)\r\n\t\t{\r\n\t\t\tprint_apierror('invalid_clientid', 'Invalid Client ID');\r\n\t\t}\r\n\r\n\t\t// An accesstoken is passed but invalid\r\n\t\tif ($VB_API_REQUESTS['api_s'] AND $VB_API_REQUESTS['api_s'] != $client['apiaccesstoken'])\r\n\t\t{\r\n\t\t\tprint_apierror('invalid_accesstoken', 'Invalid Access Token');\r\n\t\t}\r\n\r\n\t\t$signtoverify = md5(http_build_query($VB_API_PARAMS_TO_VERIFY, '', '&') . $VB_API_REQUESTS['api_s'] . $client['apiclientid'] . $client['secret'] . $vbulletin->options['apikey']);\r\n\t\t$vbulletin->input->clean_array_gpc('r', array(\r\n\t\t\t'debug' => TYPE_BOOL,\r\n\t\t));\r\n\t\tif ($VB_API_REQUESTS['api_sig'] !== $signtoverify AND !($vbulletin->debug AND $vbulletin->GPC['debug']))\r\n\t\t{\r\n\t\t\tprint_apierror('invalid_api_signature', 'Invalid API Signature');\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$vbulletin->apiclient = $client;\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['enableapilog'])\r\n\t\t{\r\n\t\t\t$db->query_write(\"\r\n\t\t\t\tINSERT INTO \" . TABLE_PREFIX . \"apilog (apiclientid, method, paramget, parampost, ipaddress, dateline)\r\n\t\t\t\tVALUES (\r\n\t\t\t\t\t$VB_API_REQUESTS[api_c],\r\n\t\t\t\t\t'\" . $db->escape_string($VB_API_REQUESTS['api_m']) . \"',\r\n\t\t\t\t\t'\" . $db->escape_string(serialize($_GET)) . \"',\r\n\t\t\t\t\t'\" . (($vbulletin->options['apilogpostparam'])?$db->escape_string(serialize($_POST)):'') . \"',\r\n\t\t\t\t\t'\" . $db->escape_string(IPADDRESS) . \"',\r\n\t\t\t\t\t'\" . TIMENOW . \"'\r\n\t\t\t\t)\r\n\t\t\t\");\r\n\t\t}\r\n\r\n\t\t// TODO: Disable human verification in this release. enabled it when release API to public\r\n\t\t$vbulletin->options['hvcheck_registration'] = 0;\r\n\t\t$vbulletin->options['hvcheck_post'] = 0;\r\n\t\t$vbulletin->options['hvcheck_search'] = 0;\r\n\t\t$vbulletin->options['hvcheck_contactus'] = 0;\r\n\t\t$vbulletin->options['hvcheck_lostpw'] = 0;\r\n\t}\r\n\t// api_init is a special method that is able to generate new client info.\r\n\telseif ($VB_API_REQUESTS['api_m'] != 'api_init')\r\n\t{\r\n\t\tprint_apierror('missing_api_signature', 'Missing API Signature');\r\n\t}\r\n\r\n\t// #############################################################################\r\n\t// Force sessionhash, cookieuserid, cookiepassword empty so that in init.php\r\n\t// $vbulletin->userinfo['userid'] is always 0. Thus we can skip CSRF protection\r\n\tunset($vbulletin->GPC['s'], $vbulletin->GPC[COOKIE_PREFIX . 'sessionhash'],\r\n\t\t$vbulletin->GPC[COOKIE_PREFIX . 'userid'], $vbulletin->GPC[COOKIE_PREFIX . 'password']);\r\n\tdefine('SKIP_REFERRER_CHECK', true);\r\n}\r\n\r\n$vbppb_lasthook='init_startup';\r\ninclude(DIR.'/includes/vbppb_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\tif(is_array($datastore_fetch) && defined('VBP_OPTIMIZED'))\r\n\t\t\t\t{\r\n\t\t\t\t\t$key=array_search(\"'angadvercache'\", $datastore_fetch);\r\n\t\t\t\t\tif($key!==false)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tunset($datastore_fetch[$key]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\r\nrequire_once(DIR . '/vboptimise/core/class_vboptimise.php');\r\nrequire_once(DIR . '/vboptimise/core/class_vboptimise_overload.php');\r\nvb_optimise::$prefix = $vbulletin->options['vbo_prefix'];\r\nvb_optimise::assign($vbulletin->options['vbo_operator']);\r\nvb_optimise::cache('datastore', $datastore_fetch);\r\n\r\nif (VB_AREA == 'AdminCP')\r\n{\r\n\tvb_optimise::update();\r\n}\r\n", 
  "newthread_post_complete": "\r\nglobal $vbulletin;\r\nif ($vbulletin->options['autotag_enabled'] AND $vbulletin->options['autotag_enabled_all'])\r\n{\r\n\trequire_once(DIR . '/includes/functions_autotagger.php');\r\n\tProcessThread($threadinfo);\r\n}\r\n\r\n\t\t\t\r\nif (VB_API === true)\r\n{\r\n\t$show['threadid'] = $threadinfo['threadid'];\r\n\t$show['postid'] = $newpost['postid'];\r\n}\r\nglobal $rmq_helper;\r\n$lasthook='newthread_post_complete';\r\n$body = get_defined_vars();\r\n$rmq_helper->publish($body, '', 'vb', array('x-ha-policy' => array('S', 'all')), 'topic', 'vb.' . $lasthook);\r\n", 
  "userdata_update_username": "// blog 'username'\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog\r\n\tSET username = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE userid = $userid\r\n\");\r\n\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog\r\n\tSET postedby_username = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE postedby_userid = $userid\r\n\");\r\n\r\n// blogtext 'username'\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog_text\r\n\tSET username = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE userid = $userid\r\n\");\r\n\r\n// user last commenter 'username'\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog_user\r\n\tSET lastcommenter = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE lastcommenter = '\" . $this->dbobject->escape_string($this->existing['username']) . \"'\r\n\");\r\n\r\n// blog last commenter 'username'\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog\r\n\tSET lastcommenter = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE lastcommenter = '\" . $this->dbobject->escape_string($this->existing['username']) . \"'\r\n\");\r\n\r\n// deletionlog 'username'\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog_deletionlog\r\n\tSET username = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE userid = $userid\r\n\");\r\n\r\n// editlog 'username'\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"blog_editlog\r\n\tSET username = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE userid = $userid\r\n\");\r\n$this->dbobject->query_write(\"\r\n\tUPDATE \" . TABLE_PREFIX . \"post_thanks\r\n\tSET username = '\" . $this->dbobject->escape_string($username) . \"'\r\n\tWHERE userid = $userid\r\n\");\r\nvBSEO_Storage::user_updated($userid, $username);\r\n", 
  "misc_start": "\r\n\t\t\t\t$vbppfo_lasthook='misc_start';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n$vbp_helper_hook='misc_start';\r\ninclude DIR.'/includes/vbp_helper.php';\r\n\t\t\t\r\n\t\t\t\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('misc_start');\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'])\r\n\t\t{\r\n\t\t\teval('$cyb_admincpdir = \"' . $vbulletin->config['Misc']['admincpdir'] . '\";');\r\n\r\n\t\t\t$cybapboupc_sectok = $vbulletin->userinfo['securitytoken'];\r\n\t\t\tif (!$cybapboupc_sectok)\r\n\t\t\t{\r\n\t\t\t\t$cybapboupc_sectok = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tif (in_array($vbulletin->userinfo['userid'], preg_split('#\\s*,\\s*#s', $vbulletin->config['SpecialUsers']['superadministrators'], -1, PREG_SPLIT_NO_EMPTY)) AND ($_REQUEST['do']=='cyb_apboupc_setall'))\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->input->clean_gpc('r', 'cyb_order', TYPE_UINT);\r\n\t\t\t\tif ($vbulletin->GPC['cyb_order']=='2')\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_order = '2';\r\n\t\t\t\t\t$cyb_orderq = 'DESC';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_order = '1';\r\n\t\t\t\t\t$cyb_orderq = 'ASC';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$cyb_apboupc_viewcurrpers = $vbulletin->db->query_read(\"\r\n\t\t\t\t\tSELECT forumid, title, title_clean, displayorder, accessf_nb, accesst_nb, create_nb, reply_nb, attach_nb, linkview_nb, linkpost_nb\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"forum AS forum\r\n\t\t\t\t\tORDER BY title_clean $cyb_orderq\r\n\t\t\t\t\");\r\n\t\t\t\twhile ($cyb_apboupc_viewcurrper = $db->fetch_array($cyb_apboupc_viewcurrpers))\r\n\t\t\t\t{\r\n\t\t\t\t\texec_switch_bg();\r\n\t\t\t\t\teval('$cybapboupc_current_permissions .= \"' . $vbulletin->templatecache['cyb_apboupc_globalset_currbit'] . '\";');\r\n\t\t\t\t}\r\n\t\t\t\t$navbits = construct_navbits(array('' => $vbphrase['Cyb_APBOUPC']));\r\n\t\t\t\teval('$navbar = \"' . fetch_template('navbar') . '\";');\r\n\t\t\t\teval('print_output(\"' . fetch_template('cyb_apboupc_globalset') . '\");');\r\n\t\t\t}\r\n\r\n\t\t\tif (in_array($vbulletin->userinfo['userid'], preg_split('#\\s*,\\s*#s', $vbulletin->config['SpecialUsers']['superadministrators'], -1, PREG_SPLIT_NO_EMPTY)) AND $_REQUEST['do']=='apboupcpermupdate')\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t\t'forumpermupdate'\t\t=> TYPE_NOHTML,\r\n\t\t\t\t\t'threadpermupdate'\t\t=> TYPE_NOHTML,\r\n\t\t\t\t\t'createpermupdate'\t\t=> TYPE_NOHTML,\r\n\t\t\t\t\t'replypermupdate'\t\t=> TYPE_NOHTML,\r\n\t\t\t\t\t'attachpermupdate'\t\t=> TYPE_NOHTML,\r\n\t\t\t\t\t'linkviewpermupdate'\t=> TYPE_NOHTML,\r\n\t\t\t\t\t'linkpostpermupdate'\t=> TYPE_NOHTML)\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif ($vbulletin->GPC['forumpermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET accessf_nb = '\" . $vbulletin->GPC['forumpermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->GPC['threadpermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET accesst_nb = '\" . $vbulletin->GPC['threadpermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->GPC['createpermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET create_nb = '\" . $vbulletin->GPC['createpermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->GPC['replypermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET reply_nb = '\" . $vbulletin->GPC['replypermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->GPC['attachpermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET attach_nb = '\" . $vbulletin->GPC['attachpermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->GPC['linkviewpermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET linkview_nb = '\" . $vbulletin->GPC['linkviewpermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->GPC['linkpostpermupdate'] != '')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"forum SET linkpost_nb = '\" . $vbulletin->GPC['linkpostpermupdate'] . \"' \");\r\n\t\t\t\t}\r\n\t\t\t\trequire_once(DIR . '/includes/adminfunctions.php');\r\n\t\t\t\tbuild_forum_permissions();\r\n\t\t\t\texec_header_redirect($vbulletin->url);\r\n\t\t\t}\r\n\t\t}\r\nif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_invite'] AND ($_REQUEST['do'] == 'cybareginv') AND $vbulletin->userinfo['userid'])\r\n\t\t{\r\n\t\t\t$cybareg_sectok = $vbulletin->userinfo['securitytoken'];\r\n\t\t\tif (!$cybareg_sectok)\r\n\t\t\t{\r\n\t\t\t\t$cybareg_sectok = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tif ($vbulletin->options['cybareg_enable_invite_only'])\r\n\t\t\t{\r\n\t\t\t\t$cybareg_invmess_preview = construct_phrase($vbphrase['cybareg_invitation_message_text_code'], $vbulletin->options['bbtitle'], $vbulletin->options['bburl'], '***********', $vbulletin->userinfo['username'].'<span id=\"cybareg_nameupd\"></span>');\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cybareg_invmess_preview = construct_phrase($vbphrase['cybareg_invitation_message_text'], $vbulletin->options['bbtitle'], $vbulletin->options['bburl'], $vbulletin->userinfo['username'].'<span id=\"cybareg_nameupd\"></span>');\r\n\t\t\t}\r\n\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$cyb_areg_total_inv_user = 0;\r\n\t\t\t$cyb_areg_inv_timecut = \"\";\r\n\t\t\tif ($vbulletin->options['cybareg_invite_amount']>0)\r\n\t\t\t{\r\n\t\t\t\t$cyb_areg_inv_timecut_week = TIMENOW - 604800;\r\n\t\t\t\t$cyb_areg_inv_timecut = \"AND sent > $cyb_areg_inv_timecut_week\";\r\n\t\t\t}\r\n\t\t\t$cyb_areg_invuserinfo = $vbulletin->db->query_read(\"\r\n\t\t\t\tSELECT id, inviter, sent\r\n\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg_invite AS cyb_advreg_invite\r\n\t\t\t\tWHERE inviter = '\".$db->escape_string($vbulletin->userinfo['userid']).\"' $cyb_areg_inv_timecut\r\n\t\t\t\");\r\n\t\t\t$cyb_areg_total_inv_user = $vbulletin->db->num_rows($cyb_areg_invuserinfo);\r\n\t\t\t$cyb_areg_total_inv_user_rem = $vbulletin->options['cybareg_invite_amount'] - $cyb_areg_total_inv_user;\r\n\t\t\t\r\n\t\t\t$cyb_areg_inv_myinfo = \"\";\r\n\t\t\tif (($cyb_areg_total_inv_user > 0) OR ($vbulletin->options['cybareg_invite_amount']>0))\r\n\t\t\t{\r\n\t\t\t\t$cyb_areg_inv_myinfo = \"<span class=\\\"smallfont\\\">(\";\r\n\t\t\t\tif ($cyb_areg_total_inv_user > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_areg_inv_myinfo .= construct_phrase($vbphrase['cybareg_invitation_done_info'], $cyb_areg_total_inv_user);\r\n\t\t\t\t}\r\n\t\t\t\tif ($vbulletin->options['cybareg_invite_amount']>0)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ($cyb_areg_total_inv_user > 0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cyb_areg_inv_myinfo .= \", \";\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$cyb_areg_inv_myinfo .= construct_phrase($vbphrase['cybareg_invitation_avail_info'], $cyb_areg_total_inv_user_rem);\r\n\t\t\t\t}\r\n\t\t\t\t$cyb_areg_inv_myinfo .= \")</span>\";\r\n\t\t\t}\r\n\r\n\t\t\t$db->show_errors();\r\n\r\n\t\t\t$navbits = construct_navbits(array('' => $vbphrase['cybareg_invitations']));\r\n\t\t\teval('$navbar = \"' . fetch_template('navbar') . '\";');\r\n\t\t\teval('print_output(\"' . fetch_template('cyb_areg_invite') . '\");');\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_invite'] AND ($_REQUEST['do'] == 'cybareginvdo'))\r\n\t\t{\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t'cybareg_inviter_id' => TYPE_UINT,\r\n\t\t\t\t'cybareg_inviter_name' => TYPE_NOHTML,\r\n\t\t\t\t'cybareg_invite_email' => TYPE_NOHTML)\r\n\t\t\t);\r\n\t\t\t$cybareg_invcode = TIMENOW .$vbulletin->userinfo['userid'];\r\n\t\t\tif ($vbulletin->GPC['cybareg_inviter_name']=='')\r\n\t\t\t{\r\n\t\t\t\t$cybareg_invitername = $vbulletin->userinfo['username'];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cybareg_invitername = $vbulletin->userinfo['username'].\" (\".$vbulletin->GPC['cybareg_inviter_name'].\")\";\r\n\t\t\t}\r\n\r\n\t\t\trequire_once(DIR . '/includes/functions_misc.php');\r\n\t\t\tif ($vbulletin->options['cybareg_enable_invite_only'])\r\n\t\t\t{\r\n\t\t\t\t$text_message = construct_phrase($vbphrase['cybareg_invitation_message_text_code'],$vbulletin->options['bbtitle'],$vbulletin->options['bburl'], $cybareg_invcode, $cybareg_invitername);\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$text_message = construct_phrase($vbphrase['cybareg_invitation_message_text'],$vbulletin->options['bbtitle'],$vbulletin->options['bburl'], $cybareg_invitername);\r\n\t\t\t}\r\n\t\t\t$text_subject = construct_phrase($vbphrase['cybareg_invitation_subject'],$vbulletin->options['bbtitle']);\r\n\r\n\t\t\tif(strstr($vbulletin->GPC['cybareg_invite_email'],','))\r\n\t\t\t{\r\n\t\t\t\t$cybareg_invitedmails = explode(',', $vbulletin->GPC['cybareg_invite_email']);\r\n\t\t\t\tforeach ($cybareg_invitedmails AS $cybareg_invitedmail)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybareg_checkifexist = $db->query_first(\" SELECT * FROM \" . TABLE_PREFIX . \"user WHERE email = '\".$cybareg_invitedmail.\"' \");\r\n\t\t\t\t\tif ($cybareg_checkifexist)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_alreadyexist .= ', '.$cybareg_invitedmail;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$cybareg_checkifsent = $db->query_first(\" SELECT * FROM \" . TABLE_PREFIX . \"cyb_advreg_invite WHERE invited = '\".$cybareg_invitedmail.\"' \");\r\n\t\t\t\t\tif ($cybareg_checkifsent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_alreadysent .= ', '.$cybareg_invitedmail;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ($cybareg_alreadyexist=='' AND $cybareg_alreadysent=='')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$vbulletin->db->query_write(\"\r\n\t\t\t\t\t\t\tINSERT INTO `\". TABLE_PREFIX .\"cyb_advreg_invite`\r\n\t\t\t\t\t\t\t(inviter, invited, code, sent, done)\r\n\t\t\t\t\t\t\tVALUES ('\".$db->escape_string($vbulletin->GPC['cybareg_inviter_id']).\"', '\".$db->escape_string($cybareg_invitedmail).\"', '\".$cybareg_invcode.\"', '\". TIMENOW .\"', 0)\r\n\t\t\t\t\t\t\");\r\n\t\t\t\t\t\tvbmail($cybareg_invitedmail, $text_subject, $text_message, true);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$cybareg_alreadyexist = substr($cybareg_alreadyexist,1);\r\n\t\t\t\t$cybareg_alreadysent = substr($cybareg_alreadysent,1);\r\n\t\t\t\tif ($cybareg_alreadyexist OR $cybareg_alreadysent)\r\n\t\t\t\t{\r\n\t\t\t\t\tif ($cybareg_alreadyexist)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_error_mail .= '<br />'.construct_phrase($vbphrase['cybareg_mail_exist'], $cybareg_alreadyexist);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($cybareg_alreadysent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_error_mail .= '<br />'.construct_phrase($vbphrase['cybareg_mail_sent'], $cybareg_alreadysent);\r\n\t\t\t\t\t}\r\n\t\t\t\t\teval(standard_error(fetch_error('cybareg_error_mail', $cybareg_error_mail)));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cybareg_checkifexist = $db->query_first(\" SELECT * FROM \" . TABLE_PREFIX . \"user WHERE email = '\".$vbulletin->GPC['cybareg_invite_email'].\"' \");\r\n\t\t\t\tif ($cybareg_checkifexist)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybareg_alreadyexist = $vbulletin->GPC['cybareg_invite_email'];\r\n\t\t\t\t}\r\n\t\t\t\t$cybareg_checkifsent = $db->query_first(\" SELECT * FROM \" . TABLE_PREFIX . \"cyb_advreg_invite WHERE invited = '\".$vbulletin->GPC['cybareg_invite_email'].\"' \");\r\n\t\t\t\tif ($cybareg_checkifsent)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybareg_alreadysent = $vbulletin->GPC['cybareg_invite_email'];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($cybareg_alreadyexist=='' AND $cybareg_alreadysent=='')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\"\r\n\t\t\t\t\t\tINSERT INTO `\". TABLE_PREFIX .\"cyb_advreg_invite`\r\n\t\t\t\t\t\t(inviter, invited, code, sent, done)\r\n\t\t\t\t\t\tVALUES ('\".$db->escape_string($vbulletin->GPC['cybareg_inviter_id']).\"', '\".$db->escape_string($vbulletin->GPC['cybareg_invite_email']).\"', '\".$cybareg_invcode.\"', '\". TIMENOW .\"', 0)\r\n\t\t\t\t\t\");\r\n\t\t\t\t\tvbmail($vbulletin->GPC['cybareg_invite_email'], $text_subject, $text_message, true);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tif ($cybareg_alreadyexist)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_error_mail .= '<br />'.construct_phrase($vbphrase['cybareg_mail_exist'], $cybareg_alreadyexist);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($cybareg_alreadysent)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_error_mail .= '<br />'.construct_phrase($vbphrase['cybareg_mail_sent'], $cybareg_alreadysent);\r\n\t\t\t\t\t}\r\n\t\t\t\t\teval(standard_error(fetch_error('cybareg_error_mail', $cybareg_error_mail)));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$db->show_errors();\r\n\r\n\t\t\t$vbulletin->url = 'misc.php?do=cybareginv';\r\n\t\t\teval(print_standard_redirect('redirect_cybareg_invitation_sent',1,1));\r\n\t\t}\r\n\t\t\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND is_member_of($vbulletin->userinfo,6))\r\n\t\t{\r\n\t\t\t$cybareg_sectok = $vbulletin->userinfo['securitytoken'];\r\n\t\t\tif (!$cybareg_sectok)\r\n\t\t\t{\r\n\t\t\t\t$cybareg_sectok = 'none';\r\n\t\t\t}\r\n\r\n\t\t\tif ($_REQUEST['do'] == 'cybaregman')\r\n\t\t\t{\r\n\t\t\t\t$db->hide_errors();\r\n\r\n\t\t\t\t$cybareg_display_act = \"none\";\r\n\t\t\t\t$cybareg_display_mod = \"none\";\r\n\t\t\t\t$cybareg_display_q = \"none\";\r\n\t\t\t\t$cybareg_display_i = \"none\";\r\n\t\t\t\tswitch ($_REQUEST['ca'])\r\n\t\t\t\t{\r\n\t\t\t\t\tcase ma: $cybareg_display_act = \"block\"; ; break;\r\n\t\t\t\t\tcase mm: $cybareg_display_mod = \"block\"; ; break;\r\n\t\t\t\t\tcase mq: $cybareg_display_q = \"block\"; ; break;\r\n\t\t\t\t\tcase mi: $cybareg_display_i = \"block\"; ; break;\r\n\t\t\t\t\tdefault: $cybareg_display_mod = \"block\"; ; break;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($vbulletin->options['cybareg_prune_days']>0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybereg_prunetime = TIMENOW - ($vbulletin->options['cybareg_prune_days'] * 86400);\r\n\t\t\t\t\t$vbulletin->db->query_write(\" DELETE FROM \" . TABLE_PREFIX . \"user WHERE joindate < '\".$cybereg_prunetime.\"' AND usergroupid=3 AND posts=0 \");\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$perpage = $vbulletin->input->clean_gpc('r', 'rpp', TYPE_UINT);\r\n\t\t\t\tif (!$perpage)\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybareg_ppfirst = strpos($vbulletin->options['cybareg_perpage'], \",\");\r\n\t\t\t\t\t$perpage = substr($vbulletin->options['cybareg_perpage'],0,$cybareg_ppfirst);\r\n\t\t\t\t}\r\n\t\t\t\t$cybareg_perpage = explode(',', $vbulletin->options['cybareg_perpage']);\r\n\t\t\t\tforeach ($cybareg_perpage AS $cybareg_ppitem)\r\n\t\t\t\t{\r\n\t\t\t\t\teval('$cybareg_perpageitems .= \" <option value=\\\"'.$cybareg_ppitem.'\\\" \" . iif($perpage==$cybareg_ppitem,\" selected=\\\"selected\\\"\",\"\").\">'.$cybareg_ppitem.'</option> \";');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($_REQUEST['ca'] == 'mq')\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_q = $vbulletin->input->clean_gpc('r', 'page', TYPE_UINT);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_q = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cybareg_pngettot_q = $vbulletin->db->query_read(\" SELECT id FROM \" . TABLE_PREFIX . \"cyb_advreg AS cyb_advreg \");\r\n\t\t\t\t$cybareg_pntot_q = $vbulletin->db->num_rows($cybareg_pngettot_q);\r\n\t\t\t\tsanitize_pageresults($cybareg_pntot_q, $pagenumber_q, $perpage, 100, 25);\r\n\t\t\t\t$limitlower_q = ($pagenumber_q - 1) * $perpage + 1;\r\n\t\t\t\t$limitupper_q = $pagenumber_q * $perpage;\r\n\t\t\t\tif ($limitupper_q > $cybareg_pntot_q)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitupper_q = $cybareg_pntot_q;\r\n\t\t\t\t\tif ($limitlower_q > $cybareg_pntot_q)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$limitlower_q = $cybareg_pntot_q - $perpage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ($limitlower_q <= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitlower_q = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cyb_areg_totalq = 0;\r\n\t\t\t\t$cyb_aregs_info = $vbulletin->db->query_read(\"\r\n\t\t\t\t\tSELECT id, question, answer, active\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg AS cyb_advreg\r\n\t\t\t\t\tORDER BY id ASC\r\n\t\t\t\t\tLIMIT \" . ($limitlower_q - 1) . \", $perpage\r\n\t\t\t\t\");\r\n\t\t\t\t$cyb_areg_totalq = $cybareg_pntot_q;\r\n\t\t\t\t$cybareg_rowid = $limitlower_q - 1;\r\n\t\t\t\twhile ($cybareg = $db->fetch_array($cyb_aregs_info))\r\n\t\t\t\t{\r\n\t\t\t\t\texec_switch_bg();\r\n\t\t\t\t\t$cybareg_itemid = $cybareg[id];\r\n\t\t\t\t\t$cybareg_rowid += 1;\r\n\t\t\t\t\teval('$cybaregs .= \"' . $vbulletin->templatecache['cyb_areg_manage_bit'] . '\";');\r\n\t\t\t\t}\r\n\t\t\t\t$pagenav_q = construct_page_nav($pagenumber_q, $perpage, $cybareg_pntot_q, 'misc.php?' . $vbulletin->session->vars['sessionurl'] . 'do=cybaregman&amp;ca=mq&amp;rpp='.$perpage, \"\");\r\n\r\n\t\t\t\tif ($_REQUEST['ca'] == 'mm')\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_m = $vbulletin->input->clean_gpc('r', 'page', TYPE_UINT);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_m = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cybareg_pngettot_m = $vbulletin->db->query_read(\" SELECT userid FROM \" . TABLE_PREFIX . \"user AS user WHERE usergroupid=4 \");\r\n\t\t\t\t$cybareg_pntot_m = $vbulletin->db->num_rows($cybareg_pngettot_m);\r\n\t\t\t\tsanitize_pageresults($cybareg_pntot_m, $pagenumber_m, $perpage, 100, 25);\r\n\t\t\t\t$limitlower_m = ($pagenumber_m - 1) * $perpage + 1;\r\n\t\t\t\t$limitupper_m = $pagenumber_m * $perpage;\r\n\t\t\t\tif ($limitupper_m > $cybareg_pntot_m)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitupper_m = $cybareg_pntot_m;\r\n\t\t\t\t\tif ($limitlower_m > $cybareg_pntot_m)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$limitlower_m = $cybareg_pntot_m - $perpage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ($limitlower_m <= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitlower_m = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cyb_areg_totalu_mod = 0;\r\n\t\t\t\t$cyb_areg_notmodinfo = $vbulletin->db->query_read(\"\r\n\t\t\t\t\tSELECT userid, username, usergroupid, displaygroupid, email, ipaddress, joindate\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"user AS user\r\n\t\t\t\t\tWHERE usergroupid=4\r\n\t\t\t\t\tORDER BY userid DESC\r\n\t\t\t\t\tLIMIT \" . ($limitlower_m - 1) . \", $perpage\r\n\t\t\t\t\");\r\n\t\t\t\t$cyb_areg_totalu_mod = $cybareg_pntot_m;\r\n\t\t\t\t$cybareguser_rowid = $limitlower_m - 1;\r\n\t\t\t\twhile ($cybareguser = $db->fetch_array($cyb_areg_notmodinfo))\r\n\t\t\t\t{\r\n\t\t\t\t\texec_switch_bg();\r\n\t\t\t\t\t$cybareguser_rowid += 1;\r\n\t\t\t\t\t$cybareguser_userid = $cybareguser[userid];\r\n\t\t\t\t\tif ($cybareguser['userid'])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_inviter = '<a href=\"member.php?u='.$cybareguser['userid'].'\">'.fetch_musername($cybareguser).'</a>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\t\t\t\t\t\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_inviter = $vbphrase['n_a'].' (ID: '.$cybareguser['inviter'].')';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$cybareguser_userjoin = vbdate($vbulletin->options['dateformat'].\", \".$vbulletin->options['timeformat'], $cybareguser[joindate]);\r\n\t\t\t\t\teval('$cybaregusers_mod .= \"' . $vbulletin->templatecache['cyb_areg_manageuser_bit'] . '\";');\r\n\t\t\t\t}\r\n\t\t\t\t$pagenav_m = construct_page_nav($pagenumber_m, $perpage, $cybareg_pntot_m, 'misc.php?' . $vbulletin->session->vars['sessionurl'] . 'do=cybaregman&amp;ca=mm&amp;rpp='.$perpage, \"\");\r\n\t\t\t\tunset($cybareguser,$cybareguser_rowid,$cybareguser_userid,$cybareguser_userjoin);\r\n\r\n\t\t\t\tif ($_REQUEST['ca'] == 'ma')\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_a = $vbulletin->input->clean_gpc('r', 'page', TYPE_UINT);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_a = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cybareg_pngettot_a = $vbulletin->db->query_read(\" SELECT userid FROM \" . TABLE_PREFIX . \"user AS user WHERE usergroupid=3 \");\r\n\t\t\t\t$cybareg_pntot_a = $vbulletin->db->num_rows($cybareg_pngettot_a);\r\n\t\t\t\tsanitize_pageresults($cybareg_pntot_a, $pagenumber_a, $perpage, 100, 25);\r\n\t\t\t\t$limitlower_a = ($pagenumber_a - 1) * $perpage + 1;\r\n\t\t\t\t$limitupper_a = $pagenumber_a * $perpage;\r\n\t\t\t\tif ($limitupper_a > $cybareg_pntot_a)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitupper_a = $cybareg_pntot_a;\r\n\t\t\t\t\tif ($limitlower_a > $cybareg_pntot_a)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$limitlower_a = $cybareg_pntot_a - $perpage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ($limitlower_a <= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitlower_a = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cyb_areg_totalu_act = 0;\r\n\t\t\t\t$cyb_areg_notactinfo = $vbulletin->db->query_read(\"\r\n\t\t\t\t\tSELECT userid, username, usergroupid, displaygroupid, email, ipaddress, joindate\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"user AS user\r\n\t\t\t\t\tWHERE usergroupid=3\r\n\t\t\t\t\tORDER BY userid DESC\r\n\t\t\t\t\tLIMIT \" . ($limitlower_a - 1) . \", $perpage\r\n\t\t\t\t\");\r\n\t\t\t\t$cyb_areg_totalu_act = $cybareg_pntot_a;\r\n\t\t\t\t$cybareguser_rowid = $limitlower_a - 1;\r\n\t\t\t\twhile ($cybareguser = $db->fetch_array($cyb_areg_notactinfo))\r\n\t\t\t\t{\r\n\t\t\t\t\texec_switch_bg();\r\n\t\t\t\t\t$cybareguser_rowid += 1;\r\n\t\t\t\t\t$cybareguser_userid = $cybareguser[userid];\r\n\t\t\t\t\tif ($cybareguser['userid'])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_inviter = '<a href=\"member.php?u='.$cybareguser['userid'].'\">'.fetch_musername($cybareguser).'</a>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\t\t\t\t\t\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_inviter = $vbphrase['n_a'].' (ID: '.$cybareguser['inviter'].')';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$cybareguser_userjoin = vbdate($vbulletin->options['dateformat'].\", \".$vbulletin->options['timeformat'], $cybareguser[joindate]);\r\n\t\t\t\t\teval('$cybaregusers_act .= \"' . $vbulletin->templatecache['cyb_areg_manageuser_bit'] . '\";');\r\n\t\t\t\t}\r\n\t\t\t\t$pagenav_a = construct_page_nav($pagenumber_a, $perpage, $cybareg_pntot_a, 'misc.php?' . $vbulletin->session->vars['sessionurl'] . 'do=cybaregman&amp;ca=ma&amp;rpp='.$perpage, \"\");\r\n\t\t\t\tunset($cybareguser,$cybareguser_rowid,$cybareguser_userid,$cybareguser_userjoin);\r\n\r\n\t\t\t\tif ($_REQUEST['ca'] == 'mi')\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_i = $vbulletin->input->clean_gpc('r', 'page', TYPE_UINT);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$pagenumber_i = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cybareg_pngettot_i = $vbulletin->db->query_read(\" SELECT id FROM \" . TABLE_PREFIX . \"cyb_advreg_invite AS cyb_advreg_invite \");\r\n\t\t\t\t$cybareg_pntot_i = $vbulletin->db->num_rows($cybareg_pngettot_i);\r\n\t\t\t\tsanitize_pageresults($cybareg_pntot_i, $pagenumber_i, $perpage, 100, 25);\r\n\t\t\t\t$limitlower_i = ($pagenumber_i - 1) * $perpage + 1;\r\n\t\t\t\t$limitupper_i = $pagenumber_i * $perpage;\r\n\t\t\t\tif ($limitupper_i > $cybareg_pntot_i)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitupper_i = $cybareg_pntot_i;\r\n\t\t\t\t\tif ($limitlower_i > $cybareg_pntot_i)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$limitlower_i = $cybareg_pntot_i - $perpage;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ($limitlower_i <= 0)\r\n\t\t\t\t{\r\n\t\t\t\t\t$limitlower_i = 1;\r\n\t\t\t\t}\r\n\t\t\t\t$cyb_areg_totalu_inv = 0;\r\n\t\t\t\t$cyb_areg_inviteinfo = $vbulletin->db->query_read(\"\r\n\t\t\t\t\tSELECT cyb_advreg_invite.id, cyb_advreg_invite.inviter, cyb_advreg_invite.invited, cyb_advreg_invite.sent, cyb_advreg_invite.accepted, cyb_advreg_invite.done, user.userid, user.username, user.usergroupid, user.displaygroupid, who.username AS username_done, who.joindate\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg_invite AS cyb_advreg_invite\r\n\t\t\t\t\tLEFT JOIN \" . TABLE_PREFIX . \"user AS user ON (user.userid = cyb_advreg_invite.inviter)\r\n\t\t\t\t\tLEFT JOIN \" . TABLE_PREFIX . \"user AS who ON (who.userid = cyb_advreg_invite.accepted)\r\n\t\t\t\t\tORDER BY id DESC\r\n\t\t\t\t\tLIMIT \" . ($limitlower_i - 1) . \", $perpage\r\n\t\t\t\t\");\r\n\t\t\t\t$cyb_areg_totalu_inv = $cybareg_pntot_i;\r\n\t\t\t\t$cybareguser_rowid = $limitlower_i - 1;\r\n\t\t\t\twhile ($cybareguser = $db->fetch_array($cyb_areg_inviteinfo))\r\n\t\t\t\t{\r\n\t\t\t\t\texec_switch_bg();\r\n\t\t\t\t\t$cybareguser_rowid += 1;\r\n\t\t\t\t\t$cybareguser_id = $cybareguser[id];\r\n\t\t\t\t\tif ($cybareguser['userid'])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_inviter = '<a href=\"member.php?u='.$cybareguser['userid'].'\">'.fetch_musername($cybareguser).'</a>';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\t\t\t\t\t\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareg_inviter = $vbphrase['n_a'].' (ID: '.$cybareguser['inviter'].')';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$cybareguser_sent = vbdate($vbulletin->options['dateformat'].\", \".$vbulletin->options['timeformat'], $cybareguser['sent']);\r\n\t\t\t\t\tif ($cybareguser[accepted]>0)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareguser_accept_date = vbdate($vbulletin->options['dateformat'].\", \".$vbulletin->options['timeformat'], $cybareguser['joindate']);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cybareguser_accept_date = $vbphrase['cybareg_not_accepted'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\teval('$cybaregusers_inv .= \"' . $vbulletin->templatecache['cyb_areg_manageinv_bit'] . '\";');\r\n\t\t\t\t}\r\n\t\t\t\t$pagenav_i = construct_page_nav($pagenumber_i, $perpage, $cybareg_pntot_i, 'misc.php?' . $vbulletin->session->vars['sessionurl'] . 'do=cybaregman&amp;ca=mi&amp;rpp='.$perpage, \"\");\t\t\t\t\r\n\t\t\t\t$db->show_errors();\r\n\r\n\t\t\t\tif ($_POST['armultibit']!='')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t\t\t'armultibit' => TYPE_ARRAY,\r\n\t\t\t\t\t\t'cybareg_mdf' => TYPE_NOHTML)\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$cybaregmultisel = implode(',', $vbulletin->GPC['armultibit']);\r\n\t\t\t\t\t$db->hide_errors();\r\n\t\t\t\t\tif ($vbulletin->GPC['cybareg_mdf']=='delete')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$vbulletin->db->query_write(\" DELETE FROM \" . TABLE_PREFIX . \"cyb_advreg WHERE id IN($cybaregmultisel) \");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($vbulletin->GPC['cybareg_mdf']=='active')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg SET active = '1' WHERE id IN($cybaregmultisel) \");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($vbulletin->GPC['cybareg_mdf']=='inactive')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg SET active = '0' WHERE id IN($cybaregmultisel) \");\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$db->show_errors();\r\n\t\t\t\t\texec_header_redirect('misc.php?do=cybaregman&amp;ca=mq');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($_POST['armultibiti']!='')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t\t\t'armultibiti' => TYPE_ARRAY)\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$cybaregmultisel = implode(',', $vbulletin->GPC['armultibiti']);\r\n\t\t\t\t\t$db->hide_errors();\r\n\t\t\t\t\t$vbulletin->db->query_write(\" DELETE FROM \" . TABLE_PREFIX . \"cyb_advreg_invite WHERE id IN($cybaregmultisel) \");\r\n\t\t\t\t\t$db->show_errors();\r\n\t\t\t\t\texec_header_redirect('misc.php?do=cybaregman&amp;ca=mi');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ($_POST['armultibitu']!='')\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t\t\t'armultibitu' => TYPE_ARRAY,\r\n\t\t\t\t\t\t'cybareg_mdfu' => TYPE_NOHTML,\r\n\t\t\t\t\t\t'cybareg_doemail' => TYPE_UINT,\r\n\t\t\t\t\t\t'cybareg_page' => TYPE_NOHTML)\r\n\t\t\t\t\t);\r\n\t\t\t\t\t$cybaregmultiselu = implode(',', $vbulletin->GPC['armultibitu']);\r\n\t\t\t\t\t$db->hide_errors();\r\n\t\t\t\t\tif ($vbulletin->GPC['cybareg_mdfu']=='delete')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$vbulletin->db->query_write(\" DELETE FROM \" . TABLE_PREFIX . \"user WHERE userid IN($cybaregmultiselu) \");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ($vbulletin->GPC['cybareg_mdfu']=='active')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"user SET usergroupid = '2' WHERE userid IN($cybaregmultiselu) \");\r\n\r\n\t\t\t\t\t\tif ($vbulletin->GPC['cybareg_doemail']=='1')\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t$cybereg_maillist = explode(',', $cybaregmultiselu);\r\n\t\t\t\t\t\t\tforeach ($cybereg_maillist AS $cybereg_mailuser)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t$user = $db->query_first(\"\r\n\t\t\t\t\t\t\t\t\tSELECT *\r\n\t\t\t\t\t\t\t\t\tFROM \" . TABLE_PREFIX . \"user\r\n\t\t\t\t\t\t\t\t\tWHERE userid = $cybereg_mailuser\r\n\t\t\t\t\t\t\t\t\");\r\n\t\t\t\t\t\t\t\t$username = unhtmlspecialchars($user['username']);\r\n\t\t\t\t\t\t\t\t$chosenlanguage = iif($user['languageid'] < 1, intval($vbulletin->options['languageid']), intval($user['languageid']));\r\n\t\t\t\t\t\t\t\t$email_text = $db->query_first(\"\r\n\t\t\t\t\t\t\t\t\tSELECT text\r\n\t\t\t\t\t\t\t\t\tFROM \" . TABLE_PREFIX . \"phrase\r\n\t\t\t\t\t\t\t\t\tWHERE fieldname = 'emailbody'\r\n\t\t\t\t\t\t\t\t\t\tAND varname = 'moderation_validated'\r\n\t\t\t\t\t\t\t\t\t\tAND languageid IN(-1,0,$chosenlanguage)\r\n\t\t\t\t\t\t\t\t\tORDER BY languageid DESC\r\n\t\t\t\t\t\t\t\t\");\r\n\t\t\t\t\t\t\t\t$email_subject = $db->query_first(\"\r\n\t\t\t\t\t\t\t\t\tSELECT text\r\n\t\t\t\t\t\t\t\t\tFROM \" . TABLE_PREFIX . \"phrase\r\n\t\t\t\t\t\t\t\t\tWHERE fieldname = 'emailsubject'\r\n\t\t\t\t\t\t\t\t\t\tAND varname = 'moderation_validated'\r\n\t\t\t\t\t\t\t\t\t\tAND languageid IN(-1,0,$chosenlanguage)\r\n\t\t\t\t\t\t\t\t\tORDER BY languageid DESC\r\n\t\t\t\t\t\t\t\t\");\r\n\t\t\t\t\t\t\t\trequire_once(DIR . '/includes/functions_misc.php');\r\n\t\t\t\t\t\t\t\t$text_message = replace_template_variables(str_replace(\"\\\\'\", \"'\", addslashes($email_text['text'])));\r\n\t\t\t\t\t\t\t\t$text_subject = replace_template_variables(str_replace(\"\\\\'\", \"'\", addslashes($email_subject['text'])));\r\n\t\t\t\t\t\t\t\t$evalemail_validated[\"$user[languageid]\"] = '\r\n\t\t\t\t\t\t\t\t\t$message = \"' . $text_message . '\";\r\n\t\t\t\t\t\t\t\t\t$subject = \"' . $text_subject . '\";\r\n\t\t\t\t\t\t\t\t';\r\n\t\t\t\t\t\t\t\teval($evalemail_validated[\"$user[languageid]\"]);\r\n\t\t\t\t\t\t\t\tvbmail($user['email'], $subject, $message, true);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t$db->show_errors();\r\n\t\t\t\t\tif ($vbulletin->GPC['cybareg_page']=='ma')\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\texec_header_redirect('misc.php?do=cybaregman&amp;ca=ma');\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\texec_header_redirect('misc.php?do=cybaregman&amp;ca=mm');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$navbits = construct_navbits(array('' => $vbphrase['cybareg_manage_areg']));\r\n\t\t\t\teval('$navbar = \"' . fetch_template('navbar') . '\";');\r\n\t\t\t\teval('print_output(\"' . fetch_template('cyb_areg_manage') . '\");');\r\n\t\t\t}\r\n\r\n\t\t\tif ($_REQUEST['do'] == 'cybaregadddo')\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t\t'question' => TYPE_NOHTML,\r\n\t\t\t\t\t'answer' => TYPE_NOHTML,\r\n\t\t\t\t\t'active' => TYPE_UINT)\r\n\t\t\t\t);\r\n\r\n\t\t\t\t$db->hide_errors();\r\n\t\t\t\t$vbulletin->db->query_write(\"\r\n\t\t\t\t\tINSERT INTO `\". TABLE_PREFIX .\"cyb_advreg`\r\n\t\t\t\t\t(question, answer, active)\r\n\t\t\t\t\tVALUES ('\".$db->escape_string($vbulletin->GPC['question']).\"', '\".$db->escape_string($vbulletin->GPC['answer']).\"', '\".$vbulletin->GPC['active'].\"')\r\n\t\t\t\t\");\r\n\t\t\t\t$db->show_errors();\r\n\t\t\t\texec_header_redirect('misc.php?do=cybaregman&amp;ca=mq');\r\n\t\t\t}\r\n\r\n\t\t\tif ($_REQUEST['do'] == 'cybaregedit')\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->input->clean_gpc('r', 'aregid', TYPE_UINT);\r\n\t\t\t\t$db->hide_errors();\r\n\t\t\t\t$cyb_areg_info = $vbulletin->db->query_first(\"\r\n\t\t\t\t\tSELECT id, question, answer, active\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg AS cyb_advreg\r\n\t\t\t\t\tWHERE id = '\".$vbulletin->GPC['aregid'].\"'\r\n\t\t\t\t\");\r\n\t\t\t\t$db->show_errors();\r\n\r\n\t\t\t\t$navbits = construct_navbits(array('' => $vbphrase['cybareg_edit']));\r\n\t\t\t\teval('$navbar = \"' . fetch_template('navbar') . '\";');\t\r\n\t\t\t\teval('print_output(\"' . fetch_template('cyb_areg_edit') . '\");');\r\n\t\t\t}\r\n\r\n\t\t\tif (($_REQUEST['do'] == 'cybaregeditdo') AND is_member_of($vbulletin->userinfo,6))\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t\t'id' => TYPE_UINT,\r\n\t\t\t\t\t'question' => TYPE_NOHTML,\r\n\t\t\t\t\t'answer' => TYPE_NOHTML,\r\n\t\t\t\t\t'active' => TYPE_UINT)\r\n\t\t\t\t);\r\n\t\t\t\t$db->hide_errors();\r\n\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg SET question = '\".$db->escape_string($vbulletin->GPC['question']).\"' WHERE id = '\".$vbulletin->GPC['id'].\"' \");\r\n\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg SET answer = '\".$db->escape_string($vbulletin->GPC['answer']).\"' WHERE id = '\".$vbulletin->GPC['id'].\"' \");\r\n\t\t\t\tif ($vbulletin->GPC['active']=='1')\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybareg_active = '1';\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$cybareg_active = '0';\r\n\t\t\t\t}\r\n\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg SET active = '\".$cybareg_active.\"' WHERE id = '\".$vbulletin->GPC['id'].\"' \");\r\n\t\t\t\t$db->show_errors();\r\n\t\t\t\texec_header_redirect('misc.php?do=cybaregman&amp;ca=mq');\r\n\t\t\t}\r\n\t\t}\r\n", 
  "fetch_userinfo": "if (defined('VBBLOG_PERMS'))\r\n{\r\n\tforeach($vbulletin->bf_misc_vbbloguseroptions AS $optionname => $optionval)\r\n\t{\r\n\t\t$user['blog_' . $optionname] = ($user['blog_options'] & $optionval ? 1 : 0);\r\n\t}\r\n\r\n\tcache_permissions($user, false);\r\n\r\n\tif (!$user['bloguserid'])\r\n\t{\r\n\t\t$user['blog_allowcomments'] = $vbulletin->bf_misc_vbblogregoptions['allowcomments'] & $vbulletin->options['vbblog_defaultoptions'] ? true : false;\r\n\t\t$user['blog_allowpingback'] = $vbulletin->bf_misc_vbblogregoptions['allowpingback'] & $vbulletin->options['vbblog_defaultoptions'] ? true : false;\r\n\t\t$user['blog_moderatecomments'] = $vbulletin->bf_misc_vbblogregoptions['moderatecomments'] & $vbulletin->options['vbblog_defaultoptions'] ? true : false;\r\n\t\tif ($vbulletin->bf_misc_vbblogregoptions['subscribe_none_entry'] & $vbulletin->options['vbblog_defaultoptions'])\r\n\t\t{\r\n\t\t\t$user['blog_subscribeown'] = 'none';\r\n\t\t}\r\n\t\telse if ($vbulletin->bf_misc_vbblogregoptions['subscribe_nonotify_entry'] & $vbulletin->options['vbblog_defaultoptions'])\r\n\t\t{\r\n\t\t\t$user['blog_subscribeown'] = 'usercp';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$user['blog_subscribeown'] = 'email';\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->bf_misc_vbblogregoptions['subscribe_none_comment'] & $vbulletin->options['vbblog_defaultoptions'])\r\n\t\t{\r\n\t\t\t$user['blog_subscribeothers'] = 'none';\r\n\t\t}\r\n\t\telse if ($vbulletin->bf_misc_vbblogregoptions['subscribe_nonotify_comment'] & $vbulletin->options['vbblog_defaultoptions'])\r\n\t\t{\r\n\t\t\t$user['blog_subscribeothers'] = 'usercp';\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$user['blog_subscribeothers'] = 'email';\r\n\t\t}\r\n\r\n\t\t$user['options_member'] += ($vbulletin->bf_misc_vbblogregoptions['viewblog_member'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['canviewmyblog'] : 0;\r\n\t\t$user['options_guest'] += ($vbulletin->bf_misc_vbblogregoptions['viewblog_guest'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['canviewmyblog'] : 0;\r\n\t\t$user['options_buddy'] += ($vbulletin->bf_misc_vbblogregoptions['viewblog_buddy'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['canviewmyblog'] : 0;\r\n\t\t$user['options_ignore'] += ($vbulletin->bf_misc_vbblogregoptions['viewblog_ignore'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['canviewmyblog'] : 0;\r\n\t\t$user['options_member'] += ($vbulletin->bf_misc_vbblogregoptions['commentblog_member'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['cancommentmyblog'] : 0;\r\n\t\t$user['options_guest'] += ($vbulletin->bf_misc_vbblogregoptions['commentblog_guest'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['cancommentmyblog'] : 0;\r\n\t\t$user['options_buddy'] += ($vbulletin->bf_misc_vbblogregoptions['commentblog_buddy'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['cancommentmyblog'] : 0;\r\n\t\t$user['options_ignore'] += ($vbulletin->bf_misc_vbblogregoptions['commentblog_ignore'] & $vbulletin->options['vbblog_defaultoptions']) ? $vbulletin->bf_misc_vbblogsocnetoptions['cancommentmyblog'] : 0;\r\n\r\n\t\t$user['memberblogids'] = $user['userid'];\r\n\t\t$user['memberids'] = $user['userid'];\r\n\t}\r\n\r\n\trequire_once(DIR . '/includes/blog_functions_shared.php');\r\n\tforeach($vbulletin->bf_misc_vbblogsocnetoptions AS $optionname => $optionval)\r\n\t{\r\n\t\t$user[\"member_$optionname\"] = ($user['options_member'] & $optionval ? 1 : 0);\r\n\t\t$user[\"guest_$optionname\"] = ($user['options_guest'] & $optionval ? 1 : 0);\r\n\t\t$user[\"buddy_$optionname\"] = ($user['options_buddy'] & $optionval ? 1 : 0);\r\n\t\t$user[\"ignore_$optionname\"] = ($user['options_ignore'] & $optionval ? 1 : 0);\r\n\r\n\t\t$user[\"$optionname\"] = (\r\n\t\t\t(\r\n\t\t\t\t(\r\n\t\t\t\t\t!$user['buddyid']\r\n\t\t\t\t\t\tOR\r\n\t\t\t\t\t$user[\"buddy_$optionname\"]\r\n\t\t\t\t)\r\n\t\t\t\tAND\r\n\t\t\t\t(\r\n\t\t\t\t\t!$user['ignoreid']\r\n\t\t\t\t\t\tOR\r\n\t\t\t\t\t$user[\"ignore_$optionname\"]\r\n\t\t\t\t)\r\n\t\t\t\tAND\r\n\t\t\t\t\t(\r\n\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t$user[\"member_$optionname\"]\r\n\t\t\t\t\t\t\t\tAND\r\n\t\t\t\t\t\t\t$vbulletin->userinfo['userid']\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\tOR\r\n\t\t\t\t\t\t(\r\n\t\t\t\t\t\t\t$user[\"guest_$optionname\"]\r\n\t\t\t\t\t\t\t\tAND\r\n\t\t\t\t\t\t\t!$vbulletin->userinfo['userid']\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t)\r\n\t\t\tOR\r\n\t\t\t(\r\n\t\t\t\t$user[\"ignore_$optionname\"]\r\n\t\t\t\t\tAND\r\n\t\t\t\t$user['ignoreid']\r\n\t\t\t)\r\n\t\t\tOR\r\n\t\t\t(\r\n\t\t\t\t$user[\"buddy_$optionname\"]\r\n\t\t\t\t\tAND\r\n\t\t\t\t$user['buddyid']\r\n\t\t\t)\r\n\t\t\t\tOR\r\n\t\t\t($vbulletin->userinfo AND is_member_of_blog($vbulletin->userinfo, $user))\r\n\t\t\t\tOR\r\n\t\t\tcan_moderate_blog()\r\n\t\t\t\tOR\r\n\t\t\t!$vbulletin->userinfo\r\n\t\t) ? true : false;\r\n\t}\r\n\r\n\tif (!$user['blog_title'])\r\n\t{\r\n\t\t$user['blog_title'] = $user['username'];\r\n\t}\r\n\r\n\t$user['categorycache'] = !empty($user['categorycache']) ? @unserialize($user['categorycache']) : array();\r\n\t$user['sidebar'] = !empty($user['sidebar']) ? @unserialize($user['sidebar']) : array();\r\n\t$user['sidebar_customblocks'] = !empty($user['blocktext']) ? @unserialize($user['blocktext']) : array();\r\n\t$user['custompages'] = !empty($user['custompages']) ? @unserialize($user['custompages']) : array();\r\n\tprepare_blog_category_permissions($user);\r\n}\r\n", 
  "blog_entry_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_entry_complete');\r\n$blog['message'] = vbseo_prepare_int_replace($blog['message']);\r\n$blog['message'] = vbseo_process_content_area($blog['message']);\r\n", 
  "report_start": "if ($_POST['do'] == 'sendemail' && THIS_SCRIPT=='report')\r\n{\r\n\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t'reason' => TYPE_STR,\r\n\t));\r\n\r\n\tif ($vbulletin->GPC['reason'] == '')\r\n\t{\r\n\t\teval(standard_error(fetch_error('noreason')));\r\n\t}\r\n\r\n\tif ($perform_floodcheck)\r\n\t{\r\n\t\t$reportobj->perform_floodcheck_commit();\r\n\t}\r\n\r\n\t$reportobj->do_report($vbulletin->GPC['reason'], $postinfo);\r\n\t\r\n\t\r\n\t$forumid = $db->query_first('SELECT thread.forumid FROM ' . TABLE_PREFIX . 'thread AS thread WHERE threadid = ' . $postinfo['threadid']);\r\n\t$forumid = $forumid['forumid'];\r\n\t\r\n\tif ($vbulletin->userinfo['posts'] >= $vbulletin->options['reporting_postcount'] && in_array($forumid, explode(\",\", $vbulletin->options['reporting_forumids'])))\r\n\t{\r\n  \t$postinfo['strikes']++;\r\n  \t\r\n  \t$threadexisting = $db->query_first('SELECT thread.* FROM ' . TABLE_PREFIX . 'thread AS thread WHERE firstpostid = ' . $postinfo['postid']);\r\n  \tif ($threadexisting)\r\n  \t{\r\n  \t\t$threadman =& datamanager_init('Thread', $vbulletin, ERRTYPE_STANDARD, 'threadpost');\r\n  \t\t$threadman->set_existing($threadexisting);\r\n  \t}\r\n\r\n  \t$postman =& datamanager_init('Post', $vbulletin, ERRTYPE_STANDARD, 'threadpost');\r\n\t \t$postman->set_existing($postinfo);\r\n  \tif ($postinfo['strikes'] >= $vbulletin->options['reporting_strikes'])\r\n  \t{\r\n\t  \tif ($threadexisting)\r\n\t  \t{\r\n\t  \t\t$threadman->set('visible', 0);\r\n\t  \t}\r\n\t  \telse\r\n\t  \t{\r\n\t  \t\t$postman->set('visible', 0);\r\n\t  \t}\r\n\t  \t$db->query_write('DELETE FROM ' . TABLE_PREFIX . 'report WHERE postid = ' . $postinfo['postid']);\r\n\t  }\r\n\t  else\r\n\t  {\r\n\t  \t$postman->set('strikes', $postinfo['strikes']);\r\n\t  \t\r\n\t  \t$db->query_write('\r\n\t\t\t\tINSERT INTO ' . TABLE_PREFIX . 'report\r\n\t\t\t\t(userid, username, postid, dateline)\r\n\t\t\t\tVALUES\r\n\t\t\t\t(' . $vbulletin->userinfo['userid'] . ', \"' . $db->escape_string($vbulletin->userinfo['username']) . '\", ' . $postinfo['postid'] . ', ' . TIMENOW . ')\r\n\t\t');\r\n\t  }\r\n\t  $postman->save();\r\n\t  if ($threadexisting)\r\n\t  {\r\n\t  \t$threadman->save();\r\n\t  }\r\n\t}\r\n\r\n\teval(print_standard_redirect('redirect_reportthanks'));\r\n}\r\n", 
  "forumdisplay_moderator": "global $usercache;\r\n\r\n$usercache[$moderator['userid']] = array(\r\n'userid'=>$moderator['userid'],\r\n'username'=>$moderator['username']\r\n);\r\n", 
  "error_fetch": "$GLOBALS['vbseo_errortype'] = $args[0];\r\n", 
  "showthread_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif (($forumperms & $vbulletin->bf_ugp_forumpermissions['canviewthreads']) AND ($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\n\r\n$vbpua_lasthook='showthread_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\neval('$template_hook[inlinemod_post_bottom] .= \" ' . fetch_template('showthread_changepostsowner_link') . '\";');\r\nif ($vbulletin->options['mnbon'])\r\n{\r\n\t$search_text = '<!-- / controls below postbits -->';\r\n\t$vbulletin->templatecache['SHOWTHREAD'] = str_replace($search_text,$search_text . fetch_template('navbar_mini'),$vbulletin->templatecache['SHOWTHREAD']);\r\n}\r\nif (VB_API === true)\r\n{\r\n\t$threadedmode = 0;\r\n}\r\n", 
  "picture_comment_post_start": "\r\n\t\t if (($vbulletin->options['apboupc_pictures_postcomments']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_pictures_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_pictures_postcomments'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_post_piccomments', intval($vbulletin->options['apboupc_pictures_postcomments']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "showthread_post_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('showthread_post_start');\r\nif ($forum['ada_forum'] AND $threadedmode == 0 AND $thread['attach'])\r\n{\r\n    $thread['hasattach'] = $thread['attach'];\r\n    unset($thread['attach']);\r\n}\r\n$post_cachable = (\r\n\t$vbulletin->options['cachemaxage'] > 0 AND\r\n\t(TIMENOW - ($vbulletin->options['cachemaxage'] * 60 * 60 * 24)) <= $thread['lastpost'] AND\r\n\t$vbulletin->session->vars['sessionurl'] == '' AND !VB_API\r\n);\r\n", 
  "paidsub_order_start": "\r\n\t\t\t\t$vbphrase += array( 'alertpay' => 'AlertPay' );\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$vbpcba_lasthook='paidsub_order_start';\r\n\t\t\t\t// include(DIR.'/includes/vbpcba_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "newreply_form_reviewbit": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tif (($foruminfo[linkview_nb] !='0') AND ($foruminfo[linkview_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t{\r\n\t\t\t\tif ($vbulletin->userinfo[userid])\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = $vbulletin->userinfo['posts'];\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = '0';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t$reviewmessage = preg_replace('!(\\\\[url(\\\\[img)?|\\\\[email|\\\\[img)(.*)((\\\\[\\/img\\\\])?\\\\[\\/url\\\\]|\\\\[\\/email\\\\]|\\\\[\\/img\\\\])|<a[^>]*(http|www|mailto)(.*)</a>|(http:\\/\\/)?www(.*)[\\s]\\b|<img[^>]*(src|border|title)(.*)(</img>|\\/>)|[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!siU', construct_phrase('<br /><span class=\"smallfont\"><i>'.$vbphrase['error_postcount_too_low_viewlinks'].'</i></span><br />', $foruminfo[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $reviewmessage.' ');\r\n\t\t\t}\r\n\t\t}\r\n", 
  "forumrules": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('forumrules');\r\nglobal $permissions;\r\nif ($permissions['allowhtmlpermissions'] & $vbulletin->bf_ugp_allowhtmlpermissions['canposthtml'])\r\n\t{\r\n\t\t$htmlcodeon = $vbphrase['on'];\r\n\t}\r\n", 
  "album_user_albumbit": "if (VB_API === true)\r\n{\r\n\tif ($album['pictureid'])\r\n\t{\r\n\t\t$album['pictureurl'] = create_full_url(fetch_picture_url($album, $album, true));\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$album['pictureurl'] = '';\r\n\t}\r\n}\r\n", 
  "search_results_postbit": "if ((defined('VB_API') AND VB_API === true) AND $vbulletin->options['avatarenabled'])\r\n{\r\n\trequire_once DIR . '/includes/functions_user.php';\r\n\t$avatar = fetch_avatar_url($post['userid']);\r\n}\r\n", 
  "online_location_preprocess": "blog_online_location_preprocess($userinfo, $filename, $values);\r\n", 
  "threadbit_process": "\r\n\t\t\t\t$vbppt_lasthook='threadbit_process';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\tif (($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo['posts']) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\t$thread['preview'] = '';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\teval('$cyb_apboupc_forums_viewlinks = in_array($foruminfo[forumid], array(' . $vbulletin->options['apboupc_viewlinks_excl_forums'] . '));');\t\t\r\n\t\t\tif (($foruminfo[linkview_nb] !='0') AND ($foruminfo[linkview_nb] > $vbulletin->userinfo[posts]) AND (!in_array($foruminfo['forumid'], array($cyb_apboupc_forums_viewlinks))) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t{\r\n\t\t\t\t$thread['preview'] = '';\r\n\t\t\t}\r\n\t\t}\r\nif (VB_API === true)\r\n{\r\n\t// get the thread starting date and time if applicable\r\n\tif ($thread['dateline'])\r\n\t{\r\n\t\t$thread['startdate'] = vbdate($vbulletin->options['dateformat'], $thread['dateline'], true);\r\n\t\t$thread['starttime'] = vbdate($vbulletin->options['timeformat'], $thread['dateline']);\r\n\t\t\r\n\t\tif (!$thread['lastpostdate'])\r\n\t\t{\r\n\t\t\t$thread['lastpostdate'] = $thread['startdate'];\r\n\t\t}\r\n\t\tif (!$thread['lastposttime'])\r\n\t\t{\r\n\t\t\t$thread['lastposttime'] = $thread['starttime'];\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$thread['startdate'] = '';\r\n\t\t$thread['starttime'] = '';\r\n\t}\r\n\t\r\n\t// thread not moved\r\n\tif ($thread['open'] != 10)\r\n\t{\r\n\t\tif (!$thread['visible'])\r\n\t\t{\r\n\t\t\t$thread['status']['moderated'] = 'moderated';\r\n\t\t}\r\n\t\tif ($thread['visible'] == 2)\r\n\t\t{\r\n\t\t\t$thread['status']['deleted'] = 'deleted';\r\n\t\t}\r\n\t\tif ($vbulletin->userinfo['userid'] AND $vbulletin->options['showdots'] AND $dotthreads[\"$thread[threadid]\"])\r\n\t\t{\r\n\t\t\t$thread['status']['dot'] = 'dot';\r\n\t\t}\r\n\t\tif ($vbulletin->options['usehotthreads'] AND (($thread['replycount'] >= $vbulletin->options['hotnumberposts'] AND $vbulletin->options['hotnumberposts'] > 0) OR ($thread['views'] >= $vbulletin->options['hotnumberviews'] AND $vbulletin->options['hotnumberviews'] > 0)))\r\n\t\t{\r\n\t\t\t$thread['status']['hot'] = 'hot';\r\n\t\t}\r\n\t\tif (!$thread['open'])\r\n\t\t{\r\n\t\t\t$thread['status']['lock'] = 'lock';\r\n\t\t}\r\n\t\tif ($thread['lastpost'] > $lastread)\r\n\t\t{\r\n\t\t\tif ($thread['lastpost'] > $threadview)\r\n\t\t\t{\r\n\t\t\t\t$thread['status']['new'] = 'new';\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t// thread moved?\r\n\telse\r\n\t{\r\n\t\t$thread['status'] = array('moved' => 'moved', 'new' => ($thread['lastpost'] > $lastread) ? 'new' : false);\r\n\t}\r\n}\r\nglobal $threadcache;\r\n\r\nif ($thread['open'] != 10 && !isset($threadcache[$thread['threadid']]) && \r\nisset($thread['forumid'])\r\n)\r\n{\r\n$threadcache[$thread['threadid']] = $thread;\r\n}\r\n", 
  "newpost_complete": "if ($post['message'])\r\n{\r\nrequire_once(DIR . '/includes/ame_bbcode.php');\r\n$value = ame_prep_text($post['message']);\r\n        if ($value == 1)\r\n        {\r\n                $vbulletin->db->query_write(\"UPDATE \" . TABLE_PREFIX . \"post SET pagetext ='\" . $vbulletin->db->escape_string($post['message']) . \"', ame_flag=1 WHERE postid=$post[postid]\");\r\n        }\r\n        else if ($value == 2)\r\n        {\r\n                $vbulletin->db->query_write(\"UPDATE \" . TABLE_PREFIX . \"post SET ame_flag=2 WHERE postid=$post[postid]\");\r\n        }\r\n}\r\nif(defined('VBSEO_ENABLED'))\r\n@vbseo_complete_sec('newpost_complete');\r\nglobal $rmq_helper;\r\n$lasthook='newpost_complete';\r\n$body = get_defined_vars();\r\n$rmq_helper->publish($body, '', 'vb', array('x-ha-policy' => array('S', 'all')), 'topic', 'vb.' . $lasthook);\r\n", 
  "ajax_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('ajax_start');\r\nif (vb_optimise::check_cache('notices'))\r\n{\r\n\tif ($_POST['do'] == 'dismissnotice')\r\n\t{\r\n\t\tvb_optimise::$cache->set('notices_' . $vbulletin->userinfo['userid'], '');\r\n\t}\r\n}\r\n", 
  "userdata_postsave": "if(defined('IN_CONTROL_PANEL') && $usergroups_changed && (basename($_SERVER['SCRIPT_NAME'])=='user.php'))\t\t\r\n      {\r\n         // Get new usergroups\t\t   \r\n         $newusergroupids = array();\r\n         if(isset($this->user['usergroupid']) AND $this->user['usergroupid'] != $this->existing['usergroupid'])\r\n         {\r\n            $newusergroupids[] = $this->user['usergroupid'];\r\n         }\r\n         if(isset($this->user['membergroupids']) AND $this->user['membergroupids'] != $this->existing['membergroupids'])\r\n         {\r\n            $newmembergroupids = array_diff(explode(',',$this->user['membergroupids']),explode(',',$this->existing['membergroupids']));\r\n            if(count($newmembergroupids)>0)\r\n            {\r\n               $newusergroupids = array_merge($newusergroupids,$newmembergroupids);\r\n            }\r\n         }        \r\n         if(count($newusergroupids) > 0)\r\n         {\r\n            if($this->registry->options['submes_ugp_limit'])\r\n            {\r\n               $submit_ugp_limit = explode(',',$this->registry->options['submes_ugp_limit']);\r\n               foreach($submit_ugp_limit as $submit_ugp_key => $submit_ugp_value)\r\n               {\r\n                  $submit_ugp_value = trim($submit_ugp_value);\r\n                  if($submit_ugp_value) $submit_ugp_limit[\"$submit_ugp_key\"] = intval($submit_ugp_value);\r\n               }\r\n               $newusergroupids  = array_intersect($newusergroupids,$submit_ugp_limit);\r\n            }       \r\n            if(count($newusergroupids) > 0)\r\n            {\r\n               // Get usergroup names\r\n               $usergroups = '';\r\n               foreach($newusergroupids as $newusergorupid)\r\n               {\r\n                  $usergroups .= $this->registry->usergroupcache[\"$newusergorupid\"]['title'].\"\\n\";\r\n               }\r\n               // E-mail\r\n               if(!empty($usergroups))\r\n               {\r\n                  // site info\r\n                  $bbtitle   = $this->registry->options['bbtitle'];\r\n                  $bburl     = $this->registry->options['bburl'];\r\n                  $sitetitle = $this->registry->options['homeurl'];\r\n                  $sitename  = $this->registry->options['hometitle'];\r\n                  $userinfo  = fetch_userinfo($userid);\r\n                  eval(fetch_email_phrases('submes_usergroup_user'));\r\n                  vbmail($userinfo['email'], $subject, $message, true, $this->registry->options['submes_email_from']);                  \r\n               }            \r\n            }\r\n         }\r\n      }\r\n", 
  "printthread_complete": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif (($forumperms & $vbulletin->bf_ugp_forumpermissions['canviewthreads']) AND ($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\n", 
  "newattachment_attachsum": "$attachdata = $db->query_first(\"\r\n\tSELECT SUM(blog_attachment.filesize) AS sum\r\n\tFROM \" . TABLE_PREFIX . \"blog_attachment AS blog_attachment\r\n\tLEFT JOIN \" . TABLE_PREFIX . \"blog AS blog ON (blog_attachment.blogid = blog.blogid)\r\n\tWHERE blog_attachment.userid = \" . ($postid ? $postinfo['userid'] : $vbulletin->userinfo['userid']) . \"\r\n\t\t\tAND\t(blog.state IN ('moderation', 'visible', 'draft')\r\n\t\t\tOR blog_attachment.blogid = 0)\r\n\");\r\n$attachsum += intval($attachdata['sum']);\r\n", 
  "private_messagelist_messagebit": "$pm['message'] = preg_replace('@(http:\\/\\/[\\w.?&=/;%-/#]+)@msi', '', $pm['message']);  \r\n$pm['pmpreview'] = strip_bbcode($pm['message'], true, true); \r\n$pm['pmpreview'] = htmlspecialchars_uni(fetch_trimmed_title($pm['pmpreview'], 200));\r\n", 
  "newreply_post_complete": "if (VB_API === true)\r\n{\r\n\t$show['threadid'] = $threadinfo['threadid'];\r\n\t$show['postid'] = $newpost['postid'];\r\n}\r\n", 
  "misc_showattachments_complete": "$totalattachments = $db->num_rows($attachs);\r\n", 
  "newreply_post_ajax": "$hook_query_fields .= \",blog_user.entries\";\r\n$hook_query_joins .= \"LEFT JOIN \" . TABLE_PREFIX . \"blog_user AS blog_user ON (blog_user.bloguserid = post.userid)\";\r\n", 
  "ppgal_browse_complete": "\r\n$vbpua_lasthook='ppgal_browse_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "blog_fpdata_postsave": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_fpdata_postsave');\r\n", 
  "faq_start": "\r\n$vbpua_lasthook='faq_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "newthread_form_start": "require_once(DIR . \"/includes/ame_bbcode.php\");\r\name_disable_option();\r\n\r\n", 
  "threaddata_start": "$this->validfields['isurlredirect'] = array(TYPE_STR, REQ_NO);\r\n", 
  "archive_complete": "\r\n$vbpua_lasthook='archive_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "inlinemod_action_switch": "\r\nif ($_POST['do']==\"changethreadsowner\" || $_POST['do']==\"dochangethreadsowner\" || $_POST['do']==\"changepostsowner\" || $_POST['do']==\"dochangepostsowner\")\r\n{\r\n\t$handled_do=true;\r\n}\r\n", 
  "threadmanage_action_switch": "if ($_REQUEST['do'] == 'bump')\r\n{\r\n$handled_do = true;\r\n\r\n\tif (!$threadinfo['threadid'])\r\n\t{\r\n\t\teval(standard_error(fetch_error('invalidid', $vbphrase['thread'], $vbulletin->options['contactuslink'])));\r\n\t}\r\n}\r\n", 
  "hook_name": "\r\n\t\t\t\t$vbppfo_lasthook='hook_name';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$vbppfo_lasthook='hook_name';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$vbppfo_lasthook='hook_name';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$vbppfo_lasthook='hook_name';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "editpost_delete_complete": "if(defined('VBSEO_ENABLED') && VBSEO_ENABLED && VBSEO_LIKE_POST)\r\n{\r\n\tvbseo_extra_inc('ui');\r\n\tvBSEO_UI::delete_likes($postinfo['postid'], 0, VBSEO_UI_THREAD);\r\n}\r\n", 
  "usercp_complete": "if ($vbulletin->options['personal_notepad_onoff'] AND (is_member_of($vbulletin->userinfo, explode(\",\", $vbulletin->options['personal_notepad_usergroups'])) OR $vbulletin->options['personal_notepad_usergroups'] == \"\"))\r\n{\r\n\tif ($_REQUEST['do'] == 'savenotepad')\r\n\t{\r\n\t\t$vbulletin->input->clean_gpc('p', 'notepad', TYPE_STR);\r\n\t\tif (strlen($vbulletin->GPC['notepad']) > $vbulletin->options['personal_notepad_maxlength'])\r\n\t\t{\r\n\t\t\tstandard_error(fetch_error('personal_notepad_input_too_long'));\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t$userdata =& datamanager_init('User', $vbulletin, ERRTYPE_STANDARD);\r\n\t\t\t$userdata->set_existing($vbulletin->userinfo);\r\n\t\t\t$userdata->setr('notepad', $vbulletin->GPC['notepad']);\r\n\t\t\t$userdata->save();\r\n\r\n\t\t\t$vbulletin->url = 'usercp.php' . $vbulletin->session->vars['sessionurl_q'];\r\n\t\t\teval(print_standard_redirect('redirect_notepad_saved', true, true));\r\n\t\t}\r\n\t}\r\n\t$notepadlength = strlen($vbulletin->userinfo['notepad']);\r\n\teval('$template_hook[\"usercp_main_pos' . $vbulletin->options['notepad_location'] . '\"] .= \"' . fetch_template('personal_notepad') . '\";');\r\n}\r\n$refcount = $db->query_first(\"SELECT COUNT(*) AS count FROM \" . TABLE_PREFIX . \"user WHERE referrerid = '\".$vbulletin->userinfo['userid'].\"'\"); \r\n$referrals = vb_number_format($refcount['count']);\r\n\r\neval('$usercprefs = \"' . fetch_template('usercp_referrals') . '\";');\r\n\r\n$vbulletin->templatecache['USERCP'] = str_replace('<!-- ############## SUBSCRIBED THREADS ##############  -->', '<!-- ############## SUBSCRIBED THREADS ##############  -->' . '$usercprefs', $vbulletin->templatecache['USERCP']);\r\n", 
  "showpost_start": "$hook_query_fields .= \",blog_user.entries\";\r\n$hook_query_joins .= \"LEFT JOIN \" . TABLE_PREFIX . \"blog_user AS blog_user ON (blog_user.bloguserid = post.userid)\";\r\n\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif (($forumperms & $vbulletin->bf_ugp_forumpermissions['canviewthreads']) AND ($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\n", 
  "profile_updatepassword_start": "if (function_exists('kh99_checkpassword'))\r\n{\r\n   if (($userdata->hash_password($userdata->verify_md5($vbulletin->GPC['currentpassword_md5']) ? $vbulletin->GPC['currentpassword_md5'] : $vbulletin->GPC['currentpassword'],          $vbulletin->userinfo['salt']) == $vbulletin->userinfo['password']))\r\n   {\r\n      unset($vbulletin->GPC['newpassword_md5'], $vbulletin->GPC['newpasswordconfirm_md5']);\r\n      if ($vbulletin->GPC['newpassword'] != '' && $vbulletin->GPC['newpasswordconfirm'] != '' && ($vbulletin->GPC['newpassword'] == $vbulletin->GPC['newpasswordconfirm']))\r\n      {\r\n         global $kh99_password_errors;\r\n         if (!kh99_checkpassword($vbulletin->GPC['newpassword'], $kh99_password_rules, $kh99_password_errors))\r\n            eval(standard_error(fetch_error('kh99_password_error', kh99_password_getpolicy($kh99_password_rules, $kh99_password_errors))));\r\n      }\r\n   }\r\n}\r\n$wauth_lasthook='profile_updatepassword_start';\r\ninclude(DIR.'/includes/wauth_hooks.php');\r\n", 
  "header_redirect": "// VB API modification\r\nif (VB_API === true)\r\n{\r\n\teval(print_standard_redirect('header_redirect', true, true));\r\n}\r\n", 
  "blog_entry_start": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('blog_entry_start');\r\n", 
  "bbcode_create": "if (!function_exists('handle_bbcode_ame'))\r\n{\r\n\r\n        function handle_bbcode_ame(&$parser, $text, $option = '')\r\n        {\r\n                require_once(DIR . '/includes/ame_bbcode.php');\r\n                return ame_process_bbcode($parser, $text, $option);\r\n        }\r\n}\r\n\r\n$this->tag_list['option']['ame'] = array(\r\n    'callback' => 'handle_external',\r\n    'strip_empty' => true,\r\n    'stop_parse' => false,\r\n    'disable_smilies' => true,\r\n    'disable_wordwrap' => true,\r\n    'strip_space_after' => 1,\r\n    'parse_option'      => true,\r\n    'external_callback' => 'handle_bbcode_ame'\r\n);\r\n\r\n$this->tag_list['no_option']['ame'] = array(\r\n    'callback' => 'handle_external',\r\n    'strip_empty' => true,\r\n    'stop_parse' => true,\r\n    'disable_smilies' => true,\r\n    'disable_wordwrap' => true,\r\n    'strip_space_after' => 1,\r\n    'external_callback' => 'handle_bbcode_ame'\r\n);\r\n", 
  "showpost_complete": "eval('$headinclude .= \"' . fetch_template('post_thanks_javascript') . '\";');\r\n", 
  "register_start": "if (defined('VB_API') AND VB_API === true)\r\n{\r\n\t$vbulletin->options['usecoppa'] = false;\r\n}\r\nif (function_exists('kh99_password_check'))\r\n{\r\n   unset($_POST['password_md5'], $_POST['passwordconfirm_md5']);\r\n}\r\n", 
  "threadbit_display": "if (!empty($thread['isurlredirect']))\r\n{\r\n$thread['statusicon'] = '_moved' . iif($thread['lastpost'] > $lastread, '_new');\r\n$show['rmanage']  = can_moderate($thread['forumid'], 'caneditthreads');\r\n$thread['redirectthreadid'] = $thread['threadid'];\r\n}\r\n\r\n$vbpua_lasthook='threadbit_display';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\nif (defined('VB_API') AND VB_API === true)\r\n{\r\n        require_once(DIR . '/includes/functions_user.php');\r\n\t// We need to fetch avatar url\r\n\tif (intval($thread['postuserid']) AND $vbulletin->options['avatarenabled'])\r\n\t{\r\n\t\t$avatar = fetch_avatar_url($thread['postuserid']);\r\n\t}\r\n\r\n\tif (!isset($avatar) )\r\n\t{\r\n\t\t$avatar = false;\r\n\t}\r\n}\r\n", 
  "showthread_similarthreadbit": "global $threadcache;\r\n\r\n$threadcache[$simthread['threadid']] = $simthread;\r\n", 
  "calendar_start": "\r\n$vbpua_lasthook='calendar_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "groupmessagedata_presave": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('groupmessagedata_presave');\r\n", 
  "global_start": "if($vbulletin->userinfo['userid'] <= 0)\r\n{\r\n$vbulletin->session->vars['sessionurl']  = '';\r\n$vbulletin->session->vars['sessionurl_q']  = '';\r\n}\r\n\r\n$vbp_helper_hook='global_start';\r\ninclude DIR.'/includes/vbp_helper.php';\r\n\t\t\t\r\n\t\t\t\r\nif(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('global_start');\r\nif (THIS_SCRIPT == \"group\")\r\n{\r\n$ap_grupmesajlari_limit = $vbulletin->options['ap_grupmesajlari_limit'];\r\n$ap_grupmesajlari_kes_limit = $vbulletin->options['ap_grupmesajlari_kes_limit'];\r\n$ap_grupmesajlari_nkes_limit = $vbulletin->options['ap_grupmesajlari_nkes_limit'];\r\n$ap_grupmesajlari_sorgu = $db->query_read(\"SELECT g.dateline AS sonmesajtarih, g.gmid, s.description, g.pagetext, g.postuserid, g.postusername, s.groupid, s.dateline, s.name, s.lastposter, s.lastposterid, g.state, s.visible, s.lastgmid, s.lastpost, user.username, user.usergroupid,\r\n     IF(displaygroupid=0, user.usergroupid, displaygroupid) AS displaygroupid \r\n     FROM \" . TABLE_PREFIX . \"groupmessage AS g\r\n     LEFT JOIN \" . TABLE_PREFIX . \"socialgroup AS s ON (g.gmid = s.lastgmid)\r\n     LEFT JOIN \" . TABLE_PREFIX . \"user AS user ON(user.username = g.postusername)\r\n     WHERE g.state = 'visible' AND s.visible > '0'\r\n        ORDER BY g.dateline DESC \r\n        LIMIT 0, $ap_grupmesajlari_limit\");\r\n\r\nwhile($ap_grupsonmesaj = $db->fetch_array($ap_grupmesajlari_sorgu))\r\n{\r\n\r\n\r\n$ap_grupsonmesaj['musername'] = fetch_musername($ap_grupsonmesaj); \r\n$ap_grupsonmesajmarkupuye = $ap_grupsonmesaj['musername'];\r\n\r\nif(strlen($ap_grupsonmesaj[pagetext]) > $ap_grupmesajlari_kes_limit) \r\n            { \r\n                $ap_grupsonmesaj[pagetext] = substr($ap_grupsonmesaj[pagetext], 0, $ap_grupmesajlari_kes_limit) . '...'; \r\n            } \r\n\r\n\r\nif(strlen($ap_grupsonmesaj[name]) > $ap_grupmesajlari_nkes_limit) \r\n            { \r\n                $ap_grupsonmesaj[name] = substr($ap_grupsonmesaj[name], 0, $ap_grupmesajlari_nkes_limit) . '...'; \r\n            } \r\n\r\n$grupdate = vbdate($vbulletin->options['dateformat'], $ap_grupsonmesaj['sonmesajtarih'], true);\r\n\r\n$i++; \r\nif($i%2 == 0) { $ap_g_class = 'alt2'; } else { $ap_g_class = 'alt1'; } \r\neval(\"\\$ap_grupmesajlarbit .= \\\"\".fetch_template('ap_groupmessage_bit').\"\\\";\");\r\n\r\n}\r\n}\r\nif (THIS_SCRIPT == \"group\")\r\n{\r\n\r\n$ap_pop_grup_limit = $vbulletin->options['ap_popgrup_limit'];\r\n$ap_pop_grup_kes_limit = $vbulletin->options['ap_pop_grup_kes_limit'];\r\n\r\n$ap_popgrup_sorgu = $db->query_read(\"SELECT s.creatoruserid, s.groupid, s.name, s.lastposter, s.lastposterid, s.members, s.visible, s.lastgmid, s.lastpost, user.userid, user.username, user.usergroupid,\r\n     IF(displaygroupid=0, user.usergroupid, displaygroupid) AS displaygroupid \r\n     FROM \" . TABLE_PREFIX . \"socialgroup AS s\r\n     LEFT JOIN \" . TABLE_PREFIX . \"user AS user ON(user.userid = s.creatoruserid)\r\n     WHERE s.visible > '0'\r\n     ORDER BY s.members DESC \r\n     LIMIT 0, $ap_pop_grup_limit\");\r\n\r\nwhile($ap_pop_grup = $db->fetch_array($ap_popgrup_sorgu))\r\n{\r\n$ap_pop_grup['musername'] = fetch_musername($ap_pop_grup); \r\n$ap_pop_grupmarkupuye = $ap_pop_grup['musername'];\r\n\r\nif(strlen($ap_pop_grup[name]) > $ap_pop_grup_kes_limit)  \r\n            {  \r\n                $ap_pop_grup[name] = substr($ap_pop_grup[name], 0, $ap_pop_grup_kes_limit) . '...';  \r\n            } \r\n\r\n$i++; \r\nif($i%2 == 0) { $ap_p_class = 'alt2'; } else { $ap_p_class = 'alt1'; } \r\neval(\"\\$ap_pop_grupbit .= \\\"\".fetch_template('ap_groupmessage_pop_bit').\"\\\";\");\r\n}\r\n}\r\nif (THIS_SCRIPT == \"group\")\r\n{\r\n\r\n$ap_ak_grup_limit = $vbulletin->options['ap_ak_grup_limit'];\r\n$ap_ak_grup_kes_limit = $vbulletin->options['ap_ak_grup_kes_limit'];\r\n\r\n$ap_ak_grup_sorgu = $db->query_read(\"SELECT s.groupid, s.name, s.lastposter, s.lastposterid, s.visible, s.lastgmid, s.lastpost, user.userid, user.username, user.usergroupid,\r\n     IF(displaygroupid=0, user.usergroupid, displaygroupid) AS displaygroupid \r\n     FROM \" . TABLE_PREFIX . \"socialgroup AS s\r\n     LEFT JOIN \" . TABLE_PREFIX . \"user AS user ON(user.userid = s.lastposterid)\r\n     WHERE s.visible > '0'\r\n     ORDER BY s.visible DESC \r\n     LIMIT 0, $ap_ak_grup_limit\");\r\n\r\nwhile($ap_ak_grup = $db->fetch_array($ap_ak_grup_sorgu))\r\n{\r\n$ap_ak_grup['musername'] = fetch_musername($ap_ak_grup); \r\n$ap_ak_grupmarkupuye = $ap_ak_grup['musername'];\r\n\r\n\r\nif(strlen($ap_ak_grup[name]) > $ap_ak_grup_kes_limit)  \r\n            {  \r\n                $ap_ak_grup[name] = substr($ap_ak_grup[name], 0, $ap_ak_grup_kes_limit) . '...';  \r\n            } \r\n\r\n$i++; \r\nif($i%2 == 0) { $ap_a_class = 'alt2'; } else { $ap_a_class = 'alt1'; } \r\neval(\"\\$ap_ak_grupbit .= \\\"\".fetch_template('ap_groupmessage_ak_bit').\"\\\";\");\r\n}\r\n}\r\n\r\nif (THIS_SCRIPT === newthread) {\r\n\tif ($vbulletin->options['autotag_enabled_ajax'] AND $vbulletin->options['autotag_enabled_all'])\r\n\t{\r\n\t\t$vbulletin->templatecache['headinclude'].=$vbulletin->templatecache['autotag_ajax'];\r\n\t}\r\n}\r\n\r\n\r\n\r\nif ($vbulletin->options['modtools_onoff'])\r\n{\t\r\n\t$basic=explode(',', $vbulletin->options['modtools_basic_groups']);\r\n\t$advance=explode(',', $vbulletin->options['modtools_adv_groups']);\r\n\t\r\n\t\r\n\tif ($vbulletin->options['modtools_ban'])\r\n\t$show['modtools_ban']= true;\r\n\tif ($vbulletin->options['modtools_editsig'])\r\n\t$show['modtools_editsig']= true;\r\n\tif ($vbulletin->options['modtools_edit'])\r\n\t$show['modtools_edit']= true;\r\n\tif ($vbulletin->options['modtools_edit2'])\r\n\t$show['modtools_edit2']= true;\r\n\tif ($vbulletin->options['modtools_pass'])\r\n\t$show['modtools_pass']= true;\r\n\tif ($vbulletin->options['modtools_deleteall'])\r\n\t$show['modtools_deleteall']= true;\r\n\r\n\tif (is_member_of($vbulletin->userinfo, $basic))\r\n\t{\r\n\t\t$show['modtools_basic'] = true;\r\n\t}\r\n\tif (is_member_of($vbulletin->userinfo, $advance))\r\n\t{\r\n\t\t$show['modtools_adv'] = true;\r\n\t}\t\r\n\tif (THIS_SCRIPT == 'member')\r\n\t{\t\t\t\t\t\t\t\t\r\n\t\t$ara = '$navbar';\r\n\t\t$vbulletin->templatecache['MEMBERINFO'] = str_replace($ara,$ara.fetch_template('memberinfo_ModTools'),$vbulletin->templatecache['MEMBERINFO']);\r\n\t}\r\n\tif (THIS_SCRIPT == 'showthread')\r\n\t\t{\r\n\t\t\t$ara = '$template_hook[postbit_user_popup]';\r\n\t\t\t$vbulletin->templatecache['postbit'] = str_replace($ara,$ara.fetch_template('postbit_modtools'),$vbulletin->templatecache['postbit']);\r\n\t\t\t$vbulletin->templatecache['postbit_legacy'] = str_replace($ara,$ara.fetch_template('postbit_modtools'),$vbulletin->templatecache['postbit_legacy']);\r\n\t\t\t$vbulletin->templatecache['postbit'] = str_replace(\"modlink\",$vbulletin->config['Misc']['modcpdir'],$vbulletin->templatecache['postbit']);\r\n\t\t\t$vbulletin->templatecache['postbit_legacy'] = str_replace(\"modlink\",$vbulletin->config['Misc']['modcpdir'],$vbulletin->templatecache['postbit_legacy']);\r\n\r\n\t\t}\t\r\n}\r\n\r\n\r\n// #############################################################################\r\n// Replace session class with vB_Session_API\r\nif (!VB_API)\r\n{\r\n\t// build the session and setup the environment\r\n\t$vbulletin->session =& new vB_Session_API($vbulletin, $sessionhash, $vbulletin->GPC[COOKIE_PREFIX . 'userid'], $vbulletin->GPC[COOKIE_PREFIX . 'password'], $styleid, $languageid);\r\n\t$vbulletin->session->do_lastvisit_update($vbulletin->GPC[COOKIE_PREFIX . 'lastvisit'], $vbulletin->GPC[COOKIE_PREFIX . 'lastactivity']);\r\n}\r\nelse\r\n{\r\n\t// Need to unset $vbphrase to get new ones\r\n\tunset($vbphrase);\r\n\t\r\n\t// build the session and setup the environment\r\n\t$vbulletin->session =& new vB_Session_API($vbulletin);\r\n\t$vbulletin->userinfo =& $vbulletin->session->fetch_userinfo();\r\n\t\r\n\t// #############################################################################\r\n\t// Get date / time info\r\n\t// override date/time settings if specified\r\n\tfetch_options_overrides($vbulletin->userinfo);\r\n\tfetch_time_data();\r\n\r\n\t// global $vbulletin->userinfo setup -- this has to happen after fetch_options_overrides\r\n\tif ($vbulletin->userinfo['lastvisit'])\r\n\t{\r\n\t\t$vbulletin->userinfo['lastvisitdate'] = vbdate($vbulletin->options['dateformat'] . ' ' . $vbulletin->options['timeformat'], $vbulletin->userinfo['lastvisit']);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$vbulletin->userinfo['lastvisitdate'] = -1;\r\n\t}\r\n\r\n\t// get some useful info\r\n\t$templateversion =& $vbulletin->options['templateversion'];\r\n\r\n\t// #############################################################################\r\n\t// initialize $vbphrase and set language constants\r\n\t$vbphrase = init_language();\r\n\r\n\t// set a default username\r\n\tif ($vbulletin->userinfo['username'] == '')\r\n\t{\r\n\t\t$vbulletin->userinfo['username'] = $vbphrase['unregistered'];\r\n\t}\r\n\r\n\t// #############################################################################\r\n\t// CACHE PERMISSIONS AND GRAB $permissions\r\n\t// get the combined permissions for the current user\r\n\t// this also creates the $fpermscache containing the user's forum permissions\r\n\r\n\t$permissions = cache_permissions($vbulletin->userinfo);\r\n\t\r\n\t// vboptions overwrite for API\r\n\t$vbulletin->options['dateformat'] = 'm-d-Y';\r\n\t$vbulletin->options['timeformat'] = 'h:i A';\r\n\t$vbulletin->options['registereddateformat'] = 'm-d-Y';\r\n\t\r\n\t// Disable updateprofilefields error\r\n\t$vbulletin->session->vars['profileupdate'] = false;\r\n}\r\n\r\n// Hide sessionid in url if we are a search engine or if we have a cookie\r\n$vbulletin->session->set_session_visibility(($show['search_engine'] OR $vbulletin->superglobal_size['_COOKIE'] > 0) AND !VB_API);\r\n", 
  "forumdisplay_query_threadid": "\r\n\t\t\t\t$vbppt_lasthook='forumdisplay_query_threadid';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n", 
  "login_process": "// Process API login\r\nif (VB_API === true)\r\n{\r\n\t$newsession =& new vB_Session_API($vbulletin, '', $vbulletin->userinfo['userid'], '', $vbulletin->session->vars['styleid'], $vbulletin->session->vars['languageid']);\r\n\r\n\t$newsession->set('userid', $vbulletin->userinfo['userid']);\r\n\t$newsession->set('loggedin', 1);\r\n\tif ($logintype == 'cplogin')\r\n\t{\r\n\t\t$newsession->set('bypass', 1);\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$newsession->set('bypass', 0);\r\n\t}\r\n\t$newsession->set_session_visibility(true);\r\n\t$newsession->fetch_userinfo();\r\n\t$vbulletin->session =& $newsession;\r\n\t\r\n\t// API cookieuser\r\n\tif ($vbulletin->apiclient['apiclientid'] AND $cookieuser)\r\n\t{\r\n\t\t$vbulletin->db->query_write(\"UPDATE \" . TABLE_PREFIX . \"apiclient SET userid = \" . intval($vbulletin->userinfo['userid']) . \" WHERE apiclientid = \" . intval($vbulletin->apiclient['apiclientid']));\r\n\t}\r\n}\r\n", 
  "newpost_preview": "if(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\n{ \r\n\t$previewmessage = vbseo_prepare_int_replace($previewmessage);\r\n}\r\n", 
  "bbcode_fetch_tags": "if (($vbulletin->options['allowedbbcodes'] & ALLOW_BBCODE_URL) OR $force_all)\r\n{\r\n\tif (defined('VB_API') AND VB_API === true)\r\n\t{\r\n\t\t$tag_list['no_option']['thread']['html'] = '<a href=\"vb:showthread/t=%1$s\">' . $vbulletin->options['bburl'] . '/showthread.php?t=%1$s</a>';\r\n\t\t$tag_list['option']['thread']['html'] = '<a href=\"vb:showthread/t=%2$s\">%1$s</a>';\r\n\t\t$tag_list['no_option']['post']['html'] = '<a href=\"vb:showthread/p=%1$s\">' . $vbulletin->options['bburl'] . '/showthread.php?p=%1$s</a>';\r\n\t\t$tag_list['option']['post']['html'] = '<a href=\"vb:showthread/p=%2$s\">%1$s</a>';\r\n\t}\r\n}\r\n", 
  "postbit_display_start": "global $candecimate;\r\nglobal $vbulletin;\r\nif($vbulletin->options['sd_enabled'])\r\n{\r\n\t$candecimate = false;\r\n\t$modgroups = explode(\",\", $vbulletin->options['modgroupid']);\r\n\t$supergroups = explode(\",\", $vbulletin->options['supermodid']);\r\n\t$admingroups = explode(\",\", $vbulletin->options['adminid']);\r\n\t$decimators = array_merge($admingroups,$modgroups,$supergroups);\r\n\tif(!in_array($post['usergroupid'], $decimators))\r\n\t{\r\n\t      if(in_array($vbulletin->userinfo['usergroupid'], $decimators))\r\n\t      {\r\n\t            if($vbulletin->options['sd_postmax'] > 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tif($post['posts'] < $vbulletin->options['sd_postmax'])\r\n\t\t\t\t\t{\r\n\t             \t\t$candecimate = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t$candecimate = true;\r\n\t\t\t\t}\r\n\t      }\r\n\t}\r\n}\r\nelse\r\n{\r\n\t$candecimate = false;\r\n}\r\nif($candecimate)\r\n{\r\n\t$template_hook['postbit_controls'] .= \"<a href=\\\"#\\\" onclick=\\\"window.open('http://www.warriorforum.com/decimator.php?userid=$post[userid]&amp;threadid=$post[threadid]&amp;postid=$post[postid]','spam_decimator','statusbar=yes,menubar=yes,toolbar=yes,scrollbars=yes,resizable=yes,width=800,height=600'); return false;\\\"><img src=\\\"images/misc/spambutton.gif\\\" alt=\\\"Spam Decimator\\\" border=\\\"0\\\"></a>\";\r\n}\r\nrequire_once(DIR . '/includes/functions_post_thanks.php');\r\n\r\nif (!(defined('LOCATION_BYPASS')) && !(post_thanks_off($this->thread['forumid'], $this->post, $this->thread['firstpostid'], THIS_SCRIPT)))\r\n{\r\n\tglobal $ids;\r\n\r\n\t$thanks = fetch_thanks($this->post['postid'], $ids);\r\n\r\n\tif (thanked_already($this->post) && $this->registry->options[post_thanks_delete_own])\r\n\t{\r\n\t\t$this->post['show_thanks_remove_option'] = true;\r\n\t}\r\n\r\n\tif ($this->post['post_thanks_amount'] > 0 && $this->thread['isdeleted'] == 0)\r\n\t{\r\n\t\t$this->post['post_thanks_bit'] = fetch_thanks_bit($this->thread['forumid'], $thanks);\r\n\t\t$this->post['post_thanks_user'] = $post_thanks_user;\r\n\t\t$this->post['post_thanks_amount_formatted'] = vb_number_format($this->post['post_thanks_amount']);\r\n\r\n\t\t$post_thanks_box = fetch_post_thanks_template($this->post);\r\n\t}\r\n\r\n\teval('$template_hook[postbit_end] .= \" ' . fetch_template('post_thanks_box') . '\";');\r\n}\r\nif (VB_API === true)\r\n{\r\n\tif (!$post['pagetext'])\r\n\t{\r\n\t\t$post['pagetext'] = $post['message']; // PM doesn't have $post['pagetext']\r\n\t}\r\n\t$post['joindateline'] = $post['joindate'];\r\n}\r\nglobal $vbulletin;\r\n\r\nif ($vbulletin->options['bop5hic_en'])\r\n{\r\n   $post['bop5hic'] = $post['pagetext']; \r\n}\r\n", 
  "inlinemod_start": "\r\n\t\t\t\t$vbppt_lasthook='inlinemod_start';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\r\nif ($_POST['do']==\"changethreadsowner\" || $_POST['do']==\"dochangethreadsowner\" || $_POST['do']==\"changepostsowner\" || $_POST['do']==\"dochangepostsowner\")\r\n{\r\n\t$has_permission = false;\r\n\tif ($vbulletin->options['changethreadsowner_gp']) {\r\n\t\tforeach(split(\",\", $vbulletin->options['changethreadsowner_gp']) as $gp) {\r\n\t\t\tif (is_member_of($vbulletin->userinfo, $gp)) {\t\r\n\t\t\t\t$has_permission = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t} else {\r\n\t\t$has_permission = can_moderate($threadinfo['forumid']);\r\n\t}\r\n\r\n\tif (!$has_permission) {\r\n\t\tprint_no_permission();\r\n\t} \r\n\r\n\tif (count($vbulletin->GPC['tlist']) > $threadlimit)\t{\r\n\t\teval(standard_error(fetch_error('you_are_limited_to_working_with_x_threads', $threadlimit)));\r\n\t}\r\n\r\n\tif (count($vbulletin->GPC['plist']) > $postlimit) {\r\n\t\teval(standard_error(fetch_error('you_are_limited_to_working_with_x_posts', $postlimit)));\r\n\t}\r\n\r\n}\r\n\r\n\r\n// ##########################\r\n// ### Change Posts Owner ###\r\n// ##########################\r\nif ($_POST['do']==\"dochangepostsowner\" || $_POST['do']==\"dochangethreadsowner\" )\r\n{\r\n\t\r\n\t\r\n\r\n\t$changedate = false;\r\n\t$arrnewdate = $vbulletin->input->clean_gpc('p', 'date', TYPE_ARRAY);\r\n\t$newdate = mktime($arrnewdate['hour'], $arrnewdate['minute'], $arrnewdate['second'], $arrnewdate['month'], $arrnewdate['day'], $arrnewdate['year']);\r\n\tif ($arrnewdate['change'] == 'on')\r\n\t{\r\n\t\t$changedate = true;\r\n\t}\r\n\t\t\r\n\t$newpostowner = $vbulletin->input->clean_gpc('p', 'newthreadowner', TYPE_NOHTML);\r\n\t$setunregistered = $vbulletin->input->clean_gpc('p', 'setunregistered', TYPE_NOHTML);\r\n\t$newpostowner = $db->escape_string($newpostowner);\r\n\t\r\n\tif ($setunregistered == 'on')\r\n\t{\r\n\t\t$changeuser = true;\r\n\t\t$userinfo['userid'] = 0;\r\n\t\tif (strlen($newpostowner) > 0)\r\n\t\t{\r\n\t\t\t$userinfo['username'] = $newpostowner;\r\n\t\t} else {\r\n\t\t\t$userinfo['username'] = $vbphrase['unregistered'];\r\n\t\t}\r\n\t\t\r\n\t\t$userinfo['ipaddress'] = \"\";\r\n\t} else {\r\n\t\t$changeuser = false;\r\n\r\n\t\tif (is_numeric($newpostowner))\r\n\t\t{\r\n\t\t\t$querywhat = \"userid\";\r\n\t\t} else {\r\n\t\t\t$querywhat = \"username\";\r\n\t\t}\r\n\t\t\r\n\t\t$getuseridq = $vbulletin->db->query_read(\"SELECT ipaddress, userid, username FROM \" . TABLE_PREFIX . \"user WHERE \".$querywhat.\"='\".$newpostowner.\"'\");\r\n\t\tif ($db->num_rows($getuseridq) > 0)\r\n\t\t{\r\n\t\t\t$userinfo = $vbulletin->db->fetch_array($getuseridq);\r\n\t\t\t$changeuser = true;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tif (!$changeuser AND !$changedate)\r\n\t{\r\n\t\teval(standard_error(fetch_error('invalidid', $vbphrase['user'], $vbulletin->options['contactuslink'])));\r\n\t}\r\n\t\r\n\t\r\n}\r\n\r\nif ($_POST['do']==\"changepostsowner\")\r\n{\r\n\r\n\t\t\r\n\tif (empty($vbulletin->GPC['plist']))\r\n\t{\r\n\t\teval(standard_error(fetch_error('no_applicable_posts_selected')));\r\n\t}\r\n\r\n\t$postids = implode(',', $vbulletin->GPC['plist']);\r\n\t$navbits[''] = $vbphrase['changethreadsowner_title'];\r\n\t$template = 'forumdisplay_changethreadsowner';\t\r\n\t\r\n\t$postq = $db->query_read(\"SELECT\r\n\t\tp.dateline\r\n\t\tFROM \" . TABLE_PREFIX . \"post as p\r\n\t\tWHERE p.postid=\".$vbulletin->GPC['plist'][0]);\r\n\t\r\n\tif ($db->num_rows($postq) > 0)\r\n\t{\r\n\t\t$datepost = $db->fetch_array($postq);\r\n\t\t$mydate['day'] = date(\"d\", $datepost['dateline']);\r\n\t\t$mydate['month'] = date(\"m\", $datepost['dateline']);\r\n\t\t$mydate['year'] = date(\"Y\", $datepost['dateline']);\r\n\t\t\r\n\t\t$mydate['hour'] = date(\"H\", $datepost['dateline']);\r\n\t\t$mydate['minute'] = date(\"i\", $datepost['dateline']);\r\n\t\t$mydate['second'] = date(\"s\", $datepost['dateline']);\r\n\t}\r\n\r\n}\r\n\r\n\r\nif ($_POST['do']==\"dochangepostsowner\")\r\n{\r\n\t$vbulletin->input->clean_array_gpc('p', array('postids' => TYPE_STR));\r\n\t$postids = explode(',', $vbulletin->GPC['postids']);\r\n\tforeach ($postids AS $index => $postid)\r\n\t{\r\n\t\t$post['postid'] = $postid;\r\n\t\t\r\n\t\t$postq = $db->query_read(\"SELECT\r\n\t\t\tp.userid,\r\n\t\t\tp.username,\r\n\t\t\tp.threadid,\r\n\t\t\tt.forumid\r\n\t\t\tFROM \" . TABLE_PREFIX . \"post as p\r\n\t\t\tINNER JOIN \" . TABLE_PREFIX . \"thread as t ON p.threadid=t.threadid\r\n\t\t\tWHERE p.postid=\".$post['postid']);\r\n\t\t\r\n\t\tif ($db->num_rows($postq)>0)\r\n\t\t{\r\n\t\t\t$oldpost = $db->fetch_array($postq);\r\n\t\t}\r\n\r\n\t\t$postdm =& datamanager_init('Post', $vbulletin, ERRTYPE_STANDARD, 'threadpost'); \r\n\t\t$postdm->set_existing($post);\t\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\tif ($vbulletin->options['changethreadsowner_ip'])\r\n\t\t\t{\r\n\t\t\t\t$postdm->set('ipaddress', $userinfo['ipaddress'], true, false);\r\n\t\t\t}\r\n\t\t\t$postdm->set('userid', $userinfo['userid'], true, false);\r\n\t\t\t$postdm->set('username', $userinfo['username'], true, false);\r\n\t\t}\r\n\t\tif ($changedate) \r\n\t\t{\r\n\t\t\t$postdm->set('dateline', $newdate, true, false);\r\n\t\t}\r\n\t\t\r\n\t\t$postdm->save();\r\n\t\tunset($postdm);\r\n\t\t\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\t// Update Attachments\r\n\t\t\t$updateattq = $db->query_write(\"UPDATE \" . TABLE_PREFIX . \"attachment SET userid=\".$userinfo['userid'].\" WHERE postid=\".$post['postid']);\r\n\t\t}\r\n\t\t\r\n\t\t$threadlist[\"$oldpost[threadid]\"] = true;\r\n\t\t$forumlist[\"$oldpost[forumid]\"] = true; \r\n\t\t\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\t$userdm =& datamanager_init('User', $vbulletin, ERRTYPE_STANDARD);\r\n\t\t\t$userdm->set_existing($oldpost);\r\n\t\t\t$userdm->set('posts', 'IF(posts > 1, posts - 1, 0)', false);\r\n\t\t\t$userdm->save();\r\n\t\t\tunset($userdm);\r\n\t\t\r\n\t\t\t$userdm =& datamanager_init('User', $vbulletin, ERRTYPE_STANDARD);\r\n\t\t\t$userdm->set_existing($userinfo);\r\n\t\t\t$userdm->set('posts', 'posts + 1', false);\r\n\t\t\t$userdm->save();\r\n\t\t\tunset($userdm);\r\n\t\t}\r\n\r\n\t\t$modlog[] = array(\r\n\t\t\t'userid'   =>& $vbulletin->userinfo['userid'],\r\n\t\t\t'forumid'  =>& $oldpost['forumid'],\r\n\t\t\t'threadid' =>  $oldpost['threadid'],\r\n\t\t\t'postid'   => $post['postid'],\r\n\t\t);\r\n\t\t\r\n\t\tlog_moderator_action($modlog, 'changethreadsowner_modaction', array($oldpost['username'], $userinfo['username']));\r\n\t} \r\n\t\t\r\n\tforeach (array_keys($threadlist) AS $threadid)\r\n\t{\r\n\t\tbuild_thread_counters($threadid);\r\n\t}\r\n\t\r\n\tforeach (array_keys($forumlist) AS $forumid)\r\n\t{\r\n\t\tbuild_forum_counters($forumid);\r\n\t}\r\n\r\n\r\n\r\n\r\n\t// empty cookie\r\n\tsetcookie('vbulletin_inlinepost', '', TIMENOW - 3600, '/');\r\n\t\t\r\n\t//Finished, go to last thread\r\n\t$vbulletin->url = 'showthread.php?' . $vbulletin->session->vars['sessionurl'] . \"t=\".$oldpost['threadid'];\r\n\teval(print_standard_redirect('redirect_changethreadsowner_success', true)); \r\n\t\t\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n// ############################\r\n// ### Change Thread/Post owner ###\r\n// ############################\r\nif ($_POST['do']==\"changethreadsowner\") {\r\n\tif (empty($vbulletin->GPC['tlist'])) {\r\n\t\teval(standard_error(fetch_error('you_did_not_select_any_valid_threads')));\r\n\t}\r\n\r\n\t$threadids = implode(',', $vbulletin->GPC['tlist']);\r\n\t$navbits[''] = $vbphrase['changethreadsowner_title'];\r\n\t$template = 'forumdisplay_changethreadsowner';\t\r\n\t\r\n\t\r\n\t$postq = $db->query_read(\"SELECT\r\n\t\tt.dateline\r\n\t\tFROM \" . TABLE_PREFIX . \"thread as t\r\n\t\tWHERE t.threadid=\".$vbulletin->GPC['tlist'][0]);\r\n\t\r\n\tif ($db->num_rows($postq) > 0)\r\n\t{\r\n\t\t$datepost = $db->fetch_array($postq);\r\n\t\t$mydate['day'] = date(\"d\", $datepost['dateline']);\r\n\t\t$mydate['month'] = date(\"m\", $datepost['dateline']);\r\n\t\t$mydate['year'] = date(\"Y\", $datepost['dateline']);\r\n\t\t\r\n\t\t$mydate['hour'] = date(\"h\", $datepost['dateline']);\r\n\t\t$mydate['minute'] = date(\"i\", $datepost['dateline']);\r\n\t\t$mydate['second'] = date(\"s\", $datepost['dateline']);\r\n\t}\r\n\t\r\n\t\r\n}\r\n\r\n\r\nif ($_POST['do']==\"dochangethreadsowner\")\r\n{\r\n\t//Get Threads\r\n\t\r\n\t$vbulletin->input->clean_array_gpc('p', array('threadids' => TYPE_STR));\r\n\t$threadids = explode(',', $vbulletin->GPC['threadids']);\r\n\tforeach ($threadids AS $index => $threadid)\r\n\t{\r\n\r\n\t\t//Get Thread\r\n\t\t$threaddm =& datamanager_init('Thread', $vbulletin, ERRTYPE_STANDARD, 'threadpost');\r\n\t\t$threaddm->set_existing(fetch_threadinfo($threadid));\r\n\t\t$firstpostid=$threaddm->fetch_field('firstpostid');\r\n\t\t$olduser['userid']=$threaddm->fetch_field('postuserid');\r\n\t\t$olduser['username']=$threaddm->fetch_field('postusername');\r\n\t\t$forumid=$threaddm->fetch_field('forumid');\r\n\t\t\r\n\t\t$forumlist[\"$forumid\"] = true; \r\n\t\t\r\n\t\t//Update Thread\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\t$threaddm->set('postuserid', $userinfo['userid'], true, false); \r\n\t\t\t$threaddm->set('postusername', $userinfo['username'], true, false); \r\n\t\t}\r\n\t\t\r\n\t\tif ($changedate) \r\n\t\t{\r\n\t\t\t$threaddm->set('dateline', $newdate, true, false);\r\n\t\t}\r\n\r\n\t\t$threaddm->save();\r\n\r\n\t\t//Update post\r\n\t\t$postdm =& datamanager_init('Post', $vbulletin, ERRTYPE_STANDARD, 'threadpost'); \r\n\t\t$postdm->set_existing(fetch_postinfo($firstpostid));\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\tif ($vbulletin->options['changethreadsowner_ip'])\r\n\t\t\t{\r\n\t\t\t\t$postdm->set('ipaddress', $userinfo['ipaddress'], true, false);\r\n\t\t\t}\r\n\t\t\t$postdm->set('userid', $userinfo['userid'], true, false);\r\n\t\t\t$postdm->set('username', $userinfo['username'], true, false);\r\n\t\t}\r\n\t\t\r\n\t\tif ($changedate) \r\n\t\t{\r\n\t\t\t$postdm->set('dateline', $newdate, true, false);\r\n\t\t}\r\n\t\t\r\n\t\t$postdm->save();\r\n\t\t\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\t//Update user's postcount\r\n\t\t\t$userdm =& datamanager_init('User', $vbulletin, ERRTYPE_STANDARD);\r\n\t\t\t$userdm->set_existing($olduser);\r\n\t\t\t$userdm->set('posts', 'IF(posts > 1, posts - 1, 0)', false);\r\n\t\t\t$userdm->save();\r\n\t\t\tunset($userdm);\r\n\t\t\r\n\t\t\t$userdm =& datamanager_init('User', $vbulletin, ERRTYPE_STANDARD);\r\n\t\t\t$userdm->set_existing($userinfo);\r\n\t\t\t$userdm->set('posts', 'posts + 1', false);\r\n\t\t\t$userdm->save();\r\n\t\t\tunset($userdm);\r\n\t\t}\r\n\t\t\r\n\t\tif ($changeuser) \r\n\t\t{\r\n\t\t\t// Update Attachments\r\n\t\t\t$updateattq = $db->query_write(\"UPDATE \" . TABLE_PREFIX . \"attachment SET userid=\".$userinfo['userid'].\" WHERE postid=\".$firstpostid);\r\n\t\t}\r\n\t\t\r\n\t\tunset($threaddm);\r\n\t\tunset($postdm);\r\n\t\t\r\n\t\t$modlog[] = array(\r\n\t\t\t'userid'   =>& $vbulletin->userinfo['userid'],\r\n\t\t\t'forumid'  =>& $forumid,\r\n\t\t\t'threadid' => $threadid,\r\n\t\t);\r\n\t\t\r\n\t\tbuild_thread_counters($threadid);\r\n\t\t\r\n\t\tlog_moderator_action($modlog, 'changethreadsowner_modaction', array($olduser['username'], $userinfo['username']));\r\n\t}\r\n\t\r\n\r\n\tforeach (array_keys($forumlist) AS $forumid) {\r\n\t\tbuild_forum_counters($forumid);\r\n\t}\r\n\r\n\r\n\t// empty cookie\r\n\tsetcookie('vbulletin_inlinethread', '', TIMENOW - 3600, '/');\r\n\t\t\r\n\t//Finished\r\n\t$vbulletin->url = 'forumdisplay.php?' . $vbulletin->session->vars['sessionurl'] . \"f=\".$forumid;\r\n\teval(print_standard_redirect('redirect_changethreadsowner_success', true)); \r\n\r\n}\r\n", 
  "editpost_start": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_forum'])\r\n\t\t{\r\n\t\t\t$forumperms = fetch_permissions($foruminfo['forumid']);\r\n\t\t\tif (($forumperms & $vbulletin->bf_ugp_forumpermissions['canviewthreads']) AND ($foruminfo[accesst_nb] !='0') AND ($foruminfo[accesst_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_forum_excludedgroups']))))\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_thread', intval($foruminfo['accesst_nb']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t}\r\n", 
  "forumhome_start": "\r\n$vbpua_lasthook='forumhome_start';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "group_docreate": "\r\n\t\t if (($vbulletin->options['apboupc_groups_creategroups']>0) AND !is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_groups_excl_groups'])))\r\n\t\t {\r\n\t\t\tif ($vbulletin->userinfo[posts] < $vbulletin->options['apboupc_groups_creategroups'])\r\n\t\t\t{\r\n\t\t\t\teval(standard_error(fetch_error('error_postcount_too_low_create_groups', intval($vbulletin->options['apboupc_groups_creategroups']), intval($vbulletin->userinfo['posts']))));\r\n\t\t\t}\r\n\t\t }\r\n", 
  "postdata_delete": "if ($physicaldel)\r\n{\r\n\trequire_once(DIR . '/includes/functions_post_thanks.php');\r\n\tdelete_all_thanks($this->existing, false);\r\n}\r\n", 
  "register_addmember_process": "\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_questions'])\r\n\t\t{\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$vbulletin->input->clean_array_gpc('p', array(\r\n\t\t\t\t'cybareg_id' => TYPE_UINT,\r\n\t\t\t\t'cybareg_answer' => TYPE_STR)\r\n\t\t\t);\r\n\t\t\tif ($vbulletin->GPC['cybareg_id']>0)\r\n\t\t\t{\r\n\t\t\t\t$cybareg_tqinfo = $vbulletin->db->query_first(\"\r\n\t\t\t\t\tSELECT id, question, answer\r\n\t\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg AS cyb_advreg\r\n\t\t\t\t\tWHERE id = '\".$db->escape_string($vbulletin->GPC['cybareg_id']).\"'\r\n\t\t\t\t\");\r\n\t\t\t\tif (strtoupper($vbulletin->GPC['cybareg_answer']) != strtoupper($cybareg_tqinfo['answer']))\r\n\t\t\t\t{\r\n\t\t\t\t\t$userdata->error('cybareg_wrong_answer', $vbphrase['cybareg_random_question']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t$db->show_errors();\r\n\t\t}\r\n\t\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_invite'])\r\n\t\t{\r\n\t\t\t$cybareg_invonly = \"\";\r\n\t\t\tif ($vbulletin->options['cybareg_enable_invite_only'])\r\n\t\t\t{\r\n\t\t\t\t$cybareg_aregcode = $vbulletin->input->clean_gpc('p', 'cybareg_code', TYPE_STR);\r\n\t\t\t\t$cybareg_invonly = \"AND code = $cybareg_aregcode\";\r\n\t\t\t}\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$cybareg_tiinfo = $vbulletin->db->query_first(\"\r\n\t\t\t\tSELECT id, inviter, invited, code\r\n\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg_invite AS cyb_advreg_invite\r\n\t\t\t\tWHERE invited = '\".$db->escape_string($vbulletin->GPC['email']).\"' AND done = '0' $cybareg_invonly\r\n\t\t\t\");\r\n\t\t\tif ($cybareg_tiinfo['id']>0)\r\n\t\t\t{\r\n\t\t\t\tif (empty($userdata->errors))\r\n\t\t\t\t{\r\n\t\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg_invite SET done = '1' WHERE id = '\".$db->escape_string($cybareg_tiinfo['id']).\"' \");\r\n\t\t\t\t\t$cybareg_refinfo = $vbulletin->db->query_first(\"\r\n\t\t\t\t\t\tSELECT username\r\n\t\t\t\t\t\tFROM \" . TABLE_PREFIX . \"user AS user\r\n\t\t\t\t\t\tWHERE userid = '\".$db->escape_string($cybareg_tiinfo['inviter']).\"'\r\n\t\t\t\t\t\");\r\n\t\t\t\t\t$userdata->set('referrerid', $cybareg_refinfo['username']);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if ($vbulletin->options['cybareg_enable_invite_only'])\r\n\t\t\t{\r\n\t\t\t\t$userdata->error('cybareg_wrong_invcode');\r\n\t\t\t}\r\n\t\t\t$db->show_errors();\r\n\t\t}\r\nif (function_exists('kh99_checkpassword'))\r\n{\r\n   if (!kh99_checkpassword($vbulletin->GPC['password'], $kh99_password_rules, $kh99_password_errors))\r\n   {\r\n      $userdata->error('kh99_password_error_reg', '');\r\n   }\r\n}\r\nif($vbulletin->options['requireuniqueemail']) { \r\n    if (stristr($vbulletin->GPC['email'], \"@gmail.com\") || stristr($vbulletin->GPC['email'], \"@googlemail.com\")) { \r\n        $email = str_replace(\".\", \"\", substr($vbulletin->GPC['email'],  0, strripos($vbulletin->GPC['email'], \"@\"))); \r\n        if (strpos($email, \"+\") > 0) { \r\n            $email = substr($email,  0, strripos($email, \"+\")); \r\n        } \r\n\r\n        $gmail = $email .\"@gmail.com\"; \r\n        $google = $email .\"@googlemail.com\"; \r\n        if (!($userdata->verify_useremail($gmail) && $userdata->verify_useremail($google))) { \r\n             eval( standard_error( fetch_error('gmail_same_email'), '', true, '', 'EMAIL.USED' ) ) ; \r\n        } \r\n        $userdata->set('email', $gmail); \r\n    } \r\n}\r\n", 
  "userdata_doset": "if ($fieldname == 'notepad')\r\n{\r\n   $tables = array('usertextfield');\r\n}\r\n", 
  "visitor_messagebit_display_complete": "if (defined('VB_API') && VB_API === true)\r\n{\r\n\t$message['message'] = strip_tags($message['message']);\r\n}\r\n", 
  "login_failure": "if (defined('VB_API') AND VB_API === true)\r\n{\r\n\t// See VBM-635: &#xxx; should be converted to windows-1252 extended char. This may not happen if a browser submits the form. But from API or user manually input, it does.\r\n\t// See also vB_DataManager_User::verify_username()\r\n\t$vbulletin->GPC['vb_login_username'] = preg_replace(\r\n\t\t'/&#([0-9]+);/ie',\r\n\t\t\"convert_unicode_char_to_charset('\\\\1', \\$stylevar['charset'])\",\r\n\t\t$vbulletin->GPC['vb_login_username']\r\n\t);\r\n\t\r\n\tif (verify_authentication($vbulletin->GPC['vb_login_username'], $vbulletin->GPC['vb_login_password'], $vbulletin->GPC['vb_login_md5password'], $vbulletin->GPC['vb_login_md5password_utf'], $vbulletin->GPC['cookieuser'], true))\r\n\t{\r\n\t\texec_unstrike_user($vbulletin->GPC['vb_login_username']);\r\n\r\n\t\t// create new session\r\n\t\tprocess_new_login($vbulletin->GPC['logintype'], $vbulletin->GPC['cookieuser'], $vbulletin->GPC['cssprefs']);\r\n\r\n\t\t// do redirect\r\n\t\tdo_login_redirect();\r\n\t}\r\n\telse\r\n\t{\r\n\t\t$vbulletin->session->set('userid', 0);\r\n\t\t$vbulletin->session->set('loggedin', 0);\r\n\t}\r\n}\r\n", 
  "search_results_prebits": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tif (($forum[linkview_nb] !='0') AND ($forum[linkview_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t{\r\n\t\t\t\tif ($search['showposts'])\r\n\t\t\t\t{\r\n\t\t\t\t\tif ($vbulletin->userinfo[userid])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = $vbulletin->userinfo['posts'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = '0';\r\n\t\t\t\t\t}\r\n\t\t\t\t\tforeach ($itemids AS $postid => $post)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t$cyb_apboupc_par1 = eregi_replace('(http|www)([[:alnum:]/\\n+-=%&:_.~?]+[#[:alnum:]+]*)', construct_phrase($vbphrase['error_postcount_too_low_viewlinks'], $forum[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $post['pagetext']);\r\n\t\t\t\t\t\t$itemids[\"$postid\"]['pagetext'] = preg_replace(\"!\\b[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!i\", construct_phrase($vbphrase['error_postcount_too_low_viewlinks'], $forum[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $cyb_apboupc_par1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n", 
  "search_results_threadbit": "if ((defined('VB_API') AND VB_API === true) AND $vbulletin->options['avatarenabled'])\r\n{\r\n\trequire_once DIR . '/includes/functions_user.php';\r\n\t$avatar = fetch_avatar_url($thread['postuserid']);\r\n}\r\n", 
  "showthread_query": "$hook_query_fields .= \",blog_user.entries\";\r\n$hook_query_joins .= \"LEFT JOIN \" . TABLE_PREFIX . \"blog_user AS blog_user ON (blog_user.bloguserid = post.userid)\";\r\nif(defined('VBSEO_ENABLED') && VBSEO_ENABLED)\r\n{\r\n\r\n    if (VBSEO_LIKE_POST)\r\n\t{\r\n        vbseo_extra_inc('ui');\r\n    \tvBSEO_UI::extract_likes_page(VBSEO_UI_THREAD, $thread['threadid'], $ids);\r\n    }\r\n\r\n}\r\nif ($forum['ada_forum'])\r\n{\r\n    $ids .= \",$thread[firstpostid]\";\r\n    $postids = \"post.postid IN (0\" . $ids . \")\"; \r\n    if ($thread['hasattach'])\r\n    {\r\n        $attachments = $db->query_read(\"\r\n            SELECT dateline, thumbnail_dateline, filename, filesize, visible, attachmentid, counter,\r\n                postid, IF(thumbnail_filesize > 0, 1, 0) AS hasthumbnail, thumbnail_filesize,\r\n                attachmenttype.thumbnail AS build_thumbnail, attachmenttype.newwindow\r\n            FROM \" . TABLE_PREFIX . \"attachment\r\n            LEFT JOIN \" . TABLE_PREFIX . \"attachmenttype AS attachmenttype USING (extension)\r\n            WHERE postid IN (-1\" . $ids . \")\r\n            ORDER BY attachmentid\r\n        \");\r\n        $postattach = array();\r\n        while ($attachment = $db->fetch_array($attachments))\r\n        {\r\n            if (!$attachment['build_thumbnail'])\r\n            {\r\n                $attachment['hasthumbnail'] = false;\r\n            }\r\n            $postattach[\"$attachment[postid]\"][\"$attachment[attachmentid]\"] = $attachment;\r\n        }      \r\n        $thread['attach'] = $thread['hasattach'];\r\n        unset($thread['hasattach']);\r\n    }\r\n}\r\n", 
  "threadrate_start": "\r\nif ($vbulletin->options['calcrot'])\r\nif ($threadinfo['postuserid'] == $vbulletin->userinfo['userid'])\r\n{\r\n   eval(standard_error(\"$vbphrase[rate_own_thread]\"));\r\n}\r\n", 
  "newthread_form_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('newthread_form_complete', $post);\r\n\r\nif ($vbulletin->options['autotag_enabled_ajax'] AND $vbulletin->options['autotag_enabled_all'])\r\n{\r\n\t$vbulletin->templatecache[\"newthread\"] = str_replace('name=\\\"subject\\\"','id=\\\"subjecttitle\\\" name=\\\"subject\\\" onblur=\\\"UpdateTitle('.$foruminfo[\"forumid\"].','.$vbulletin->userinfo[\"userid\"].', '.$tags_remain.')\\\"',$vbulletin->templatecache[\"newthread\"]);\r\n\t$vbulletin->templatecache[\"newthread\"] = str_replace('name=\\\"prefixid\\\"','id=\\\"prefixid\\\" name=\\\"prefixid\\\"',$vbulletin->templatecache[\"newthread\"]);\r\n}\r\n\t\t\t\r\n", 
  "member_complete": "eval('$template_hook[\\'profile_left_last\\'] .= $blocks[\\'blog\\'];');\r\nif(!VBSEO_VB4 && $vbseo_ltab)\r\n{\r\n\tglobal $template_hook;\r\n\t$template_hook['profile_left_last'] .= $blocks[$vbseo_ltab];\r\n}\r\n\r\n$vbpua_lasthook='member_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\neval('print_output(\"' . fetch_template($templatename, 0, true, false, array('prepared.avatarurl')) . '\");');\r\n", 
  "threaddata_postsave": "\r\nglobal $vbulletin;\r\nif ($vbulletin->options['autotag_enabled_all'])\r\n{\r\n\trequire_once(DIR . '/includes/functions_autotagger.php');\r\n\r\n\tDeleteThreadTags($this->fetch_field('threadid'));\r\n\t$att_thread = fetch_threadinfo($this->fetch_field('threadid'), false);\r\n\tProcessThread($att_thread);\r\n\r\n}\r\n\r\n\t\t\t\r\n", 
  "redirect_generic": "\r\n$vbpppf_lasthook='redirect_generic';\r\ninclude(DIR.'/includes/vbpppf_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n$vbpua_lasthook='redirect_generic';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "paidsub_build": "\r\n\t\t\t\t$vbppfo_lasthook='paidsub_build';\r\n\t\t\t\tinclude(DIR.'/includes/vbppfo_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$vbppt_lasthook='paidsub_build';\r\n\t\t\t\tinclude(DIR.'/includes/vbppt_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\t\t\t$vbpwr_lasthook='paidsub_build';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n// #### Subscription Notification E-mail ####\r\nif($this->registry->options['submes_enable'] && (!$currentsubscription['subscriptionlogid'] || ($currentsubscription['subscriptionlogid'] && ($currentsubscription['expirydate'] != $expirydate))))\r\n{\r\n   global $vbphrase;\r\n   // Prepare e-mail variables\r\n   // user info\r\n   $subscriber = $user;    \r\n   if(!$vbphrase)\r\n   {\r\n      global $vbulletin, $phrasegroups;\r\n      $vbphrase = init_language();\r\n   }   \r\n   $sub['title'] = $vbphrase['sub' . $sub['subscriptionid'] . '_title'];\r\n   $sub['description'] = $vbphrase['sub' . $sub['subscriptionid'] . '_desc'];                   \r\n   $subscription['title'] = $sub['title'];\r\n   $subscription['description'] = $sub['description'];               \r\n   $currency = isset($this->paymentinfo['currency']) ? $this->paymentinfo['currency'] : 'usd';  \r\n   $subscription['date']  = vbdate($this->registry->options['dateformat'].' h:i',TIMENOW);\r\n   $subscription['startdate'] = vbdate($this->registry->options['dateformat'],$regdate);\r\n   $subscription['enddate']   = vbdate($this->registry->options['dateformat'],$expirydate);\r\n   // site info\r\n   $bbtitle   = $this->registry->options['bbtitle'];\r\n   $bburl     = $this->registry->options['bburl'];\r\n   $sitetitle = $this->registry->options['homeurl'];\r\n   $sitename  = $this->registry->options['hometitle'];\r\n   eval(fetch_email_phrases('submes_subscription_user'));\r\n   vbmail($user['email'], $subject, $message, true, $this->registry->options['submes_email_from']);   \r\n}     \r\n// #### End Subscription Notification E-mail ####\r\n", 
  "memberlist_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('memberlist_complete');\r\n", 
  "editpost_update_complete": "global $rmq_helper;\r\n$lasthook='editpost_update_complete';\r\n$body = get_defined_vars();\r\n$rmq_helper->publish($body, '', 'vb', array('x-ha-policy' => array('S', 'all')), 'topic', 'vb.' . $lasthook);\r\n", 
  "ppgal_func_complete": "\r\n$vbpua_lasthook='ppgal_func_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "printthread_post": "\r\n\t\tif ($vbulletin->options['apboupc_global_enable'] AND $vbulletin->options['apboupc_viewlinks'])\r\n\t\t{\r\n\t\t\tif ($vbulletin->userinfo[userid])\r\n\t\t\t{\r\n\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = $vbulletin->userinfo['posts'];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t$cyb_apboupc_viewlinks_userpostsnr = '0';\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tif (($foruminfo[linkview_nb] !='0') AND ($foruminfo[linkview_nb] > $vbulletin->userinfo[posts]) AND (!is_member_of($vbulletin->userinfo, split(',', $vbulletin->options['apboupc_viewlinks_excl_groups']))))\r\n\t\t\t{\r\n\t\t\t\t$post['message'] = preg_replace('!(\\\\[url(\\\\[img)?|\\\\[email|\\\\[img)(.*)((\\\\[\\/img\\\\])?\\\\[\\/url\\\\]|\\\\[\\/email\\\\]|\\\\[\\/img\\\\])|<a[^>]*(http|www|mailto)(.*)</a>|(http:\\/\\/)?www(.*)[\\s]\\b|<img[^>]*(src|border|title)(.*)(</img>|\\/>)|[A-Z0-9._%-]+@[A-Z0-9._%-]+\\.[A-Z]{2,4}\\b!siU', construct_phrase('<br /><span class=\"smallfont\"><i>'.$vbphrase['error_postcount_too_low_viewlinks'].'</i></span><br />', $foruminfo[linkview_nb], $cyb_apboupc_viewlinks_userpostsnr), $post['message'].' ');\r\n\t\t\t}\r\n\t\t}\r\n", 
  "group_complete": "if(defined('VBSEO_ENABLED'))\r\nvbseo_complete_sec('group_complete');\r\n\r\n$vbpua_lasthook='group_complete';\r\ninclude(DIR.'/includes/vbvua_hooks.php');\r\n             \r\n", 
  "forumdisplay_query_threadscount": "\r\nif($_REQUEST['unmoderated']=='true')\r\n{\r\n\tif($visiblethreads == \" AND visible IN (0,1,2)\")\r\n\t{\r\n\t\t$visiblethreads = \" AND visible = 0 \";\r\n\t}\r\n}\t\t\t\r\n\t\t\t\r\n\t\t\t\r\nif (class_exists('vb_optimise'))\r\n{\r\n\t$vars = array(\r\n\t\t'lastread'\t\t=> $lastread,\r\n\t\t'hook_query_fields'\t=> $hook_query_fields,\r\n\t\t'tachyjoin'\t\t=> $tachyjoin,\r\n\t\t'hook_query_joins'\t=> $hook_query_joins,\r\n\t\t'forumid'\t\t=> $foruminfo['forumid'],\r\n\t\t'prefix_filter'\t\t=> $prefix_filter,\r\n\t\t'visiblethreads'\t=> $visiblethreads,\r\n\t\t'globalignore'\t\t=> $globalignore,\r\n\t\t'limitothers'\t\t=> $limitothers,\r\n\t\t'datecut'\t\t=> $datecut,\r\n\t\t'hook_query_where'\t=> $hook_query_where,\r\n\t);\r\n\r\n\tvb_optimise::cache('forumdisplaysub', $db, $vars);\r\n}\r\n", 
  "register_addmember_complete": "\r\n\t\t\t\t$vbpwr_lasthook='register_addmember_complete';\r\n\t\t\t\tinclude(DIR.'/includes/vbpwr_hooks.php');\r\n\t\t\t\r\n\t\t\t\r\n\r\n\t\tif ($vbulletin->options['cybareg_enable'] AND $vbulletin->options['cybareg_enable_invite'])\r\n\t\t{\r\n\t\t\t$db->hide_errors();\r\n\t\t\t$cyb_areg_inviteduser = $vbulletin->db->query_read(\"\r\n\t\t\t\tSELECT cyb_advreg_invite.invited, cyb_advreg_invite.accepted, user.userid, user.email\r\n\t\t\t\tFROM \" . TABLE_PREFIX . \"cyb_advreg_invite AS cyb_advreg_invite\r\n\t\t\t\tLEFT JOIN \" . TABLE_PREFIX . \"user AS user ON (user.email = cyb_advreg_invite.invited)\r\n\t\t\t\tWHERE accepted < 1 AND email != ''\r\n\t\t\t\");\r\n\t\t\twhile ($cybareguser = $db->fetch_array($cyb_areg_inviteduser))\r\n\t\t\t{\r\n\t\t\t\t$vbulletin->db->query_write(\" UPDATE \" . TABLE_PREFIX . \"cyb_advreg_invite SET accepted = '\".$db->escape_string($cybareguser['userid']).\"', done = '1' WHERE invited = '\".$db->escape_string($cybareguser['email']).\"' \");\r\n\t\t\t}\r\n\t\t\t$db->show_errors();\r\n\t\t}\r\n"
}